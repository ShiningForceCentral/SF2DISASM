
; GAME SECTION 03 :
; Menu Engine

; FREE SPACE : 38 bytes.



; =============== S U B R O U T I N E =======================================

j_ExecuteMenu:
										
										jmp     ExecuteMenu(pc) 

	; End of function j_ExecuteMenu


; =============== S U B R O U T I N E =======================================

sub_10004:
										
										jmp     sub_10586(pc)

	; End of function sub_10004


; =============== S U B R O U T I N E =======================================

sub_10008:
										
										jmp     sub_10586(pc)

	; End of function sub_10008


; =============== S U B R O U T I N E =======================================

sub_1000C:
										
										jmp     sub_10586(pc)

	; End of function sub_1000C


; =============== S U B R O U T I N E =======================================

sub_10010:
										
										jmp     sub_10A4A(pc)

	; End of function sub_10010


; =============== S U B R O U T I N E =======================================

j_CreateFighterMiniStatusWindow:
										
										jmp     CreateFighterMiniStatusWindow(pc)

	; End of function j_CreateFighterMiniStatusWindow


; =============== S U B R O U T I N E =======================================

j_HideFighterMiniStatusWindow:
										
										jmp     HideFighterMiniStatusWindow(pc)

	; End of function j_HideFighterMiniStatusWindow


; =============== S U B R O U T I N E =======================================

sub_1001C:
										
										jmp     sub_1161A(pc)

	; End of function sub_1001C


; =============== S U B R O U T I N E =======================================

sub_10020:
										
										jmp     sub_11638(pc)

	; End of function sub_10020


; =============== S U B R O U T I N E =======================================

sub_10024:
										
										jmp     loc_116B8(pc)

	; End of function sub_10024


; =============== S U B R O U T I N E =======================================

sub_10028:
										
										jmp     loc_11694(pc)

	; End of function sub_10028


; =============== S U B R O U T I N E =======================================

sub_1002C:
										
										jmp     sub_11716(pc)

	; End of function sub_1002C


; =============== S U B R O U T I N E =======================================

j_MemberStatsScreen:
										
										jmp     MemberStatsScreen(pc)

	; End of function j_MemberStatsScreen


; =============== S U B R O U T I N E =======================================

sub_10034:
										
										jmp     sub_1288E(pc)

	; End of function sub_10034


; =============== S U B R O U T I N E =======================================

j_InitPortraitWindow:
										
										jmp     InitPortraitWindow(pc)

	; End of function j_InitPortraitWindow


; =============== S U B R O U T I N E =======================================

j_HidePortraitWindow:
										
										jmp     HidePortraitWindow(pc)

	; End of function j_HidePortraitWindow


; =============== S U B R O U T I N E =======================================

sub_10040:
										
										jmp     sub_12FE6(pc)

	; End of function sub_10040


; =============== S U B R O U T I N E =======================================

sub_10044:
										
										jmp     loc_13004(pc)

	; End of function sub_10044


; =============== S U B R O U T I N E =======================================

sub_10048:
										
										jmp     loc_13030(pc)

	; End of function sub_10048


; =============== S U B R O U T I N E =======================================

sub_1004C:
										
										jmp     sub_147FA(pc)

	; End of function sub_1004C


; =============== S U B R O U T I N E =======================================

sub_10050:
										
										jmp     sub_12F12(pc)

	; End of function sub_10050


; =============== S U B R O U T I N E =======================================

sub_10054:
										
										jmp     sub_12F5E(pc)

	; End of function sub_10054


; =============== S U B R O U T I N E =======================================

sub_10058:
										
										jmp     sub_12F9A(pc)

	; End of function sub_10058


; =============== S U B R O U T I N E =======================================

sub_1005C:
										
										jmp     sub_113C6(pc)

	; End of function sub_1005C


; =============== S U B R O U T I N E =======================================

sub_10060:
										
										jmp     sub_11404(pc)

	; End of function sub_10060


; =============== S U B R O U T I N E =======================================

sub_10064:
										
										jmp     sub_1141E(pc)

	; End of function sub_10064


; =============== S U B R O U T I N E =======================================

j_CreateLandEffectWindow:
										
										jmp     CreateLandEffectWindow(pc)

	; End of function j_CreateLandEffectWindow


; =============== S U B R O U T I N E =======================================

j_HideLandEffectWindow:
										
										jmp     HideLandEffectWindow(pc)

	; End of function j_HideLandEffectWindow


; =============== S U B R O U T I N E =======================================

sub_10070:
										
										jmp     sub_157E8(pc)

	; End of function sub_10070


; =============== S U B R O U T I N E =======================================

j_YesNoChoiceBox:
										
										jmp     YesNoChoiceBox(pc)

	; End of function j_YesNoChoiceBox


; =============== S U B R O U T I N E =======================================

j_YesNoPrompt:
										
										jmp     YesNoPrompt(pc)

	; End of function j_YesNoPrompt


; =============== S U B R O U T I N E =======================================

sub_1007C:
										
										jmp     sub_15BB0(pc)

	; End of function sub_1007C


; =============== S U B R O U T I N E =======================================

sub_10080:
										
										jmp     sub_1586E(pc)

	; End of function sub_10080

p_ItemNames:        dc.l ItemNames
p_ClassNames:       dc.l ClassNames
p_ItemDefs:         dc.l ItemDefs
p_SpellData:        dc.l SpellDefs

; =============== S U B R O U T I N E =======================================

j_NumberPrompt:
										
										jmp     NumberPrompt(pc)

	; End of function j_NumberPrompt


; =============== S U B R O U T I N E =======================================

j_DebugFlagSetter:
										
										jmp     DebugFlagSetter(pc)

	; End of function j_DebugFlagSetter


; =============== S U B R O U T I N E =======================================

j_SpecialBattle:
										
										jmp     SpecialBattle(pc)

	; End of function j_SpecialBattle


; =============== S U B R O U T I N E =======================================

sub_100A0:
										
										jmp     sub_16552(pc)

	; End of function sub_100A0


; =============== S U B R O U T I N E =======================================

j_VintFunc_16588:
										
										jmp     VInt_16588(pc)

	; End of function j_VintFunc_16588


; =============== S U B R O U T I N E =======================================

j_WitchMainMenu:
										
										jmp     WitchMainMenu(pc)

	; End of function j_WitchMainMenu


; =============== S U B R O U T I N E =======================================

sub_100AC:
										
										jmp     sub_169AE(pc)

	; End of function sub_100AC


; =============== S U B R O U T I N E =======================================

sub_100B0:
										
										jmp     sub_16A30(pc)

	; End of function sub_100B0


; =============== S U B R O U T I N E =======================================

; related to end kiss

j_EndKiss:
										
										jmp     EndKiss(pc)     

	; End of function j_EndKiss


; =============== S U B R O U T I N E =======================================

sub_100B8:
										
										jmp     sub_154F6(pc)

	; End of function sub_100B8


; =============== S U B R O U T I N E =======================================

j_LoadPortrait:
										
										jmp     LoadPortrait(pc)

	; End of function j_LoadPortrait


; =============== S U B R O U T I N E =======================================

j_GetCharPortraitIdx:
										
										jmp     GetCharPortraitIdx(pc)

	; End of function j_GetCharPortraitIdx

p_WindowLayout_MemberStats:
										dc.l MemberStatsWindowLayout

; =============== S U B R O U T I N E =======================================

; write from ascii but with FFFF value instead of 0, hmm ...

sub_100C8:
										
										link    a6,#-2
										move.w  #$FFFF,-2(a6)
										bra.s   loc_100EA

	; End of function sub_100C8


; =============== S U B R O U T I N E =======================================

; write tiles from number in D0 into A1 D7 letters, window width D1

WriteTilesFromNumber:
										
										jsr     (WriteAsciiNumber).w
										lea     ((byte_FFDE80-$1000000)).w,a0
										moveq   #$A,d0
										sub.w   d7,d0
										adda.w  d0,a0

	; End of function WriteTilesFromNumber


; =============== S U B R O U T I N E =======================================

; write tiles from ASCII from A0 into A1 D7 letters, window width D1
; 

WriteTilesFromASCII:
										
										link    a6,#-2
										clr.w   -2(a6)
loc_100EA:
										
										movem.l d2/a2,-(sp)
										movea.l a1,a2
										subq.w  #1,d7
loc_100F2:
										
										clr.w   d0
										move.b  (a0)+,d0
										beq.w   loc_10186
										ori.w   #VDPTILE_PALETTE3_MASK,d0
										cmpi.b  #TEXT_CODE_MOVEDOWN,d0
										beq.s   loc_1016A
										cmpi.b  #TEXT_CODE_TOGGLEFONTCOLOR,d0
										beq.s   loc_10174       
										cmpi.b  #TEXT_CODE_NEWLINE,d0
										beq.s   loc_1017C
										tst.b   d0
										bpl.s   loc_10118
										subi.w  #$40,d0 
loc_10118:
										
										cmpi.b  #$60,d0 
										blt.s   loc_10122       
										addi.w  #$20,d0 
loc_10122:
										
										tst.w   -2(a6)          ; test if we're using the orange font
										beq.s   loc_10156
										cmpi.b  #$30,d0 
										bcc.s   loc_10140
										move.w  d1,-(sp)
										clr.w   d1
										move.b  d0,d1
										subi.b  #$20,d1 
										move.b  tbl_MainFontAlternateSymbols(pc,d1.w),d0
										move.w  (sp)+,d1
										bra.s   loc_10156
loc_10140:
										
										tst.b   d0
										bpl.s   loc_10152
										subi.w  #$1A,d0
										cmpi.b  #$70,d0 
										bhi.s   loc_10150
										subq.w  #1,d0
loc_10150:
										
										bra.s   loc_10156
loc_10152:
										
										addi.w  #$82,d0 
loc_10156:
										
										move.w  d0,(a1)+
										bra.s   loc_10182
tbl_MainFontAlternateSymbols:
										
										dc.b $20                ; VDP tile idxes to substitute in for symbol ASCII values when using orange font
										dc.b $9B
										dc.b $9C
										dc.b $9D
										dc.b $9E
										dc.b $9F
										dc.b $A6
										dc.b $A7
										dc.b $A8
										dc.b $A9
										dc.b $AA
										dc.b $AB
										dc.b $AC
										dc.b $AD
										dc.b $AE
										dc.b $AF
loc_1016A:
										
										lea     2(a2),a1
										suba.w  d1,a1
										movea.l a1,a2
										bra.s   loc_10182
loc_10174:
										
										eori.w  #$FFFF,-2(a6)   ; 0x5C: toggle to/from orange font
										bra.s   loc_10182
loc_1017C:
										
										movea.l a2,a1
										suba.w  d1,a1
										movea.l a1,a2
loc_10182:
										
										dbf     d7,loc_100F2
loc_10186:
										
										movem.l (sp)+,d2/a2
										unlk    a6
										rts

	; End of function WriteTilesFromASCII


; =============== S U B R O U T I N E =======================================

; draw box tiles into A1, dimensions in D0, including borders (xxyy)

sub_1018E:
										
										movem.l d4-d5/a1,-(sp)
										move.w  d0,d4
										lsr.w   #8,d4
										subq.l  #3,d4
										move.w  #$C060,(a1)+
loc_1019C:
										
										move.w  #$C061,(a1)+
										dbf     d4,loc_1019C
										move.w  #$C860,(a1)+
										move.w  d0,d5
										andi.w  #$FF,d5
										subq.w  #3,d5
loc_101B0:
										
										move.w  d0,d4
										lsr.w   #8,d4
										subq.w  #3,d4
										move.w  #$C070,(a1)+
loc_101BA:
										
										move.w  #$C020,(a1)+
										dbf     d4,loc_101BA
										move.w  #$C870,(a1)+
										dbf     d5,loc_101B0
										move.w  d0,d4
										lsr.w   #8,d4
										subq.w  #3,d4
										move.w  #$D060,(a1)+
loc_101D4:
										
										move.w  #$D061,(a1)+
										dbf     d4,loc_101D4
										move.w  #$D860,(a1)+
										movem.l (sp)+,d4-d5/a1
										rts

	; End of function sub_1018E


; =============== S U B R O U T I N E =======================================

sub_101E6:
										
										move.b  #8,(byte_FFDCBB).l
										clr.b   (byte_FFDE7B).l
										rts

	; End of function sub_101E6


; =============== S U B R O U T I N E =======================================

; related to menus
; 
; In: A0 = special subroutine address to handle menu, default handling if not supplied (unused functionality)
;     D0 = initial choice (00=up, 01=left, 02=right, 03=down)
;     D1 = animate-in direction (00=from bottom, other=from right)
;     D2 = menu idx to use (just affects icons and text)

ExecuteMenu:
										
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										link    a6,#-$C
										move.w  d2,-4(a6)
										move.l  a0,-8(a6)
										move.w  d1,-$A(a6)
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										move.w  #$1206,d0
										tst.w   d1
										bne.s   loc_1021C
										move.w  #$C1D,d1
										bra.s   loc_10220
loc_1021C:
										
										move.w  #$2015,d1
loc_10220:
										
										jsr     (CreateWindow).w
										move.w  d0,-$C(a6)
										bsr.w   LoadDiamenuWindowVDPTileData
										move.w  -4(a6),d0
										lsl.w   #2,d0
										lea     unk_1115C(pc), a0
										move.l  (a0,d0.w),d0
										bclr    #$1F,d0
										bne.s   loc_10250
										movea.l d0,a0
										movea.l (a0),a0
										lea     (DMA_SPACE_FF8804).l,a1
										jsr     (LoadTileData).w
										bra.s   loc_1026E
loc_10250:
										
										lea     (DMA_SPACE_FF8804).l,a1
										rol.l   #8,d0
										bsr.w   LoadNextMainMenuIcon
										rol.l   #8,d0
										bsr.w   LoadNextMainMenuIcon
										rol.l   #8,d0
										bsr.w   LoadNextMainMenuIcon
										rol.l   #8,d0
										bsr.w   LoadNextMainMenuIcon
loc_1026E:
										
										jsr     (WaitForVInt).w 
										clr.w   d6
										bsr.w   LoadVDPTileListForDiamenuIconTop
										bsr.w   LoadVDPTileListForDiamenuIconLeft
										bsr.w   LoadVDPTileListForDiamenuIconRight
										bsr.w   LoadVDPTileListForDiamenuIconBottom
										move.w  -$C(a6),d0
										move.w  #$C15,d1
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.l  -8(a6),d0
										beq.s   loc_102A2
										movea.l d0,a0
										jsr     (a0)
loc_102A2:
										
										moveq   #$1E,d6
loc_102A4:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_102B6
										moveq   #1,d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10328
loc_102B6:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_102C8
										moveq   #2,d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10328
loc_102C8:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_102DA
										clr.w   d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10328
loc_102DA:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_102EC
										moveq   #3,d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10328
loc_102EC:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10300
										moveq   #$FFFFFFFF,d1   ; B pressed, so cancel menu
										moveq   #$FFFFFFFF,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bra.w   loc_10382
loc_10300:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10314
										clr.w   d1              ; C pressed, so confirm menu
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_10382
loc_10314:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10358
										clr.w   d1              ; A pressed, so confirm menu
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_10382
loc_10328:
										
										move.w  d1,-(sp)
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										clr.w   d6
										bsr.w   sub_103FE
										move.w  (sp)+,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bsr.w   LoadDiamenuWindowVDPTileData
										move.w  -$C(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										move.l  -8(a6),d0
										beq.s   loc_10356
										movea.l d0,a0
										jsr     (a0)
loc_10356:
										
										moveq   #$1D,d6
loc_10358:
										
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   sub_103FE
										subq.w  #1,d6
										bne.s   loc_10366
										moveq   #$1E,d6
loc_10366:
										
										movem.l d6-d7,-(sp)
										move.w  #$100,d6
										jsr     (UpdateRandomSeed).w
										move.b  d7,((RANDOM_WAITING_FOR_INPUT-$1000000)).w
										movem.l (sp)+,d6-d7
										jsr     (WaitForVInt).w 
										bra.w   loc_102A4
loc_10382:
										
										movem.w d0-d1,-(sp)
										move.w  -$C(a6),d0
										tst.w   d1
										beq.s   loc_10394
										move.w  #$C1D,d1
										bra.s   loc_10398
loc_10394:
										
										move.w  #$2015,d1
loc_10398:
										
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  -$C(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										movem.w (sp)+,d0-d1
										unlk    a6
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function ExecuteMenu


; =============== S U B R O U T I N E =======================================

; In: -$C(A6) = window slot idx

LoadDiamenuWindowVDPTileData:
										
										lea     DiamondMenuLayout(pc), a0
										move.w  -$C(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  #$D8,d7 
										jsr     (CopyBytes).w   
										move.w  -4(a6),d0
										lsl.w   #2,d0
										lea     pt_MenuOptions(pc), a0
										movea.l (a0,d0.w),a0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										andi.w  #3,d0
										lsl.w   #2,d0
										movea.l (a0,d0.w),a0
										move.w  -$C(a6),d0
										move.w  #$B04,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										moveq   #$FFFFFFDC,d1
										moveq   #$C,d7
										bra.w   WriteTilesFromASCII

	; End of function LoadDiamenuWindowVDPTileData


; =============== S U B R O U T I N E =======================================

sub_103FE:
										
										add.w   d0,d0
										move.w  rjt_10408(pc,d0.w),d0
										jmp     rjt_10408(pc,d0.w)

	; End of function sub_103FE

rjt_10408:          dc.w LoadVDPTileListForDiamenuIconTop-rjt_10408
										dc.w LoadVDPTileListForDiamenuIconLeft-rjt_10408
										dc.w LoadVDPTileListForDiamenuIconRight-rjt_10408
										dc.w LoadVDPTileListForDiamenuIconBottom-rjt_10408

; =============== S U B R O U T I N E =======================================

LoadVDPTileListForDiamenuIconTop:
										
										lea     (DMA_SPACE_FF8804).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_10420
										adda.w  #$120,a0
loc_10420:
										
										lea     ($B800).l,a1
										move.w  #$90,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function LoadVDPTileListForDiamenuIconTop


; =============== S U B R O U T I N E =======================================

LoadVDPTileListForDiamenuIconLeft:
										
										lea     (byte_FF8A44).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_10440
										adda.w  #$120,a0
loc_10440:
										
										lea     (byte_FF9104).l,a1
										bsr.w   sub_10484
										lea     ($B920).l,a1
										move.w  #$C0,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function LoadVDPTileListForDiamenuIconLeft


; =============== S U B R O U T I N E =======================================

LoadVDPTileListForDiamenuIconRight:
										
										lea     (byte_FF8C84).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_1046A
										adda.w  #$120,a0
loc_1046A:
										
										lea     (byte_FF9284).l,a1
										bsr.w   sub_104E6
										lea     ($BAA0).l,a1
										move.w  #$C0,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function LoadVDPTileListForDiamenuIconRight


; =============== S U B R O U T I N E =======================================

sub_10484:
										
										move.l  a1,-(sp)
										moveq   #3,d7
										move.l  a0,-(sp)
										lea     MenuHBarTiles(pc), a0
loc_1048E:
										
										move.l  $20(a0),$40(a1)
										move.l  $10(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_1048E
										movea.l (sp)+,a0
										moveq   #8,d7
loc_104A4:
										
										move.l  (a0)+,(a1)
										move.l  (a0)+,4(a1)
										move.l  (a0)+,8(a1)
										move.l  (a0)+,$C(a1)
										move.l  (a0)+,$50(a1)
										move.l  (a0)+,$54(a1)
										move.l  (a0)+,$58(a1)
										move.l  (a0)+,$5C(a1)
										adda.w  #$20,a1 
										dbf     d7,loc_104A4
										moveq   #3,d7
										lea     unk_11336(pc), a0
loc_104D0:
										
										move.l  $20(a0),$40(a1)
										move.l  $10(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_104D0
										movea.l (sp)+,a0
										rts

	; End of function sub_10484


; =============== S U B R O U T I N E =======================================

sub_104E6:
										
										move.l  a1,-(sp)
										moveq   #3,d7
										move.l  a0,-(sp)
										lea     unk_11366(pc), a0
loc_104F0:
										
										move.l  $20(a0),$40(a1)
										move.l  $10(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_104F0
										movea.l (sp)+,a0
										moveq   #8,d7
loc_10506:
										
										move.l  (a0)+,(a1)
										move.l  (a0)+,4(a1)
										move.l  (a0)+,8(a1)
										move.l  (a0)+,$C(a1)
										move.l  (a0)+,$50(a1)
										move.l  (a0)+,$54(a1)
										move.l  (a0)+,$58(a1)
										move.l  (a0)+,$5C(a1)
										adda.w  #$20,a1 
										dbf     d7,loc_10506
										moveq   #3,d7
										lea     unk_11396(pc), a0
loc_10532:
										
										move.l  $20(a0),$40(a1)
										move.l  $10(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_10532
										movea.l (sp)+,a0
										rts

	; End of function sub_104E6


; =============== S U B R O U T I N E =======================================

LoadVDPTileListForDiamenuIconBottom:
										
										lea     (byte_FF8EC4).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_10558
										adda.w  #$120,a0
loc_10558:
										
										lea     ($BC20).l,a1
										move.w  #$90,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function LoadVDPTileListForDiamenuIconBottom


; =============== S U B R O U T I N E =======================================

LoadNextMainMenuIcon:
										
										move.l  d0,-(sp)
										ext.w   d0
										movea.l (p_MenuTiles_Uncompressed).l,a0
										mulu.w  #GFX_DIAMENU_ICON_NUM_PIXELS,d0
										adda.w  d0,a0
										move.w  #$8F,d0 
loc_1057C:
										
										move.l  (a0)+,(a1)+
										dbf     d0,loc_1057C
										move.l  (sp)+,d0
										rts

	; End of function LoadNextMainMenuIcon


; =============== S U B R O U T I N E =======================================

sub_10586:
										
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										move.w  d6,-(sp)
										link    a6,#-$C
										move.w  d2,-4(a6)
										move.l  a0,-8(a6)
										move.w  d1,-$A(a6)
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										move.w  #$1206,d0
										tst.w   d1
										bne.s   loc_105AE
										move.w  #$C1D,d1
										bra.s   loc_105B2
loc_105AE:
										
										move.w  #$2015,d1
loc_105B2:
										
										jsr     (CreateWindow).w
										move.w  d0,-$C(a6)
										bsr.w   sub_10748
										lea     (DMA_SPACE_FF8804).l,a1
										move.w  ((DISPLAYED_ICON_1-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										move.w  ((DISPLAYED_ICON_2-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										move.w  ((DISPLAYED_ICON_3-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										move.w  ((DISPLAYED_ICON_4-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										clr.w   d6
										bsr.w   sub_10800
										bsr.w   sub_10820
										bsr.w   sub_1084A
										bsr.w   sub_10920
										move.w  -$C(a6),d0
										move.w  #$C15,d1
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.l  -8(a6),d0
										beq.s   loc_10614
										movea.l d0,a0
										jsr     (a0)
loc_10614:
										
										moveq   #$1E,d6
loc_10616:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10630
										moveq   #1,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_2-$1000000)).w 
										beq.s   loc_10630
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_106B4
loc_10630:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1064A
										moveq   #2,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_3-$1000000)).w 
										beq.s   loc_1064A
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_106B4
loc_1064A:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1065C
										clr.w   d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_106B4
loc_1065C:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10676
										moveq   #3,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_4-$1000000)).w 
										beq.s   loc_10676
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_106B4
loc_10676:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1068C
										moveq   #$FFFFFFFF,d6
										moveq   #$FFFFFFFF,d0
										move.b  #$FF,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bra.w   loc_10710
loc_1068C:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_106A0
										clr.w   d6
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_106FE
loc_106A0:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_106E8
										clr.w   d6
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_106FE
loc_106B4:
										
										move.w  d1,-(sp)
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										clr.w   d6
										bsr.w   SomethingRelatedToMenuChoiceAgain
										move.w  (sp)+,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bsr.w   sub_10748
										move.l  -8(a6),d0
										beq.s   loc_106D6
										movea.l d0,a0
										jsr     (a0)
loc_106D6:
										
										move.w  -$C(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										move.l  -8(a6),d0
										moveq   #$1D,d6
loc_106E8:
										
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   SomethingRelatedToMenuChoiceAgain
										subq.w  #1,d6
										bne.s   loc_106F6
										moveq   #$1E,d6
loc_106F6:
										
										jsr     (WaitForVInt).w 
										bra.w   loc_10616
loc_106FE:
										
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										move.w  d0,d1
										add.w   d0,d0
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										move.w  (a0,d0.w),d0
loc_10710:
										
										movem.w d0-d1,-(sp)
										move.w  -$C(a6),d0
										tst.w   d6
										beq.s   loc_10722
										move.w  #$C1D,d1
										bra.s   loc_10726
loc_10722:
										
										move.w  #$2015,d1
loc_10726:
										
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  -$C(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										movem.w (sp)+,d0-d1
										unlk    a6
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										move.w  (sp)+,d6
										rts

	; End of function sub_10586


; =============== S U B R O U T I N E =======================================

sub_10748:
										
										lea     UnidentifiedLayout02(pc), a0
										move.w  -$C(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  #$D8,d7 
										jsr     (CopyBytes).w   
										lsl.w   #1,d0
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										andi.w  #3,d0
										lsl.w   #1,d0
										move.w  (a0,d0.w),d1
										cmpi.w  #$80,d1 
										bne.s   loc_10798
										move.w  #ITEMIDX_NOTHING,((word_FFB18C-$1000000)).w
										move.w  -$C(a6),d0
										move.w  #$903,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										lea     aNothing(pc), a0
										moveq   #$FFFFFFDC,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										bra.s   return_107D4
loc_10798:
										
										move.w  d1,((word_FFB18C-$1000000)).w
										move.w  d1,-(sp)
										jsr     j_FindItemName
										move.w  -$C(a6),d0
										move.w  #$902,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										moveq   #$FFFFFFDC,d1
										bsr.w   WriteTilesFromASCII
										move.w  (sp)+,d1
										tst.b   d1
										bpl.s   return_107D4
										lea     aEquipped(pc), a0
										move.w  -$C(a6),d0
										move.w  #$904,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										moveq   #$FFFFFFDC,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
return_107D4:
										
										rts

	; End of function sub_10748

aEquipped:          dc.b '\Equipped',0
aNothing:           dc.b '\Nothing',0
										dc.b $FF

; =============== S U B R O U T I N E =======================================

SomethingRelatedToMenuChoiceAgain:
										
										andi.w  #3,d0
										add.w   d0,d0
										move.w  rjt_107F8(pc,d0.w),d0
										jmp     rjt_107F8(pc,d0.w)

	; End of function SomethingRelatedToMenuChoiceAgain

rjt_107F8:          dc.w sub_10800-rjt_107F8
										dc.w sub_10820-rjt_107F8
										dc.w sub_1084A-rjt_107F8
										dc.w sub_10920-rjt_107F8

; =============== S U B R O U T I N E =======================================

sub_10800:
										
										lea     (DMA_SPACE_FF8804).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_10810
										adda.w  #$C0,a0 
loc_10810:
										
										lea     ($B800).l,a1
										move.w  #$60,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function sub_10800


; =============== S U B R O U T I N E =======================================

sub_10820:
										
										lea     (byte_FF8984).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_10830
										adda.w  #$C0,a0 
loc_10830:
										
										lea     (byte_FF8E04).l,a1
										bsr.w   sub_10874
										lea     ($B8C0).l,a1
										move.w  #$80,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function sub_10820


; =============== S U B R O U T I N E =======================================

sub_1084A:
										
										lea     (byte_FF8B04).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_1085A
										adda.w  #$C0,a0 
loc_1085A:
										
										lea     (byte_FF8F04).l,a1
										bsr.w   sub_108CA
										lea     ($BA80).l,a1
										move.w  #$80,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function sub_1084A


; =============== S U B R O U T I N E =======================================

sub_10874:
										
										move.l  a1,-(sp)
										move.l  a0,-(sp)
										lea     MenuHBarTiles(pc), a0
										moveq   #3,d7
loc_1087E:
										
										move.l  $20(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_1087E
										movea.l (sp)+,a0
										moveq   #5,d7
loc_1088E:
										
										move.l  (a0)+,(a1)
										move.l  (a0)+,4(a1)
										move.l  (a0)+,8(a1)
										move.l  (a0)+,$C(a1)
										move.l  (a0)+,$30(a1)
										move.l  (a0)+,$34(a1)
										move.l  (a0)+,$38(a1)
										move.l  (a0)+,$3C(a1)
										adda.w  #$20,a1 
										dbf     d7,loc_1088E
										lea     unk_11336(pc), a0
										moveq   #3,d7
loc_108BA:
										
										move.l  $20(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_108BA
										movea.l (sp)+,a0
										rts

	; End of function sub_10874


; =============== S U B R O U T I N E =======================================

sub_108CA:
										
										move.l  a1,-(sp)
										move.l  a0,-(sp)
										lea     unk_11366(pc), a0
										moveq   #3,d7
loc_108D4:
										
										move.l  $20(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_108D4
										movea.l (sp)+,a0
										moveq   #5,d7
loc_108E4:
										
										move.l  (a0)+,(a1)
										move.l  (a0)+,4(a1)
										move.l  (a0)+,8(a1)
										move.l  (a0)+,$C(a1)
										move.l  (a0)+,$30(a1)
										move.l  (a0)+,$34(a1)
										move.l  (a0)+,$38(a1)
										move.l  (a0)+,$3C(a1)
										adda.w  #$20,a1 
										dbf     d7,loc_108E4
										lea     unk_11396(pc), a0
										moveq   #3,d7
loc_10910:
										
										move.l  $20(a0),$20(a1)
										move.l  (a0)+,(a1)+
										dbf     d7,loc_10910
										movea.l (sp)+,a0
										rts

	; End of function sub_108CA


; =============== S U B R O U T I N E =======================================

sub_10920:
										
										lea     (byte_FF8C84).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_10930
										adda.w  #$C0,a0 
loc_10930:
										
										lea     ($B9C0).l,a1
										move.w  #$60,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function sub_10920


; =============== S U B R O U T I N E =======================================

;     Copy spell icon to RAM.
;     In: A1 = dest in RAM
;         D0 = spell idx
;     Out: A1 = end of affected section after copy

LoadIHighlightableSpellIcon:
										
										andi.w  #$3F,d0 
										cmpi.w  #$3F,d0 
										bne.s   loc_10950
										move.w  #$7F,d0 
										bra.s   loc_10954
loc_10950:
										
										addi.w  #$82,d0 
loc_10954:
										
										bra.w   LoadHighlightableIcon

	; End of function LoadIHighlightableSpellIcon


; =============== S U B R O U T I N E =======================================

LoadHighlightableItemIcon:
										
										cmpi.w  #$80,d0 
										beq.s   LoadHighlightableIcon
										andi.w  #$7F,d0 

	; End of function LoadHighlightableItemIcon


; =============== S U B R O U T I N E =======================================

LoadHighlightableIcon:
										
										adda.w  #$C0,a1 
										mulu.w  #$C0,d0 
										movea.l (p_Icons).l,a0
										adda.w  d0,a0           ; icon offset
										move.w  #$2F,d1 
										lea     IconHighlightTiles(pc), a2
loc_1097A:
										
										move.l  (a0)+,d0
										move.l  d0,-$C0(a1)
										and.l   (a2)+,d0
										move.l  d0,(a1)+
										dbf     d1,loc_1097A
										rts

	; End of function LoadHighlightableIcon

IconHighlightTiles: incbin "graphics/technical/iconhighlighttiles.bin"

; =============== S U B R O U T I N E =======================================

sub_10A4A:
										
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										link    a6,#-$C
										move.w  d2,-4(a6)
										move.l  a0,-8(a6)
										move.w  d1,-$A(a6)
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										move.w  #$1206,d0
										tst.w   d1
										bne.s   loc_10A70
										move.w  #$C1D,d1
										bra.s   loc_10A74
loc_10A70:
										
										move.w  #$2015,d1
loc_10A74:
										
										jsr     (CreateWindow).w
										move.w  d0,-$C(a6)
										bsr.w   sub_10C22
										lea     (DMA_SPACE_FF8804).l,a1
										move.w  ((DISPLAYED_ICON_1-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										move.w  ((DISPLAYED_ICON_2-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										move.w  ((DISPLAYED_ICON_3-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										move.w  ((DISPLAYED_ICON_4-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										clr.w   d6
										bsr.w   sub_10800
										bsr.w   sub_10820
										bsr.w   sub_1084A
										bsr.w   sub_10920
										move.w  -$C(a6),d0
										move.w  #$C15,d1
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
loc_10ACC:
										
										move.l  -8(a6),d0
										beq.s   loc_10AD6
										movea.l d0,a0
										jsr     (a0)
loc_10AD6:
										
										moveq   #$1E,d6
loc_10AD8:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10AF2
										moveq   #1,d1
										cmpi.w  #$3F,((DISPLAYED_ICON_2-$1000000)).w 
										beq.s   loc_10AF2
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10B76
loc_10AF2:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10B0C
										moveq   #2,d1
										cmpi.w  #$3F,((DISPLAYED_ICON_3-$1000000)).w 
										beq.s   loc_10B0C
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10B76
loc_10B0C:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10B1E
										clr.w   d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10B76
loc_10B1E:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10B38
										moveq   #3,d1
										cmpi.w  #$3F,((DISPLAYED_ICON_4-$1000000)).w 
										beq.s   loc_10B38
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_10B76
loc_10B38:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10B4E
										moveq   #$FFFFFFFF,d1
										moveq   #$FFFFFFFF,d0
										move.b  #$FF,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bra.w   loc_10BEC
loc_10B4E:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10B62
										clr.w   d1
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_10BBC
loc_10B62:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10BA6
										clr.w   d1
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_10BBC
loc_10B76:
										
										move.w  d1,-(sp)
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										clr.w   d6
										bsr.w   DoSomethingRelatedToMenuChoiceBis
										move.w  (sp)+,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bsr.w   sub_10C22
										move.w  -$C(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										move.l  -8(a6),d0
										beq.s   loc_10BA4
										movea.l d0,a0
										jsr     (a0)
loc_10BA4:
										
										moveq   #$1D,d6
loc_10BA6:
										
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   DoSomethingRelatedToMenuChoiceBis
										subq.w  #1,d6
										bne.s   loc_10BB4
										moveq   #$1E,d6
loc_10BB4:
										
										jsr     (WaitForVInt).w 
										bra.w   loc_10AD8
loc_10BBC:
										
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										add.w   d0,d0
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										move.w  (a0,d0.w),d0
										bsr.w   sub_10CC6
										cmpi.w  #$FFFF,d0
										bne.w   loc_10BEC
										bsr.w   sub_10C22
										move.w  -$C(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										bra.w   loc_10ACC
loc_10BEC:
										
										movem.w d0-d1,-(sp)
										move.w  -$C(a6),d0
										tst.w   d1
										beq.s   loc_10BFE
										move.w  #$C1D,d1
										bra.s   loc_10C02
loc_10BFE:
										
										move.w  #$2015,d1
loc_10C02:
										
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  -$C(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										movem.w (sp)+,d0-d1
										unlk    a6
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function sub_10A4A


; =============== S U B R O U T I N E =======================================

sub_10C22:
										
										lea     UnidentifiedLayout01(pc), a0
										move.w  -$C(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  #$D8,d7 
										jsr     (CopyBytes).w   
										lsl.w   #1,d0
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										andi.w  #3,d0
										lsl.w   #1,d0
										move.w  (a0,d0.w),d1
										move.w  d1,((word_FFB18C-$1000000)).w
										move.w  d1,-(sp)
										jsr     j_FindSpellName
										move.w  -$C(a6),d0
										move.w  #$902,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										moveq   #$FFFFFFDC,d1
										bsr.w   WriteTilesFromASCII
										move.w  -$C(a6),d0
										move.w  #$903,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  (sp)+,d1
										move.w  d1,-(sp)
										lea     unk_110E4(pc), a0
										andi.w  #$C0,d1 
										move.w  d1,d2
										add.w   d1,d1
										add.w   d2,d1
										lsr.w   #4,d1
										adda.w  d1,a0
										moveq   #$C,d7
										jsr     (CopyBytes).w   
										move.w  -$C(a6),d0
										move.w  #$C04,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  (sp)+,d1
										jsr     j_GetSpellCost
										move.w  d1,d0
										moveq   #3,d7
										bsr.w   WriteTilesFromNumber
										rts

	; End of function sub_10C22


; =============== S U B R O U T I N E =======================================

DoSomethingRelatedToMenuChoiceBis:
										
										andi.w  #3,d0
										add.w   d0,d0
										move.w  rjt_10CBE(pc,d0.w),d0
										jmp     rjt_10CBE(pc,d0.w)

	; End of function DoSomethingRelatedToMenuChoiceBis

rjt_10CBE:          dc.w sub_10800+$10000-rjt_10CBE
										dc.w sub_10820+$10000-rjt_10CBE
										dc.w sub_1084A+$10000-rjt_10CBE
										dc.w sub_10920+$10000-rjt_10CBE

; =============== S U B R O U T I N E =======================================

sub_10CC6:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										move.w  d0,-(sp)
										lea     TextHighlightTiles(pc), a0
										lea     ($BC00).l,a1
										move.w  #$A0,d0 
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										move.w  (sp)+,d0
										move.w  d0,d4
										lsr.w   #6,d4
										move.w  d4,d5
										andi.w  #$3F,d0 
										jsr     (WaitForVInt).w 
loc_10CF4:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10D0A
										subq.w  #1,d5
										cmpi.w  #$FFFF,d5
										bne.s   loc_10D06
										move.w  d4,d5
loc_10D06:
										
										bra.w   sub_10D56
loc_10D0A:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10D1E
										addq.w  #1,d5
										cmp.w   d4,d5
										ble.s   loc_10D1A
										clr.w   d5
loc_10D1A:
										
										bra.w   sub_10D56
loc_10D1E:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10D32
										moveq   #$FFFFFFFF,d0
										jsr     (WaitForVInt).w 
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										rts
loc_10D32:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_10D3E
										bra.w   loc_10D48
loc_10D3E:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.w   loc_10DC0
loc_10D48:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										lsl.w   #6,d5
										or.w    d5,d0
										jsr     (WaitForVInt).w 
										rts

	; End of function sub_10CC6


; =============== S U B R O U T I N E =======================================

sub_10D56:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										movem.w d0-d5,-(sp)
										lsl.w   #2,d4
										add.w   d5,d4
										lsl.w   #2,d4
										lea     pt_SpellLevelBarTiles(pc), a0
										nop
										movea.l (a0,d4.w),a0
										move.w  d0,-(sp)
										move.w  -$C(a6),d0
										move.w  #$903,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  #$C,d7
										jsr     (CopyBytes).w   
										move.w  (sp)+,d1
										lsl.w   #6,d5
										andi.w  #$3F,d1 
										or.w    d5,d1
										move.w  d1,((word_FFB18C-$1000000)).w
										jsr     j_GetSpellCost
										move.w  d1,d0
										moveq   #3,d7
										adda.w  #$2A,a1 
										bsr.w   WriteTilesFromNumber
										move.l  -8(a6),d0
										beq.s   loc_10DAE
										movea.l d0,a0
										jsr     (a0)
loc_10DAE:
										
										move.w  -$C(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										movem.w (sp)+,d0-d5
										moveq   #$13,d6
loc_10DC0:
										
										bsr.w   sub_10DE2
										jsr     (WaitForVInt).w 
										subq.w  #1,d6
										bne.s   loc_10DCE
										moveq   #$14,d6
loc_10DCE:
										
										bra.w   loc_10CF4

	; End of function sub_10D56

dword_10DD2:        dc.l $13C0D09
										dc.l $C5E00124
										dc.l $13C0D10
										dc.l $CDE0013C

; =============== S U B R O U T I N E =======================================

sub_10DE2:
										
										lea     (byte_FFDCC0).l,a1
										lea     dword_10DD2(pc), a0
										move.l  (a0)+,(a1)+
										move.l  (a0)+,(a1)+
										move.l  (a0)+,(a1)+
										move.l  (a0)+,(a1)+
										cmpi.w  #$A,d6
										bge.s   loc_10E06
										move.w  #1,-$10(a1)
										move.w  #1,-8(a1)
loc_10E06:
										
										tst.b   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										beq.s   loc_10E18
										move.w  #1,-$10(a1)
										move.w  #1,-8(a1)
loc_10E18:
										
										bra.w   sub_101E6

	; End of function sub_10DE2

DiamondMenuLayout:  incbin "graphics/technical/menus/diamondmenulayout.bin"
																						; tile layout for diamond menus
UnidentifiedLayout01:
										incbin "graphics/technical/menus/unidentifiedlayout01.bin"
UnidentifiedLayout02:
										incbin "graphics/technical/menus/unidentifiedlayout02.bin"
pt_SpellLevelBarTiles:
										dc.l unk_110E4
										dc.l unk_110E4
										dc.l unk_110E4
										dc.l unk_110E4
										dc.l unk_11114
										dc.l unk_110F0
										dc.l unk_110F0
										dc.l unk_110F0
										dc.l unk_11138
										dc.l unk_11120
										dc.l unk_110FC
										dc.l unk_110FC
										dc.l unk_11150
										dc.l unk_11144
										dc.l unk_1112C
										dc.l unk_11108
unk_110E4:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F1 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
unk_110F0:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F2 
										dc.b $C8 
										dc.b $F0 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
unk_110FC:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F2 
										dc.b $C8 
										dc.b $F0 
										dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F1 
										dc.b $C0 
										dc.b $20
unk_11108:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F2 
										dc.b $C8 
										dc.b $F0 
										dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F2 
										dc.b $C8 
										dc.b $F0 
unk_11114:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F5 
										dc.b $C0 
										dc.b $F4 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
unk_11120:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F2 
										dc.b $C8 
										dc.b $F0 
										dc.b $C8 
										dc.b $F4 
										dc.b $C0 
										dc.b $F7 
										dc.b $C0 
										dc.b $20
unk_1112C:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F2 
										dc.b $C8 
										dc.b $F0 
										dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F5 
										dc.b $C0 
										dc.b $F4 
unk_11138:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F5 
										dc.b $C0 
										dc.b $F4 
										dc.b $C8 
										dc.b $F4 
										dc.b $C0 
										dc.b $F7 
										dc.b $C0 
										dc.b $20
unk_11144:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F2 
										dc.b $C8 
										dc.b $F0 
										dc.b $C8 
										dc.b $F4 
										dc.b $C0 
										dc.b $F6 
										dc.b $C0 
										dc.b $F4 
unk_11150:          dc.b $C0 
										dc.b $F0 
										dc.b $C0 
										dc.b $F5 
										dc.b $C0 
										dc.b $F4 
										dc.b $C8 
										dc.b $F4 
										dc.b $C0 
										dc.b $F6 
										dc.b $C0 
										dc.b $F4 
unk_1115C:          dc.b $85 
										dc.b   1
										dc.b   2
										dc.b   4
										dc.b $80 
										dc.b   1
										dc.b   2
										dc.b   3
										dc.b $80 
										dc.b   1
										dc.b   2
										dc.b   4
										dc.l p_MenuTiles_Item
										dc.l p_MenuTiles_BattleField
										dc.l p_Menutiles_Church
										dc.l p_MenuTiles_Shop
										dc.l p_MenuTiles_Caravan
										dc.l p_MenuTiles_Depot
pt_MenuOptions:     dc.l pt_FieldMenu_Names
										dc.l pt_BattleMenu_Names
										dc.l pt_BattleMenuOverItem_Names
										dc.l pt_ItemMenu_Names
										dc.l pt_BattlefieldMenu_Names
										dc.l pt_ChurchMenu_Names
										dc.l pt_ShopMenu_Names
										dc.l pt_CaravanMenu_Names
										dc.l pt_DepotMenu_Names
pt_FieldMenu_Names: dc.l aMember            
										dc.l aMagic             
										dc.l aItem              
										dc.l aSearch            
aMember:            dc.b 'MEMBER',0
aMagic:             dc.b 'MAGIC',0
aItem:              dc.b 'ITEM',0
aSearch:            dc.b 'SEARCH',0
										dc.b $FF
pt_BattleMenu_Names:dc.l aAttack_0          
										dc.l aMagic_0           
										dc.l aItem_0            
										dc.l aStay              
aAttack_0:          dc.b 'ATTACK',0
aMagic_0:           dc.b 'MAGIC',0
aItem_0:            dc.b 'ITEM',0
aStay:              dc.b 'STAY',0
										dc.b $FF
pt_BattleMenuOverItem_Names:
										dc.l aAttack_1          
										dc.l aMagic_1           
										dc.l aItem_1            
										dc.l aSearch_0          
aAttack_1:          dc.b 'ATTACK',0
aMagic_1:           dc.b 'MAGIC',0
aItem_1:            dc.b 'ITEM',0
aSearch_0:          dc.b 'SEARCH',0
										dc.b $FF
pt_ItemMenu_Names:  dc.l aUse               
										dc.l aGive              
										dc.l aEquip             
										dc.l aDrop              
aUse:               dc.b 'USE',0
aGive:              dc.b 'GIVE',0
aEquip:             dc.b 'EQUIP',0
aDrop:              dc.b 'DROP',0
pt_BattlefieldMenu_Names:
										dc.l aMember_0          
										dc.l aMap               
										dc.l aSpeed_0           
										dc.l aQuit              
aMember_0:          dc.b 'MEMBER',0
aMap:               dc.b 'MAP',0
aSpeed_0:           dc.b 'SPEED',0
aQuit:              dc.b 'QUIT',0
pt_ChurchMenu_Names:dc.l aRaise             
										dc.l aCure              
										dc.l aPromo_            
										dc.l aSave              
aRaise:             dc.b 'RAISE',0
aCure:              dc.b 'CURE',0
aPromo_:            dc.b 'PROMO.',0
aSave:              dc.b 'SAVE',0
										dc.b $FF
pt_ShopMenu_Names:  dc.l aBuy               
										dc.l aSell              
										dc.l aRepair            
										dc.l aDeals             
aBuy:               dc.b 'BUY',0
aSell:              dc.b 'SELL',0
aRepair:            dc.b 'REPAIR',0
aDeals:             dc.b 'DEALS',0
pt_CaravanMenu_Names:
										dc.l aJoin              
										dc.l aDepot             
										dc.l aItem_2            
										dc.l aPurge             
aJoin:              dc.b 'JOIN',0
aDepot:             dc.b 'DEPOT',0
aItem_2:            dc.b 'ITEM',0
aPurge:             dc.b 'PURGE',0
pt_DepotMenu_Names: dc.l aLook              
										dc.l aDepos_            
										dc.l aDerive            
										dc.l aDrop_0            
aLook:              dc.b 'LOOK',0
aDepos_:            dc.b 'DEPOS.',0
aDerive:            dc.b 'DERIVE',0
aDrop_0:            dc.b 'DROP',0
MenuHBarTiles:      dc.b   2
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $2C 
										dc.b $CB 
										dc.b $BB 
										dc.b $BB 
										dc.b   2
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.l $22222222
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BC 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
unk_11336:          dc.b   2
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $2C 
										dc.b $CB 
										dc.b $BB 
										dc.b $BB 
										dc.b $22 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b   2
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.l $22222222
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
unk_11366:          dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.l $22222220
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $22 
										dc.b $BB 
										dc.b $BB 
										dc.b $BC 
										dc.b $C2 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $20
unk_11396:          dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $CB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.l $22222220
										dc.b $BB 
										dc.b $BB 
										dc.b $BC 
										dc.b $C2 
										dc.b $CC 
										dc.b $CC 
										dc.b $CC 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $22 
										dc.b $20

; =============== S U B R O U T I N E =======================================

sub_113C6:
										
										movem.l d0-a2,-(sp)
										move.w  #$A09,d0
										move.w  #$F612,d1
										jsr     (CreateWindow).w
										move.w  d0,((byte_FFB18E-$1000000)).w
										lea     BattleEquipWindowLayout(pc), a0
										move.w  #$B4,d7 
										jsr     (CopyBytes).w   
										bsr.w   DrawBattleEquipWindowStats
										move.w  ((byte_FFB18E-$1000000)).w,d0
										move.w  #$212,d1
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										movem.l (sp)+,d0-a2
										rts

	; End of function sub_113C6


; =============== S U B R O U T I N E =======================================

sub_11404:
										
										movem.l d0-a2,-(sp)
										bsr.w   DrawBattleEquipWindowStats
										move.w  ((byte_FFB18E-$1000000)).w,d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										movem.l (sp)+,d0-a2
										rts

	; End of function sub_11404


; =============== S U B R O U T I N E =======================================

sub_1141E:
										
										movem.l d0-a2,-(sp)
										move.w  ((byte_FFB18E-$1000000)).w,d0
										move.w  #$F612,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  ((byte_FFB18E-$1000000)).w,d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										movem.l (sp)+,d0-a2
										rts

	; End of function sub_1141E


; =============== S U B R O U T I N E =======================================

DrawBattleEquipWindowStats:
										
										link    a6,#-4
										move.w  ((byte_FFB18E-$1000000)).w,d0
										move.w  #$701,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.l  a1,-4(a6)
										move.w  ((MOVING_BATTLE_ENTITY_IDX-$1000000)).w,d0
										jsr     j_GetCurrentATK
										move.w  d1,d0
										movea.l -4(a6),a1
										moveq   #2,d7
										bsr.w   WriteStatValue  
										move.w  ((MOVING_BATTLE_ENTITY_IDX-$1000000)).w,d0
										jsr     j_GetCurrentDEF
										move.w  d1,d0
										movea.l -4(a6),a1
										adda.w  #$28,a1 
										moveq   #2,d7
										bsr.w   WriteStatValue  
										move.w  ((MOVING_BATTLE_ENTITY_IDX-$1000000)).w,d0
										jsr     j_GetCurrentAGI
										move.w  d1,d0
										movea.l -4(a6),a1
										adda.w  #$50,a1 
										moveq   #2,d7
										bsr.w   WriteStatValue  
										move.w  ((MOVING_BATTLE_ENTITY_IDX-$1000000)).w,d0
										jsr     j_GetCurrentMOV
										move.w  d1,d0
										movea.l -4(a6),a1
										adda.w  #$78,a1 
										moveq   #2,d7
										bsr.w   WriteStatValue  
										unlk    a6
										rts

	; End of function DrawBattleEquipWindowStats

BattleEquipWindowLayout:
										incbin "graphics/technical/windowlayouts/battleequipwindowlayout.bin"

; =============== S U B R O U T I N E =======================================

CreateFighterMiniStatusWindow:
										
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										movem.l d0-a2,-(sp)
										move.w  d0,-(sp)
										move.w  #$1605,d0
										move.w  #$2001,d1
										lea     ((FIGHTER_MINISTATUS_WINDOW_IDX-$1000000)).w,a2
										tst.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										beq.s   loc_11594
										addq.l  #2,a2
										addi.w  #$15,d1
loc_11594:
										
										jsr     (CreateWindow).w
										move.w  d0,(a2)
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  (sp)+,d0
										bsr.w   sub_118BE
										move.w  #1,d1
										move.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,d3
										move.w  #$1F,d4
										sub.w   d3,d4
										lsl.w   #8,d4
										or.w    d4,d1
										moveq   #4,d2
										tst.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										beq.s   loc_115C4
										addi.w  #$15,d1
loc_115C4:
										
										move.w  (a2),d0
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVInt).w 
										bsr.w   sub_11804
										jsr     (WaitForVint_andFFA900Clear).w
										movem.l (sp)+,d0-a2
										rts

	; End of function CreateFighterMiniStatusWindow


; =============== S U B R O U T I N E =======================================

HideFighterMiniStatusWindow:
										
										movem.l d0-a2,-(sp)
										lea     ((FIGHTER_MINISTATUS_WINDOW_IDX-$1000000)).w,a2
										tst.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										beq.s   loc_115F0
										addq.l  #2,a2
loc_115F0:
										
										move.w  (a2),d0
										move.w  #$2001,d1
										tst.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										beq.s   loc_11600
										addi.w  #$15,d1
loc_11600:
										
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  (a2),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										movem.l (sp)+,d0-a2
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function HideFighterMiniStatusWindow


; =============== S U B R O U T I N E =======================================

sub_1161A:
										
										jsr     (InitWindowProperties).w
										move.w  #$1605,d0
										move.w  #$2001,d1
										jsr     (CreateWindow).w
										move.w  #$1605,d0
										move.w  #$2001,d1
										jsr     (CreateWindow).w
										rts

	; End of function sub_1161A


; =============== S U B R O U T I N E =======================================

sub_11638:
										
										cmpi.b  #$FF,d0
										beq.w   return_11714
										movem.l d0-a1,-(sp)
										move.w  d1,-(sp)
										clr.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										movem.w d0,-(sp)
										clr.w   d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										movem.w (sp)+,d0
										bsr.w   sub_118BE
										move.w  (sp)+,d1
										bne.s   loc_11670
										move.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,d3
										move.w  #$1F,d1
										sub.w   d3,d1
										lsl.w   #8,d1
										bra.s   loc_11674
loc_11670:
										
										move.w  #$100,d1
loc_11674:
										
										ori.w   #1,d1
										clr.w   d0
										moveq   #1,d2
										jsr     (MoveWindowWithoutSFX).l
										jsr     (WaitForVInt).w 
										bsr.w   sub_11804
										jsr     (WaitForVint_andFFA900Clear).w
										movem.l (sp)+,d0-a1
										rts
loc_11694:
										
										cmpi.b  #$FF,d0
										beq.w   return_11714
										movem.l d0-a1,-(sp)
										clr.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										clr.w   d0
										move.w  #$2006,d1
										moveq   #1,d2
										jsr     (MoveWindowWithoutSFX).l
										movem.l (sp)+,d0-a1
										rts
loc_116B8:
										
										cmpi.b  #$FF,d0
										beq.w   return_11714
										movem.l d0-a1,-(sp)
										move.w  d1,-(sp)
										move.b  #$FF,((FIGHTER_IS_TARGETTING-$1000000)).w
										movem.w d0,-(sp)
										moveq   #1,d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										movem.w (sp)+,d0
										bsr.w   sub_118BE
										move.w  (sp)+,d1
										beq.s   loc_116F2
										move.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,d3
										move.w  #$1F,d1
										sub.w   d3,d1
										lsl.w   #8,d1
										bra.s   loc_116F6
loc_116F2:
										
										move.w  #$100,d1
loc_116F6:
										
										ori.w   #$14,d1
										moveq   #1,d0
										moveq   #1,d2
										jsr     (MoveWindowWithoutSFX).l
										jsr     (WaitForVInt).w 
										bsr.w   sub_11804
										jsr     (WaitForVint_andFFA900Clear).w
										movem.l (sp)+,d0-a1
return_11714:
										
										rts

	; End of function sub_11638


; =============== S U B R O U T I N E =======================================

sub_11716:
										
										cmpi.b  #$FF,d0
										beq.s   return_11714
										movem.l d0-a1,-(sp)
										move.b  #$FF,((FIGHTER_IS_TARGETTING-$1000000)).w
										moveq   #1,d0
										move.w  #$2006,d1
										moveq   #1,d2
										jsr     (MoveWindowWithoutSFX).l
										movem.l (sp)+,d0-a1
										rts

	; End of function sub_11716


; =============== S U B R O U T I N E =======================================

DrawColoredStatBar:
										
										movem.l d0-a1,-(sp)
										tst.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										beq.s   loc_11748
										addi.w  #$A,d2
loc_11748:
										
										ori.w   #VDPTILE_PALETTE3_MASK,d2
										cmp.w   d0,d1
										bge.s   loc_11752
										move.w  d0,d1
loc_11752:
										
										move.l  a0,-(sp)
										moveq   #$6F,d7 
loc_11756:
										
										clr.l   (a0)+
										dbf     d7,loc_11756
										movea.l (sp)+,a0
										clr.w   d7
										moveq   #1,d4
										bsr.w   sub_11862       
										clr.w   d4
										bsr.w   sub_11862       
										ext.l   d0
										divs.w  #$64,d0 
										move.w  d0,d4
										addq.w  #3,d4
										clr.w   d6
										swap    d0
										cmpi.w  #$64,d1 
										ble.s   loc_11784
										moveq   #$63,d3 
										bra.s   loc_1178C
loc_11784:
										
										move.w  d1,d3
										subq.w  #1,d3
										bmi.w   loc_117A0
loc_1178C:
										
										cmp.w   d0,d6
										blt.s   loc_11796
										subq.w  #1,d4
										move.w  #$3E7,d0
loc_11796:
										
										bsr.w   sub_11862       
										addq.w  #1,d6
										dbf     d3,loc_1178C
loc_117A0:
										
										clr.w   d4
										bsr.w   sub_11862       
										moveq   #1,d4
										moveq   #$F,d3
loc_117AA:
										
										bsr.w   sub_11862       
										dbf     d3,loc_117AA
										movem.l d2/a0,-(sp)
										moveq   #$B,d7
										move.l  8(a0),d6
										move.w  d2,(a1)+
loc_117BE:
										
										lea     $20(a0),a0
										move.l  8(a0),d3
										cmpi.l  #$FFFFFFFF,d3
										beq.w   loc_117FA
										cmp.l   d3,d6
										bne.s   loc_117F0
										moveq   #$5F,d3 
										movem.l a0-a1,-(sp)
										movea.l a0,a1
										lea     $20(a1),a1
loc_117E0:
										
										move.l  (a1)+,(a0)+
										dbf     d3,loc_117E0
										movem.l (sp)+,a0-a1
										lea     -$20(a0),a0
										bra.s   loc_117F4
loc_117F0:
										
										move.l  d3,d6
										addq.w  #1,d2
loc_117F4:
										
										move.w  d2,(a1)+
										dbf     d7,loc_117BE
loc_117FA:
										
										movem.l (sp)+,d2/a0
										movem.l (sp)+,d0-a1
										rts

	; End of function DrawColoredStatBar


; =============== S U B R O U T I N E =======================================

sub_11804:
										
										movem.l d0-d2/a0-a1,-(sp)
										lea     (DMA_SPACE_FF8804).l,a0
										moveq   #1,d2
										bsr.w   sub_11826
										lea     (byte_FF8A04).l,a0
										moveq   #6,d2
										bsr.w   sub_11826
										movem.l (sp)+,d0-d2/a0-a1
										rts

	; End of function sub_11804


; =============== S U B R O U T I N E =======================================

sub_11826:
										
										tst.b   ((FIGHTER_IS_TARGETTING-$1000000)).w
										beq.s   loc_11830
										addi.w  #$A,d2
loc_11830:
										
										lsl.w   #5,d2
										movea.w d2,a1
										move.w  #$50,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function sub_11826

dword_1183E:        dc.l $F11111FF
										dc.l $FFFFFFFF
										dc.l $1AAAAA1F
										dc.l $1BBBBB1F
										dc.l $1555551F
										dc.l $1666661F
										dc.l $1222221F
										dc.l $1222221F
										dc.l $1222221F

; =============== S U B R O U T I N E =======================================

; write one column of HP/MP bar pixels into A1

sub_11862:
										
										movem.l d3-a0,-(sp)
										moveq   #7,d3
										move.w  d7,d6
										andi.w  #7,d6
										lsl.w   #2,d6
										lsr.w   #3,d7
										lsl.w   #5,d7
										lsl.w   #2,d4
										move.l  dword_1183E(pc,d4.w),d4
loc_1187A:
										
										move.l  d4,d5
										andi.l  #$F0000000,d5
										lsr.l   d6,d5
										or.l    d5,(a0,d7.w)
										rol.l   #4,d4
										addq.l  #4,a0
										dbf     d3,loc_1187A
										movem.l (sp)+,d3-a0
										addq.w  #1,d7
										rts

	; End of function sub_11862


; =============== S U B R O U T I N E =======================================

; check ASCII name at A0 for two special chars ???
; 

AdjustStringLengthForSpecialChars:
										
										movem.w d0/a0,-(sp)
										move.w  d7,d0
										subq.w  #1,d0
										bmi.w   return_118BC
loc_118A4:
										
										cmpi.b  #$9E,(a0)
										bne.s   loc_118AC
										subq.w  #1,d7
loc_118AC:
										
										cmpi.b  #$9F,(a0)+
										bne.s   loc_118B4
										subq.w  #1,d7
loc_118B4:
										
										dbf     d0,loc_118A4
										movem.w (sp)+,d0/a0
return_118BC:
										
										rts

	; End of function AdjustStringLengthForSpecialChars


; =============== S U B R O U T I N E =======================================

sub_118BE:
										
										link    a6,#-8
										move.l  a1,-8(a6)
										movem.l d7/a1,-(sp)
										move.w  #$36,d7 
loc_118CE:
										
										clr.l   (a1)+
										dbf     d7,loc_118CE
										movem.l (sp)+,d7/a1
										ext.w   d0
										move.w  d0,-2(a6)
										jsr     j_GetCurrentHP
										move.w  d1,d2
										jsr     j_GetMaxHP
										move.w  d1,d3
										movem.w d2-d3,-(sp)
										jsr     j_GetCurrentMP
										move.w  d1,d2
										jsr     j_GetMaxMP
										move.w  d1,d3
										movem.w (sp)+,d0-d1
										move.w  d1,d6
										cmp.w   d1,d3
										ble.s   loc_1190E
										move.w  d3,d6
loc_1190E:
										
										cmpi.w  #$64,d6 
										ble.s   loc_11916
										moveq   #$64,d6 
loc_11916:
										
										addq.w  #3,d6
										lsr.w   #3,d6
										addi.w  #$A,d6
										movem.w d0-d1/d7,-(sp)
										move.w  -2(a6),d0
										blt.s   loc_11958
										jsr     j_GetCharName
										bsr.w   AdjustStringLengthForSpecialChars
										move.w  d7,d4
										jsr     j_GetClass      
										jsr     j_GetClassName
										bsr.w   AdjustStringLengthForSpecialChars
										add.w   d7,d4
										addq.w  #4,d4
										jsr     j_GetCurrentLevel
										cmpi.w  #$A,d1
										blt.s   loc_11956
										addq.w  #1,d4
loc_11956:
										
										bra.s   loc_11966
loc_11958:
										
										jsr     j_GetCharName
										bsr.w   AdjustStringLengthForSpecialChars
										move.w  d7,d4
										addq.w  #2,d4
loc_11966:
										
										movem.w (sp)+,d0-d1/d7
										cmp.w   d4,d6
										bge.s   loc_11970
										move.w  d4,d6
loc_11970:
										
										move.w  d6,((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w
										lea     unk_11AEC(pc), a0
										movea.l -8(a6),a1
										bsr.w   CopyFighterMinistatusWindowTileColumn
										bsr.w   CopyFighterMinistatusWindowTileColumn
										bsr.w   CopyFighterMinistatusWindowTileColumn
										move.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,d7
										subi.w  #9,d7
loc_11990:
										
										lea     unk_11B0A(pc), a0
										nop
										bsr.w   CopyFighterMinistatusWindowTileColumn
										dbf     d7,loc_11990
										lea     unk_11B14(pc), a0
										nop
										bsr.w   CopyFighterMinistatusWindowTileColumn
										bsr.w   CopyFighterMinistatusWindowTileColumn
										bsr.w   CopyFighterMinistatusWindowTileColumn
										bsr.w   CopyFighterMinistatusWindowTileColumn
										bsr.w   CopyFighterMinistatusWindowTileColumn
										movem.w d0-d3,-(sp)
										move.w  -2(a6),d0
										jsr     j_GetCharName
										movea.l -8(a6),a1
										adda.w  #$2C,a1 
										addq.l  #2,a1
										moveq   #$FFFFFFD4,d1
										bsr.w   WriteTilesFromASCII
										addq.w  #2,a1
										move.w  -2(a6),d0
										blt.s   loc_11A0E
										jsr     j_GetClass      
										jsr     j_GetClassName
										move.w  #$FFD4,d1
										bsr.w   WriteTilesFromASCII
										move.w  -2(a6),d0
										jsr     j_GetCurrentLevel
										move.w  d1,d0
										ext.l   d0
										moveq   #2,d7
										cmpi.w  #$A,d0
										bge.s   loc_11A0A
										subq.w  #1,d7
loc_11A0A:
										
										bsr.w   WriteTilesFromNumber
loc_11A0E:
										
										movem.w (sp)+,d0-d3
										movem.w d0-d3,-(sp)
										movem.w d2-d3,-(sp)
										movea.l -8(a6),a1
										adda.w  #$58,a1 
										addq.w  #6,a1
										move.l  a1,-(sp)
										lea     (DMA_SPACE_FF8804).l,a0
										moveq   #1,d2
										bsr.w   DrawColoredStatBar
										movea.l (sp)+,a1
										adda.w  #$2C,a1 
										movem.w (sp)+,d0-d1
										tst.w   d1
										beq.s   loc_11A4C
										lea     (byte_FF8A04).l,a0
										moveq   #6,d2
										bsr.w   DrawColoredStatBar
loc_11A4C:
										
										movem.w (sp)+,d0-d3
										ext.l   d0
										movea.l -8(a6),a1
										adda.w  #$58,a1 
										move.l  a1,-(sp)
										adda.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,a1
										adda.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,a1
										suba.w  #$C,a1
										move.l  a1,-(sp)
										moveq   #2,d7
										bsr.w   WriteStatValue  
										movea.l (sp)+,a1
										addq.l  #6,a1
										move.w  d1,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										movea.l (sp)+,a1
										adda.w  #$2C,a1 
										adda.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,a1
										adda.w  ((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w,a1
										suba.w  #$C,a1
										move.l  a1,-(sp)
										move.w  d2,d0
										ext.l   d0
										movea.l (sp)+,a1
										moveq   #2,d7
										bsr.w   WriteStatValue  
										addq.l  #2,a1
										move.w  d3,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										unlk    a6
										rts

	; End of function sub_118BE


; =============== S U B R O U T I N E =======================================

; display d0 stat value or "??" if above 99

WriteStatValue:
										
										cmpi.w  #$64,d0 
										bge.s   loc_11ABC
										ext.l   d0
										bra.w   WriteTilesFromNumber
										bra.s   UnknownValue    
loc_11ABC:
										
										lea     UnknownValue(pc), a0
										bra.w   WriteTilesFromASCII

	; End of function WriteStatValue

UnknownValue:       dc.b '??'

; =============== S U B R O U T I N E =======================================

; draw tiles from A0 into A1 (one column)

CopyFighterMinistatusWindowTileColumn:
										
										movem.l a1,-(sp)
										move.w  (a0)+,(a1)
										adda.w  #$2C,a1 
										move.w  (a0)+,(a1)
										adda.w  #$2C,a1 
										move.w  (a0)+,(a1)
										adda.w  #$2C,a1 
										move.w  (a0)+,(a1)
										adda.w  #$2C,a1 
										move.w  (a0)+,(a1)
										movem.l (sp)+,a1
										addq.w  #2,a1
										rts

	; End of function CopyFighterMinistatusWindowTileColumn

unk_11AEC:          dc.b $C0 
										dc.b $60 
										dc.b $C0 
										dc.b $70 
										dc.b $C0 
										dc.b $70 
										dc.b $C0 
										dc.b $70 
										dc.b $D0 
										dc.b $60 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $48 
										dc.b $C0 
										dc.b $4D 
										dc.b $D0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $50 
										dc.b $C0 
										dc.b $50 
										dc.b $D0 
										dc.b $61 
unk_11B0A:          dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $D0 
										dc.b $61 
unk_11B14:          dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $30 
										dc.b $C0 
										dc.b $30 
										dc.b $D0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $2F 
										dc.b $C0 
										dc.b $2F 
										dc.b $D0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $D0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $30 
										dc.b $C0 
										dc.b $30 
										dc.b $D0 
										dc.b $61 
										dc.b $C8 
										dc.b $60 
										dc.b $C8 
										dc.b $70 
										dc.b $C8 
										dc.b $70 
										dc.b $C8 
										dc.b $70 
										dc.b $D8 
										dc.b $60 

; =============== S U B R O U T I N E =======================================

InitPortraitWindow:
										
										tst.w   ((PORTRAIT_WINDOW_INDEX-$1000000)).w
										bne.w   return_11BE0
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										movem.l d0-a1,-(sp)
										move.w  d0,-(sp)
										move.b  d2,((PORTRAIT_IS_FLIPPED-$1000000)).w
										move.b  d1,((PORTRAIT_IS_ON_RIGHT-$1000000)).w
										move.w  #$A7C0,((word_FFB07E-$1000000)).w
										move.w  #$14,((BLINK_COUNTER-$1000000)).w
										move.w  #6,((word_FFB07C-$1000000)).w
										move.w  #$80A,d0
										move.w  #$2F6,d1
										tst.b   ((PORTRAIT_IS_ON_RIGHT-$1000000)).w
										beq.s   loc_11B84
										addi.w  #$1500,d1
loc_11B84:
										
										jsr     (CreateWindow).w
										addq.w  #1,d0
										move.w  d0,((PORTRAIT_WINDOW_INDEX-$1000000)).w
										tst.b   ((PORTRAIT_IS_FLIPPED-$1000000)).w
										bne.s   loc_11B9A
										lea     WindowBorderTiles(pc), a0
										bra.s   loc_11B9E
loc_11B9A:
										
										lea     PortraitWindowLayout(pc), a0
loc_11B9E:
										
										move.w  #$A0,d7 
										jsr     (CopyBytes).w   
										move.w  (sp)+,d0
										bsr.w   GetCharPortraitIdx
										bsr.w   LoadPortrait    
										move.w  ((PORTRAIT_WINDOW_INDEX-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$201,d1
										tst.b   ((PORTRAIT_IS_ON_RIGHT-$1000000)).w
										beq.s   loc_11BC4
										addi.w  #$1500,d1
loc_11BC4:
										
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										trap    #TRAP_VINTFUNCTIONS
										dc.w VINTS_ADD
										dc.l VInt_HandlePortraitBlinking
										move.b  #$FF,((byte_FFB082-$1000000)).w
										movem.l (sp)+,d0-a1
return_11BE0:
										
										rts

	; End of function InitPortraitWindow


; =============== S U B R O U T I N E =======================================

HidePortraitWindow:
										
										tst.w   ((PORTRAIT_WINDOW_INDEX-$1000000)).w
										beq.s   return_11BE0
										movem.l d0-a1,-(sp)
										trap    #TRAP_VINTFUNCTIONS
										dc.w VINTS_REMOVE
										dc.l VInt_HandlePortraitBlinking
										move.w  ((PORTRAIT_WINDOW_INDEX-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$2F6,d1
										tst.b   ((PORTRAIT_IS_ON_RIGHT-$1000000)).w
										beq.s   loc_11C08
										addi.w  #$1500,d1
loc_11C08:
										
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  ((PORTRAIT_WINDOW_INDEX-$1000000)).w,d0
										subq.w  #1,d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										clr.w   ((PORTRAIT_WINDOW_INDEX-$1000000)).w
										movem.l (sp)+,d0-a1
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function HidePortraitWindow


; =============== S U B R O U T I N E =======================================

; Create and display member stats screen
; 
; In: D0 = character idx

MemberStatsScreen:
										
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										movem.l d0-a2,-(sp)
										link    a6,#-$10
										move.w  d0,-2(a6)
										clr.b   ((PORTRAIT_IS_FLIPPED-$1000000)).w
										clr.b   ((PORTRAIT_IS_ON_RIGHT-$1000000)).w
										move.w  #WINDOW_MEMBER_STATS_SIZE,d0
										move.w  #WINDOW_MEMBER_STATS_DEST,d1
										jsr     (CreateWindow).w; stats window, on the right
										move.w  d0,-4(a6)
										move.w  #$80A,d0
										move.w  #WINDOW_MEMBER_PORTRAIT_DEST,d1
										jsr     (CreateWindow).w; portrait, upper left
										move.w  d0,-6(a6)
										addq.w  #1,d0
										move.w  d0,((PORTRAIT_WINDOW_INDEX-$1000000)).w
										move.w  #WINDOW_MEMBER_KD_SIZE,d0
										move.w  #WINDOW_MEMBER_KD_DEST,d1
										jsr     (CreateWindow).w; kills/defeat, middle left
										move.w  d0,-8(a6)
										move.w  #WINDOW_MEMBER_GOLD_SIZE,d0
										move.w  #WINDOW_MEMBER_GOLD_DEST,d1
										jsr     (CreateWindow).w; gold, bottom left
										move.w  d0,-$A(a6)
										move.w  -2(a6),d0
										bsr.w   GetPortraitIdx  
										move.w  d0,-$C(a6)
										bsr.w   LoadTileDataForMemberScreen
										move.w  -$C(a6),d0
										blt.s   loc_11CA6
										bsr.w   GetCharPortraitIdx
										bsr.w   LoadPortrait    
loc_11CA6:
										
										move.w  -4(a6),d0
										move.w  #WINDOW_MEMBER_STATS_POSITION,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										move.w  -8(a6),d0
										move.w  #WINDOW_MEMBER_KD_POSITION,d1
										jsr     (MoveWindowWithSFX).w
										move.w  -$C(a6),d0
										blt.s   loc_11CD2
										move.w  -6(a6),d0
										move.w  #WINDOW_MEMBER_PORTRAIT_POSITION,d1
										jsr     (MoveWindowWithSFX).w
loc_11CD2:
										
										move.w  -2(a6),d0
										tst.b   d0
										blt.s   loc_11CE6
										move.w  -$A(a6),d0
										move.w  #WINDOW_MEMBER_GOLD_POSITION,d1
										jsr     (MoveWindowWithSFX).w
loc_11CE6:
										
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  #$A7C0,((word_FFB07E-$1000000)).w
										move.w  #$14,((BLINK_COUNTER-$1000000)).w
										move.w  #6,((word_FFB07C-$1000000)).w
										trap    #TRAP_VINTFUNCTIONS
										dc.w VINTS_ADD
										dc.l VInt_HandlePortraitBlinking
										move.b  #$FF,((byte_FFB082-$1000000)).w
										lea     ((RAM_Entity_StructOffset_XAndStart-$1000000)).w,a0
										cmpi.b  #$FF,((CURRENT_BATTLE-$1000000)).w
										bne.s   loc_11D1A
										clr.w   d0
										bra.s   loc_11D32
loc_11D1A:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentHP
										tst.w   d1
										bne.s   loc_11D2C
										clr.w   d0
										bra.s   loc_11D32
loc_11D2C:
										
										jsr     j_GetEntityIndex
loc_11D32:
										
										move.l  a1,-(sp)
										move.w  d0,d1
										addi.w  #$10,d1
										lea     ((byte_FFAFA0-$1000000)).w,a1
										adda.w  d1,a1
										move.b  (a1),d1
										move.w  d1,-(sp)
										move.b  #1,(a1)
										lsl.w   #5,d0
										adda.w  d0,a0
										move.w  #$240,d0
										move.w  #$740,d1
										tst.b   ((RAM_Map_AreaProp1C-$1000000)).w
										bne.s   loc_11D64
										add.w   ((word_FFA814-$1000000)).w,d0
										add.w   ((word_FFA816-$1000000)).w,d1
										bra.s   loc_11D6C
loc_11D64:
										
										add.w   ((word_FFA810-$1000000)).w,d0
										add.w   ((word_FFA812-$1000000)).w,d1
loc_11D6C:
										
										move.b  $11(a0),d7
										move.w  d7,-(sp)
										move.w  $C(a0),-(sp)
										move.w  $E(a0),-(sp)
										move.w  $10(a0),-(sp)
										move.w  d0,(a0)
										move.w  d1,2(a0)
										move.w  d0,$C(a0)
										move.w  d1,$E(a0)
										move.b  #$40,$11(a0) 
										andi.b  #$7F,$1D(a0) 
										cmpi.b  #$FF,((CURRENT_BATTLE-$1000000)).w
										bne.s   loc_11DBC
										clr.b   ((NUM_SPRITES_TO_LOAD-$1000000)).w
										move.w  -2(a6),d0
										jsr     j_GetCharacterSpriteIdx
										clr.w   d0
										moveq   #3,d1
										moveq   #$FFFFFFFF,d2
										move.w  d4,d3
										jsr     (sub_6052).w    
										bra.s   loc_11DDC
loc_11DBC:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentHP
										tst.w   d1
										bne.s   loc_11DDC
										clr.b   ((NUM_SPRITES_TO_LOAD-$1000000)).w
										clr.w   d0
										moveq   #3,d1
										moveq   #$FFFFFFFF,d2
										move.w  #$AB,d3 
										jsr     (sub_6052).w    
loc_11DDC:
										
										move.b  ((CURRENT_PLAYER_INPUT-$1000000)).w,d0
										andi.b  #$70,d0 
										beq.s   loc_11DDC
										move.w  (sp)+,$10(a0)
										move.w  (sp)+,d1
										move.w  (sp)+,d0
										move.w  d0,(a0)
										move.w  d1,2(a0)
										move.w  d0,$C(a0)
										move.w  d1,$E(a0)
										move.w  (sp)+,d7
										move.b  d7,$11(a0)
										move.w  (sp)+,d0
										move.b  d0,(a1)
										movea.l (sp)+,a1
										clr.b   ((byte_FFB082-$1000000)).w
										trap    #TRAP_VINTFUNCTIONS
										dc.w VINTS_REMOVE
										dc.l VInt_HandlePortraitBlinking
										move.w  -4(a6),d0
										move.w  #$2001,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										move.w  -8(a6),d0
										move.w  #$F80B,d1
										jsr     (MoveWindowWithSFX).w
										move.w  -$C(a6),d0
										blt.s   loc_11E40
										move.w  -6(a6),d0
										move.w  #$F8F6,d1
										jsr     (MoveWindowWithSFX).w
loc_11E40:
										
										move.w  -2(a6),d0
										tst.b   d0
										blt.s   loc_11E54
										move.w  -$A(a6),d0
										move.w  #$F81C,d1
										jsr     (MoveWindowWithSFX).w
loc_11E54:
										
										clr.w   ((PORTRAIT_WINDOW_INDEX-$1000000)).w
										jsr     (WaitForVInt).w 
										cmpi.b  #$FF,((CURRENT_BATTLE-$1000000)).w
										bne.s   loc_11E94
										clr.w   d0
										tst.b   ((PLAYER_TYPE-$1000000)).w
										bne.s   loc_11E74
										jsr     j_GetCharacterSpriteIdx
										bra.s   loc_11E82
loc_11E74:
										
										cmpi.b  #1,((PLAYER_TYPE-$1000000)).w
										bne.s   loc_11E80
										moveq   #$3E,d4 
										bra.s   loc_11E82
loc_11E80:
										
										moveq   #$3D,d4 
loc_11E82:
										
										clr.w   d0
										clr.w   d1
										move.b  $10(a0),d1
										moveq   #$FFFFFFFF,d2
										move.w  d4,d3
										jsr     (sub_6052).w    
										bra.s   loc_11EBA
loc_11E94:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentHP
										tst.w   d1
										bne.s   loc_11EBA
										clr.w   d0
										jsr     j_GetCharacterSpriteIdx
										clr.w   d0
										clr.w   d1
										move.b  $10(a0),d1
										moveq   #$FFFFFFFF,d2
										move.w  d4,d3
										jsr     (sub_6052).w    
loc_11EBA:
										
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  -$A(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										move.w  -8(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										move.w  -6(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										move.w  -4(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										unlk    a6
										movem.l (sp)+,d0-a2
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function MemberStatsScreen


; =============== S U B R O U T I N E =======================================

; In: A1 = address of VDP tile order in RAM

AddStatusEffectTileIndexesToVDPTileOrder:
										
										move.l  d0,(a1)
										subq.l  #4,a1
										cmpi.w  #$C020,(a1)
										beq.s   return_11EFC
										movea.l -6(a6),a1
										adda.w  #$78,a1 
return_11EFC:
										
										rts

	; End of function AddStatusEffectTileIndexesToVDPTileOrder


; =============== S U B R O U T I N E =======================================

LoadTileDataForMemberScreen:
										
										move.w  -4(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  -2(a6),d0
										bsr.w   sub_11FF0
										move.w  -8(a6),d0
										lea     AllyKillDefeatWindowLayout(pc), a0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  #WINDOW_MEMBER_KD_VDPTILEORDER_BYTESIZE,d7
										jsr     (CopyBytes).w   
										adda.w  #WINDOW_MEMBER_KD_TEXT_KILLS_OFFSET,a1
										move.w  -2(a6),d0
										tst.b   d0
										blt.s   loc_11F5A       ; character idx is negative (a monster), so do not display kills
										jsr     j_GetKills
										move.w  d1,d0
										ext.l   d0
										moveq   #WINDOW_MEMBER_KD_TEXT_KILLS_LENGTH,d7
										bsr.w   WriteTilesFromNumber
										adda.w  #WINDOW_MEMBER_KD_TEXT_DEFEATS_OFFSET,a1
										move.w  -2(a6),d0
										jsr     j_GetDefeats
										move.w  d1,d0
										ext.l   d0
										moveq   #WINDOW_MEMBER_KD_TEXT_DEFEATS_LENGTH,d7
										bsr.w   WriteTilesFromNumber
loc_11F5A:
										
										tst.b   ((RAM_DebugModeActivated-$1000000)).w
										beq.s   loc_11FA6
										move.w  -8(a6),d0
										lea     AllyKillDefeatWindowLayout(pc), a0
										move.w  #$101,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  -2(a6),d0       ; get character idx from stack
										lsr.w   #4,d0
										andi.w  #$F,d0
										cmpi.w  #$A,d0
										blt.s   loc_11F86
										addi.w  #-$3FC9,d0
										bra.s   loc_11F8A
loc_11F86:
										
										addi.w  #-$3FD0,d0
loc_11F8A:
										
										move.w  d0,(a1)+
										move.w  -2(a6),d0
										andi.w  #$F,d0
										cmpi.w  #$A,d0
										blt.s   loc_11FA0
										addi.w  #-$3FC9,d0
										bra.s   loc_11FA4
loc_11FA0:
										
										addi.w  #-$3FD0,d0
loc_11FA4:
										
										move.w  d0,(a1)+
loc_11FA6:
										
										move.w  -$C(a6),d0
										blt.s   return_11FEA
										move.w  -6(a6),d0
										lea     WindowBorderTiles(pc), a0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  #$A0,d7 
										jsr     (CopyBytes).w   
										lea     CharacterStatsWindowLayout(pc), a0
										move.w  -$A(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  #$40,d7 
										jsr     (CopyBytes).w   
										adda.w  #$22,a1 
										jsr     j_GetGold
										move.l  d1,d0
										moveq   #6,d7
										bsr.w   WriteTilesFromNumber
return_11FEA:
										
										rts

	; End of function LoadTileDataForMemberScreen

byte_11FEC:         dc.b $4E
										dc.b $2F
										dc.b $41
										dc.b 0

; =============== S U B R O U T I N E =======================================

sub_11FF0:
										
										link    a6,#-6
										move.w  d0,-2(a6)
										move.l  a1,-6(a6)
										movea.l (p_WindowLayout_MemberStats).l,a0
										move.w  #WINDOW_MEMBER_STATS_VDPTILEORDER_BYTESIZE,d7
										jsr     (CopyBytes).w   
										move.w  -2(a6),d0
										movea.l -6(a6),a1
										adda.w  #WINDOW_MEMBER_STATS_TEXT_CLASS_OFFSET,a1
										tst.b   d0
										blt.s   loc_1202E
										jsr     j_GetClass      
										jsr     j_GetClassName
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										addq.w  #2,a1
loc_1202E:
										
										move.w  -2(a6),d0
										jsr     j_GetCharName
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										movea.l -6(a6),a1
										adda.w  #$4E,a1 
										lea     ((byte_FFB852-$1000000)).w,a0
										move.w  -2(a6),d0
										jsr     j_GetStatus
										move.w  d1,d2
										andi.w  #4,d2
										beq.s   loc_12066
										move.l  #VDPTILE_STATUSEFFECT_CURSE,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_12066:
										
										move.w  d1,d2
										andi.w  #2,d2
										beq.s   loc_12078
										move.l  #$C0E8C0E9,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_12078:
										
										move.w  d1,d2
										andi.w  #$30,d2 
										beq.s   loc_1208A
										move.l  #$C0E2C0E3,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_1208A:
										
										move.w  d1,d2
										andi.w  #$300,d2
										beq.s   loc_1209C
										move.l  #$C0E4C0E5,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_1209C:
										
										move.w  d1,d2
										andi.w  #1,d2
										beq.s   loc_120AE
										move.l  #$C0EAC0EB,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_120AE:
										
										move.w  d1,d2
										andi.w  #$C0,d2 
										beq.s   loc_120C0
										move.l  #$C0E6C0E7,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_120C0:
										
										move.w  d1,d2
										andi.w  #$C000,d2
										beq.s   loc_120D2
										move.l  #$C0A1C0A2,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_120D2:
										
										move.w  d1,d2
										andi.w  #$3000,d2
										beq.s   loc_120E4
										move.l  #$C0A3C0A4,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_120E4:
										
										move.w  d1,d2
										andi.w  #$C00,d2
										beq.s   loc_120F6
										move.l  #$C0DDC0DF,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_120F6:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentHP
										cmpi.w  #$64,d1 
										bge.s   loc_12118
										movea.l -6(a6),a1
										adda.w  #$DC,a1 
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_12118:
										
										move.w  -2(a6),d0
										jsr     j_GetMaxHP
										cmpi.w  #$64,d1 
										bge.s   loc_1213A
										movea.l -6(a6),a1
										adda.w  #$E2,a1 
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_1213A:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentMP
										cmpi.w  #$64,d1 
										bge.s   loc_1215C
										movea.l -6(a6),a1
										adda.w  #$130,a1
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_1215C:
										
										move.w  -2(a6),d0
										jsr     j_GetMaxMP
										cmpi.w  #$64,d1 
										bge.s   loc_1217E
										movea.l -6(a6),a1
										adda.w  #$136,a1
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_1217E:
										
										move.w  -2(a6),d0
										tst.b   d0
										blt.s   loc_121BC
										jsr     j_GetCurrentLevel
										movea.l -6(a6),a1
										adda.w  #$8E,a1 
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
										move.w  -2(a6),d0
										jsr     j_GetCurrentEXP
										movea.l -6(a6),a1
										adda.w  #$18A,a1
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
										bra.s   loc_121E0
loc_121BC:
										
										lea     byte_11FEC(pc), a0
										movea.l -6(a6),a1
										adda.w  #$8C,a1 
										moveq   #3,d7
										bsr.w   WriteTilesFromASCII
										lea     byte_11FEC(pc), a0
										movea.l -6(a6),a1
										adda.w  #$188,a1
										moveq   #3,d7
										bsr.w   WriteTilesFromASCII
loc_121E0:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentATK
										cmpi.w  #$64,d1 
										bge.s   loc_12202
										movea.l -6(a6),a1
										adda.w  #$A0,a1 
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_12202:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentDEF
										cmpi.w  #$64,d1 
										bge.s   loc_12224
										movea.l -6(a6),a1
										adda.w  #$F4,a1 
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_12224:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentAGI
										andi.w  #$7F,d1 
										cmpi.w  #$64,d1 
										bge.s   loc_1224A
										movea.l -6(a6),a1
										adda.w  #$148,a1
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_1224A:
										
										move.w  -2(a6),d0
										jsr     j_GetCurrentMOV
										cmpi.w  #$64,d1 
										bge.s   loc_1226C
										movea.l -6(a6),a1
										adda.w  #$19C,a1
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_1226C:
										
										move.w  #$C6D0,d7
										move.w  -2(a6),d0
										clr.w   d1
										jsr     j_GetSpellAndNumberOfSpells
										movea.l -6(a6),a1
										adda.w  #$224,a1
										move.l  a1,-(sp)
										moveq   #3,d6
loc_12288:
										
										move.w  -2(a6),d0
										move.w  #3,d1
										sub.w   d6,d1
										jsr     j_GetSpellAndNumberOfSpells
										cmpi.b  #$3F,d1 
										beq.w   loc_1230E
										movem.l d1/a0,-(sp)
										jsr     j_GetSpellDefAddress
										btst    #7,3(a0)
										movem.l (sp)+,d1/a0
										beq.w   loc_1230A
										bsr.w   CopyMemberScreenIconsToVDPTileOrder
										movem.w d0-d1/d6-d7,-(sp)
										movem.l a0-a1,-(sp)
										jsr     j_FindSpellName
										addq.w  #4,a1
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										movem.l (sp)+,a0-a1
										movem.w (sp)+,d0-d1/d6-d7
										movem.w d6-d7,-(sp)
										movem.l a0-a1,-(sp)
										lea     unk_110E4(pc), a0
										andi.w  #$C0,d1 
										move.w  d1,d2
										add.w   d1,d1
										add.w   d2,d1
										lsr.w   #4,d1
										adda.w  d1,a0
										adda.w  #$58,a1 
										moveq   #$C,d7
										jsr     (CopyBytes).w   
										movem.l (sp)+,a0-a1
										movem.w (sp)+,d6-d7
										adda.w  #$7E,a1 
loc_1230A:
										
										dbf     d6,loc_12288
loc_1230E:
										
										movea.l (sp)+,a0
										cmpa.l  a0,a1
										bne.w   loc_1232E
										move.w  d7,-(sp)
										lea     aNothing_0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$250,a1
										moveq   #$FFFFFFD6,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										move.w  (sp)+,d7
loc_1232E:
										
										move.w  -2(a6),d0
										clr.w   d1
										jsr     j_GetItemAndNumberOfItems
										tst.w   d2
										beq.w   loc_123DA
										movea.l -6(a6),a1
										adda.w  #$236,a1
										moveq   #3,d6
loc_1234A:
										
										move.w  -2(a6),d0
										move.w  #3,d1
										sub.w   d6,d1
										jsr     j_GetItemAndNumberOfItems
										cmpi.b  #ITEMIDX_NOTHING,d1
										beq.w   loc_123F2
										bsr.w   CopyMemberScreenIconsToVDPTileOrder
										movem.w d0-d1/d6-d7,-(sp)
										movem.l a0-a1,-(sp)
										jsr     j_FindItemName
										addq.w  #4,a1
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										movem.l (sp)+,a0-a1
										movem.w (sp)+,d0-d1/d6-d7
										btst    #ITEM_BIT_EQUIPPED,d1
										beq.w   loc_123AC
										movem.w d6-d7,-(sp)
										movem.l a0-a1,-(sp)
										lea     aEquipped_0(pc), a0
										adda.w  #$58,a1 
										moveq   #$FFFFFFD6,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										movem.l (sp)+,a0-a1
										movem.w (sp)+,d6-d7
loc_123AC:
										
										adda.w  #$7E,a1 
										dbf     d6,loc_1234A
										bra.w   loc_123F2
aNothing_0:
										
										dc.b '\Nothing',0
aEquipped_0:
										
										dc.b '\Equipped',0
aNothing_1:
										
										dc.b '\Nothing',0
aJewel:
										dc.b 'JEWEL',0
loc_123DA:
										
										move.w  d7,-(sp)
										lea     aNothing_1(pc), a0
										movea.l -6(a6),a1
										adda.w  #$262,a1
										moveq   #$FFFFFFD6,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										move.w  (sp)+,d7
loc_123F2:
										
										move.w  -2(a6),d0
										bne.s   loc_12446
										trap    #TRAP_CHECKFLAG
										dc.w $180               ; set after Bowie obtains the jewel of light/evil... whichever it is
										beq.s   loc_12446
										move.w  d7,-(sp)
										lea     aJewel(pc), a0  
										movea.l -6(a6),a1
										adda.w  #$374,a1
										moveq   #$FFFFFFD6,d1
										moveq   #8,d7
										bsr.w   WriteTilesFromASCII
										move.w  (sp)+,d7
										movea.l -6(a6),a1
										adda.w  #$39E,a1
										move.w  #$92,d1 
										bsr.w   CopyMemberScreenIconsToVDPTileOrder
										trap    #TRAP_CHECKFLAG
										dc.w $181               ; set after Bowie obtains King Galam's jewel
										beq.s   loc_12446
										movea.l -6(a6),a1
										adda.w  #$3A2,a1
										move.w  #$92,d1 
										bsr.w   CopyMemberScreenIconsToVDPTileOrder
										movea.l -6(a6),a1
										move.w  #$C053,$37E(a1)
loc_12446:
										
										lea     (byte_FF9004).l,a1
										moveq   #3,d6
loc_1244E:
										
										moveq   #3,d1
										sub.w   d6,d1
										move.w  -2(a6),d0
										jsr     j_GetSpellAndNumberOfSpells
										cmpi.b  #$3F,d1 
										beq.w   loc_124BC
										movem.l d1/a0,-(sp)
										jsr     j_GetSpellDefAddress
										btst    #7,3(a0)
										movem.l (sp)+,d1/a0
										beq.s   loc_124B8
										move.l  a0,-(sp)
										andi.w  #$3F,d1 
										addi.w  #$82,d1 
										movea.l (p_Icons).l,a0
										move.w  d1,d2
										add.w   d1,d1
										add.w   d2,d1
										lsl.w   #6,d1
										adda.w  d1,a0
										move.w  #$C0,d7 
										jsr     (CopyBytes).w   
										ori.b   #$F0,(a1)
										ori.b   #$F,$23(a1)
										ori.b   #$F0,$9C(a1)
										ori.b   #$F,$BF(a1)
										movea.l (sp)+,a0
										adda.w  #$C0,a1 
loc_124B8:
										
										dbf     d6,loc_1244E
loc_124BC:
										
										moveq   #3,d6
loc_124BE:
										
										moveq   #3,d1
										sub.w   d6,d1
										move.w  -2(a6),d0
										jsr     j_GetItemAndNumberOfItems
										cmpi.b  #ITEMIDX_NOTHING,d1
										beq.w   loc_12556
										move.l  a0,-(sp)
										move.w  d1,-(sp)
										andi.w  #ITEM_MASK_IDX,d1
										movea.l (p_Icons).l,a0
										mulu.w  #$C0,d1 
										adda.w  d1,a0
										move.w  #$C0,d7 
										jsr     (CopyBytes).w   
										move.w  (sp)+,d1
										btst    #$F,d1
										beq.s   loc_12536
										movem.l d2-d3/a0-a1,-(sp)
										movea.l (p_Icons).l,a0
										lea     $6F00(a0),a0
										move.w  #$BF,d2 
loc_1250A:
										
										move.b  (a0)+,d3
										beq.s   loc_1252C
										andi.w  #$F0,d3 
										beq.s   loc_12518
										andi.b  #$F,(a1)
loc_12518:
										
										move.b  -1(a0),d3
										andi.w  #$F,d3
										beq.s   loc_12526
										andi.b  #$F0,(a1)
loc_12526:
										
										move.b  -1(a0),d3
										or.b    d3,(a1)
loc_1252C:
										
										addq.l  #1,a1
										dbf     d2,loc_1250A
										movem.l (sp)+,d2-d3/a0-a1
loc_12536:
										
										ori.b   #$F0,(a1)
										ori.b   #$F,$23(a1)
										ori.b   #$F0,$9C(a1)
										ori.b   #$F,$BF(a1)
										movea.l (sp)+,a0
										adda.w  #$C0,a1 
										dbf     d6,loc_124BE
loc_12556:
										
										move.w  #$92,d1 
										movea.l (p_Icons).l,a0
										move.w  d1,d2
										add.w   d1,d1
										add.w   d2,d1
										lsl.w   #6,d1
										adda.w  d1,a0
										move.w  #$C0,d7 
										jsr     (CopyBytes).w   
										ori.b   #$F0,(a1)
										ori.b   #$F,$23(a1)
										ori.b   #$F0,$9C(a1)
										ori.b   #$F,$BF(a1)
										adda.w  #$C0,a1 
										move.w  #$93,d1 
										movea.l (p_Icons).l,a0
										move.w  d1,d2
										add.w   d1,d1
										add.w   d2,d1
										lsl.w   #6,d1
										adda.w  d1,a0
										move.w  #$C0,d7 
										jsr     (CopyBytes).w   
										ori.b   #$F0,(a1)
										ori.b   #$F,$23(a1)
										ori.b   #$F0,$9C(a1)
										ori.b   #$F,$BF(a1)
										adda.w  #$C0,a1 
										lea     (byte_FF9004).l,a0
										lea     ($DA00).l,a1
										move.w  #$300,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										unlk    a6
										rts

	; End of function sub_11FF0

										dc.w $FFFF

; =============== S U B R O U T I N E =======================================

CopyMemberScreenIconsToVDPTileOrder:
										
										move.w  d7,(a1)
										addq.w  #1,d7
										move.w  d7,2(a1)
										addq.w  #1,d7
										move.w  d7,$2A(a1)
										addq.w  #1,d7
										move.w  d7,$2C(a1)
										addq.w  #1,d7
										move.w  d7,$54(a1)
										addq.w  #1,d7
										move.w  d7,$56(a1)
										addq.w  #1,d7
										rts

	; End of function CopyMemberScreenIconsToVDPTileOrder


; =============== S U B R O U T I N E =======================================

sub_12606:
										
										lea     (byte_FFE000).l,a0
										move.w  #$97F,d0
loc_12610:
										
										move.w  (a0)+,d1
										andi.w  #$6000,d1
										bne.s   loc_1261C
										clr.w   -2(a0)
loc_1261C:
										
										dbf     d0,loc_12610
										lea     (byte_FFE000).l,a0
										lea     ($E000).l,a1
										move.w  #$800,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jmp     (SetFFDE94b3andWait).w

	; End of function sub_12606


; =============== S U B R O U T I N E =======================================

;     Get index of portrait based on char index for any character.
;     In: D0 = char idx
;     Out: D0 = adjusted portrait idx

GetPortraitIdx:
										
										tst.b   d0
										bpl.s   loc_12648
										jsr     j_GetEntityPortaitAndSpeechSound
										move.w  d1,d0
										bra.s   return_1264C
loc_12648:
										
										bsr.w   GetCharPortraitIdx
return_1264C:
										
										rts

	; End of function GetPortraitIdx

WindowBorderTiles:  incbin "graphics/technical/windowbordertiles.bin"
																						; compressed
PortraitWindowLayout:
										incbin "graphics/technical/windowlayouts/portraitwindowlayout.bin"
AllyKillDefeatWindowLayout:
										incbin "graphics/technical/windowlayouts/allykilldefeatwindowlayout.bin"
CharacterStatsWindowLayout:
										incbin "graphics/technical/windowlayouts/characterstatsdefeatwindowlayout.bin"

; =============== S U B R O U T I N E =======================================

sub_1288E:
										
										link    a6,#-$20

	; End of function sub_1288E


; =============== S U B R O U T I N E =======================================

sub_12892:
										
										move.l  ((byte_FFAEE2-$1000000)).w,-$20(a6)
										move.l  #$70007000,((byte_FFAEE2-$1000000)).w
										move.l  #$70007000,((byte_FFAEEE-$1000000)).w
										movem.l d0,-(sp)
										jsr     (WaitForVInt).w 
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										lea     (PALETTE_1).l,a0
										lea     (Palette2).l,a1
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										move.l  $40(a0),$40(a1)
										move.l  (a0)+,(a1)+
										jsr     (StoreVdpCommandster).w
										move.b  #9,((FADING_SETTING-$1000000)).w
										clr.b   ((FADING_POINTER-$1000000)).w
										move.b  ((FADING_COUNTER_MAX-$1000000)).w,((FADING_COUNTER-$1000000)).w
										move.b  #5,((FADING_PALETTE_FLAGS-$1000000)).w
										bsr.w   sub_129E8
loc_1291E:
										
										jsr     (WaitForVInt).w 
										tst.b   ((FADING_SETTING-$1000000)).w
										bne.s   loc_1291E
										move.w  -$E(a6),d0
										lsl.w   #8,d0
										or.w    -$C(a6),d0
										moveq   #$1C,d1
										sub.w   -$C(a6),d1
										lsr.w   #1,d1
										ori.w   #$2000,d1
										jsr     (CreateWindow).w
										move.w  d0,-2(a6)
										move.l  a1,-6(a6)
										bsr.w   sub_12C46
										moveq   #$20,d0 
										sub.w   -$E(a6),d0
										lsr.w   #1,d0
										lsl.w   #8,d0
										moveq   #$1C,d1
										sub.w   -$C(a6),d1
										lsr.w   #1,d1
										or.w    d0,d1
										move.w  -2(a6),d0
										move.w  #6,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										bsr.w   sub_12CB0
										move.w  -$E(a6),d0
										neg.w   d0
										lsl.w   #8,d0
										moveq   #$1C,d1
										sub.w   -$C(a6),d1
										lsr.w   #1,d1
										or.w    d0,d1
										move.w  -2(a6),d0
										move.w  #6,d2
										jsr     (MoveWindowWithSFX).w
										move.b  #$A,((FADING_SETTING-$1000000)).w
										clr.b   ((FADING_POINTER-$1000000)).w
										move.b  ((FADING_COUNTER_MAX-$1000000)).w,((FADING_COUNTER-$1000000)).w
										move.b  #5,((FADING_PALETTE_FLAGS-$1000000)).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  d0,-2(a6)
										jsr     (ClearWindowAndUpdateEndPtr).w
										move.b  #$F,((FADING_PALETTE_FLAGS-$1000000)).w
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										move.l  -$20(a6),((byte_FFAEE2-$1000000)).w
										move.l  -$20(a6),((byte_FFAEEE-$1000000)).w
										lea     (FFD080_Palette1bis).l,a0
										lea     (PALETTE_1).l,a1
										move.w  #$80,d7 
										jsr     (CopyBytes).w   
										jsr     (StoreVdpCommandster).w
										unlk    a6
										rts

	; End of function sub_12892


; =============== S U B R O U T I N E =======================================

sub_129E8:
										
										move.w  ((RAM_Map_AreaLayer1StartX-$1000000)).w,d0
										lsr.w   #7,d0
										ext.l   d0
										divs.w  #3,d0
										move.w  d0,-$14(a6)
										move.w  ((RAM_Map_AreaLayer1StartY-$1000000)).w,d0
										lsr.w   #7,d0
										ext.l   d0
										divs.w  #3,d0
										move.w  d0,-$12(a6)
										move.w  ((RAM_Map_AreaLayer1EndX-$1000000)).w,d0
										sub.w   ((RAM_Map_AreaLayer1StartX-$1000000)).w,d0
										lsr.w   #7,d0
										ext.l   d0
										divs.w  #3,d0
										cmpi.w  #$2F,d0 
										ble.s   loc_12A20
										moveq   #$2F,d0 
loc_12A20:
										
										move.w  d0,-$A(a6)
										move.w  ((RAM_Map_AreaLayer1EndY-$1000000)).w,d1
										sub.w   ((RAM_Map_AreaLayer1StartY-$1000000)).w,d1
										lsr.w   #7,d1
										ext.l   d1
										divs.w  #3,d1
										cmpi.w  #$2F,d1 
										ble.s   loc_12A3C
										moveq   #$2F,d1 
loc_12A3C:
										
										move.w  d1,d2
										addq.w  #1,d0
										addq.w  #1,d2
										mulu.w  d2,d0
										cmpi.w  #$600,d0
										ble.s   loc_12A56
										move.w  #$600,d1
										divu.w  d2,d1
										subq.w  #1,d1
										andi.w  #$7FFC,d1
loc_12A56:
										
										move.w  d1,-8(a6)
										move.w  -$A(a6),d0
										lsr.w   #1,d0
										addq.w  #3,d0
										move.w  d0,-$E(a6)
										move.w  -8(a6),d0
										lsr.w   #1,d0
										addq.w  #3,d0
										move.w  d0,-$C(a6)
										lea     (RAM_Start).l,a0
										lea     (FF2000_LOADING_SPACE).l,a2
										lea     (FF6802_LOADING_SPACE).l,a1
										move.w  -$A(a6),d5
										move.w  d5,d6
										add.w   d5,d5
										add.w   d6,d5
										add.w   d5,d5
										moveq   #2,d4
										move.w  -8(a6),d6
loc_12A96:
										
										move.w  -$A(a6),d7
loc_12A9A:
										
										move.w  -8(a6),d3
										sub.w   d6,d3
										move.w  -$A(a6),d2
										sub.w   d7,d2
										jsr     (DisableInterrupts).w
										bsr.w   sub_12BA4
										move.w  (VDP_Data).l,(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,4(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,8(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$C(a1)
										addq.w  #1,d2
										bsr.w   sub_12BA4
										move.w  (VDP_Data).l,2(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,6(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$A(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$E(a1)
										subq.w  #1,d2
										addq.w  #1,d3
										bsr.w   sub_12BA4
										move.w  (VDP_Data).l,$10(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$14(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$18(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$1C(a1)
										addq.w  #1,d2
										bsr.w   sub_12BA4
										move.w  (VDP_Data).l,$12(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$16(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$1A(a1)
										move.w  (VDP_Data).l,d0
										move.w  (VDP_Data).l,$1E(a1)
										jsr     (EnableInterrupts).w
										adda.w  #$20,a1 
										subq.w  #2,d7
										bge.w   loc_12A9A
										subq.w  #2,d6
										bge.w   loc_12A96
										jsr     (EnableInterrupts).w
										bra.w   loc_12BF4

	; End of function sub_129E8


; =============== S U B R O U T I N E =======================================

sub_12BA4:
										
										movem.w d2-d3,-(sp)
										add.w   -$14(a6),d2
										add.w   -$12(a6),d3
										lsl.w   #6,d3
										add.w   d3,d2
										add.w   d2,d2
										move.w  (a0,d2.w),d2
										andi.w  #$3FF,d2
										mulu.w  #$12,d2
										move.w  8(a2,d2.w),d2
										andi.w  #$7FF,d2
										cmpi.w  #$100,d2
										bne.s   loc_12BD4
										move.w  #$FF,d2
loc_12BD4:
										
										lsl.w   #5,d2
										move.w  d2,d3
										andi.w  #$3FFF,d2
										move.w  d2,(VDP_Control).l
										rol.w   #2,d3
										andi.w  #3,d3
										move.w  d3,(VDP_Control).l
										movem.w (sp)+,d2-d3
										rts

	; End of function sub_12BA4


; START OF FUNCTION CHUNK FOR sub_129E8

loc_12BF4:
										
										lea     (FF6802_LOADING_SPACE).l,a0
										lea     ($B800).l,a1
										move.w  #$400,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										lea     ($C800).l,a1
										move.w  #$400,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										lea     ($D000).l,a1
										move.w  #$800,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										lea     ($F000).l,a1
										move.w  #$800,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jmp     (SetFFDE94b3andWait).w

; END OF FUNCTION CHUNK FOR sub_129E8


; =============== S U B R O U T I N E =======================================

sub_12C46:
										
										movea.l -6(a6),a0
										move.w  #$A5C0,d5
										move.w  -$A(a6),d7
										lsr.w   #1,d7
										move.w  #$E0F9,(a0)+
loc_12C58:
										
										move.w  #$E0FA,(a0)+
										dbf     d7,loc_12C58
										move.w  #$E8F9,(a0)+
										move.w  -8(a6),d6
										lsr.w   #1,d6
loc_12C6A:
										
										move.w  -$A(a6),d7
										lsr.w   #1,d7
										move.w  #$E0FB,(a0)+
loc_12C74:
										
										move.w  d5,(a0)+
										addq.w  #1,d5
										cmpi.w  #$A600,d5
										bne.s   loc_12C82
										move.w  #$A640,d5
loc_12C82:
										
										cmpi.w  #$A700,d5
										bne.s   loc_12C8C
										move.w  #$A780,d5
loc_12C8C:
										
										dbf     d7,loc_12C74
										move.w  #$E8FB,(a0)+
										dbf     d6,loc_12C6A
										move.w  -$A(a6),d7
										lsr.w   #1,d7
										move.w  #$F0F9,(a0)+
loc_12CA2:
										
										move.w  #$F0FA,(a0)+
										dbf     d7,loc_12CA2
										move.w  #$F8F9,(a0)+
										rts

	; End of function sub_12C46


; =============== S U B R O U T I N E =======================================

sub_12CB0:
										
										moveq   #$14,d6
loc_12CB2:
										
										lea     ((RAM_Entity_StructOffset_XAndStart-$1000000)).w,a0
										move.b  ((byte_FFDEA0-$1000000)).w,d0
										andi.w  #1,d0
										lsl.w   #4,d0
										lsl.w   #5,d0
										adda.w  d0,a0
										lea     (byte_FFDD00).l,a1
										moveq   #$2F,d7 
										move.w  -$A(a6),d4
										lsr.w   #2,d4
										lsl.w   #3,d4
										move.w  #$F8,d2 
										sub.w   d4,d2
										move.w  -8(a6),d4
										lsr.w   #2,d4
										lsl.w   #3,d4
										move.w  #$E7,d3 
										sub.w   d4,d3
										tst.b   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										beq.s   loc_12CF0
										moveq   #1,d6
loc_12CF0:
										
										move.l  a1,d0
										cmpi.w  #$DE80,d0
										beq.w   loc_12D82
										cmpi.w  #1,(a1)
										beq.s   loc_12D04
										addq.l  #8,a1
										bra.s   loc_12CF0
loc_12D04:
										
										cmpi.w  #7,d6
										blt.w   loc_12D6E
										cmpa.w  #$AEE2,a0
										bne.s   loc_12D26
										move.w  -$20(a6),d0
										cmpi.w  #$7000,d0
										beq.w   loc_12D6E
										move.w  -$1E(a6),d1
										bra.w   loc_12D34
loc_12D26:
										
										move.w  (a0),d0
										cmpi.w  #$7000,d0
										beq.w   loc_12D6E
										move.w  2(a0),d1
loc_12D34:
										
										ext.l   d0
										ext.l   d1
										divs.w  #$60,d0 
										divs.w  #$60,d1 
										add.w   d2,d0
										add.w   d3,d1
										move.w  #$E0FE,d4
										cmpi.b  #$40,$13(a0) 
										bcs.s   loc_12D5A
										cmpi.b  #$AA,$13(a0)
										bhi.s   loc_12D5A
										subq.w  #1,d4
loc_12D5A:
										
										cmpi.b  #$F0,$13(a0)
										bcs.s   loc_12D64
										subq.w  #1,d4
loc_12D64:
										
										move.w  d1,(a1)+
										clr.b   (a1)+
										tst.b   (a1)+
										move.w  d4,(a1)+
										move.w  d0,(a1)+
loc_12D6E:
										
										lea     $20(a0),a0
										move.l  a0,d0
										cmpi.w  #$AF02,d0
										bne.s   loc_12D7E
										lea     ((RAM_Entity_StructOffset_XAndStart-$1000000)).w,a0
loc_12D7E:
										
										dbf     d7,loc_12CF0
loc_12D82:
										
										movem.l d0-d2/d7-a0,-(sp)
										lea     (RAM_Struct_Sprite_Y).l,a0
										move.w  #$38,d0 
										moveq   #$2F,d7 
										move.w  #$10,d1
loc_12D96:
										
										move.w  d1,d2
										lsl.w   #3,d2
										tst.b   2(a0,d2.w)
										bne.s   loc_12DA8
										move.b  d1,3(a0,d0.w)
										move.w  d1,d0
										lsl.w   #3,d0
loc_12DA8:
										
										addq.w  #1,d1
										dbf     d7,loc_12D96
										moveq   #$2F,d7 
										move.w  #$10,d1
loc_12DB4:
										
										move.w  d1,d2
										lsl.w   #3,d2
										tst.b   2(a0,d2.w)
										beq.s   loc_12DC6
										move.b  d1,3(a0,d0.w)
										move.w  d1,d0
										lsl.w   #3,d0
loc_12DC6:
										
										addq.w  #1,d1
										dbf     d7,loc_12DB4
										clr.b   3(a0,d0.w)
										movem.l (sp)+,d0-d2/d7-a0
										jsr     (WaitForVInt).w 
										subq.w  #1,d6
										bne.s   loc_12DDE
										moveq   #$14,d6
loc_12DDE:
										
										move.b  ((RAM_Input_Player1_StateA-$1000000)).w,d0
										andi.b  #$70,d0 
										beq.w   loc_12CB2
										rts

	; End of function sub_12CB0


; =============== S U B R O U T I N E =======================================

; related to end kiss

EndKiss:
										move.b  #$FF,(WINDOW_HIDING_FORBIDDEN).l
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										move.w  #$120E,d0
										move.w  #$707,d1
										jsr     (CreateWindow).w
										move.w  d0,d4
										move.w  #$A640,d5
										moveq   #$F,d7
										move.w  #$E000,(a1)+
loc_12E10:
										
										move.w  #$E000,(a1)+
										dbf     d7,loc_12E10
										move.w  #$E800,(a1)+
										moveq   #$B,d6
loc_12E1E:
										
										moveq   #$F,d7
										move.w  #$E000,(a1)+
loc_12E24:
										
										move.w  d5,(a1)+
										addq.w  #1,d5
										dbf     d7,loc_12E24
										move.w  #$E800,(a1)+
										dbf     d6,loc_12E1E
										moveq   #$F,d7
										move.w  #$F000,(a1)+
loc_12E3A:
										
										move.w  #$F000,(a1)+
										dbf     d7,loc_12E3A
										move.w  #$F800,(a1)+
										move.b  #5,((FADING_COUNTER_MAX-$1000000)).w
										lea     (Palette3).l,a0
										lea     (Palette4).l,a1
										move.w  #$20,d7 
										jsr     (CopyBytes).w   
										lea     (Palette3).l,a0
										lea     (PALETTE3_BIS).l,a1
										move.w  #$20,d7 
										jsr     (CopyBytes).w   
										movea.l (p_plt_endKiss).l,a0
										lea     (Palette2).l,a1
										move.w  #$20,d7 
										jsr     (CopyBytes).w   
										lea     $80(a1),a1
										jsr     (CopyBytes).w   
										jsr     (StoreVdpCommandster).w
										lea     (PALETTE_1).l,a0
										lea     (FFD080_Palette1bis).l,a1
										move.w  #$80,d7 
										jsr     (CopyBytes).w   
										lea     (FF6802_LOADING_SPACE).l,a1
										move.w  #$5FF,d0
										moveq   #0,d1
loc_12EB4:
										
										move.l  d1,(a1)+
										dbf     d0,loc_12EB4
										lea     (FF6802_LOADING_SPACE).l,a0
										lea     ($C800).l,a1
										move.w  #$600,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										lea     (byte_FF7402).l,a0
										lea     ($D400).l,a1
										move.w  #$600,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										move.w  d4,d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										jsr     j_EndKissPictureSequence
										move.w  #$B4,d0 
										jsr     (Sleep).w       
										move.w  d4,d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function EndKiss


; =============== S U B R O U T I N E =======================================

sub_12F12:
										
										tst.w   ((word_FFB086-$1000000)).w
										bne.w   return_12F5C
										movem.l d0-a1,-(sp)
										link    a6,#-$20
										move.w  #$904,d0
										move.w  #$2017,d1
										jsr     (CreateWindow).l
										addq.w  #1,d0
										move.w  d0,((word_FFB086-$1000000)).w
										move.l  a1,-$12(a6)
										bsr.w   sub_14B28
										move.w  ((word_FFB086-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$1617,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
										unlk    a6
										movem.l (sp)+,d0-a1
return_12F5C:
										
										rts

	; End of function sub_12F12


; =============== S U B R O U T I N E =======================================

sub_12F5E:
										
										tst.w   ((word_FFB086-$1000000)).w
										beq.s   return_12F5C
										movem.l d0-a1,-(sp)
										link    a6,#-$20
										move.w  ((word_FFB086-$1000000)).w,d0
										subq.w  #1,d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).l
										move.l  a1,-$12(a6)
										bsr.w   sub_14B28
										move.w  ((word_FFB086-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										unlk    a6
										movem.l (sp)+,d0-a1
										rts

	; End of function sub_12F5E


; =============== S U B R O U T I N E =======================================

sub_12F9A:
										
										tst.w   ((word_FFB086-$1000000)).w
										beq.s   return_12F5C
										movem.l d0-a1,-(sp)
										move.w  ((word_FFB086-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$2017,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										move.w  ((TEXT_WINDOW_INDEX-$1000000)).w,d0
										beq.s   loc_12FCA
										subq.w  #1,d0
										move.w  #$8080,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
loc_12FCA:
										
										jsr     (WaitForVint_andFFA900Clear).l
										move.w  ((word_FFB086-$1000000)).w,d0
										subq.w  #1,d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										clr.w   ((word_FFB086-$1000000)).w
										movem.l (sp)+,d0-a1
										rts

	; End of function sub_12F9A


; =============== S U B R O U T I N E =======================================

sub_12FE6:
										
										clr.b   ((byte_FFB13C-$1000000)).w
										move.w  #$7F,((word_FFB13A-$1000000)).w 
										clr.b   ((word_FFAF8C-$1000000)).w
										cmpi.b  #2,((word_FFB13D-$1000000)).w
										bne.s   loc_13000
										clr.b   ((word_FFB13D-$1000000)).w
loc_13000:
										
										bra.w   loc_1304C
loc_13004:
										
										move.b  #1,((word_FFAF8C-$1000000)).w
										move.w  ((word_FFB13A-$1000000)).w,d1
										jsr     j_GetItemType
										tst.w   d2
										beq.s   loc_13020
										move.b  #2,((word_FFB13D-$1000000)).w
										bra.s   loc_1302C
loc_13020:
										
										cmpi.b  #2,((word_FFB13D-$1000000)).w
										bne.s   loc_1302C
										clr.b   ((word_FFB13D-$1000000)).w
loc_1302C:
										
										bra.w   loc_1304C
loc_13030:
										
										clr.b   ((byte_FFB13C-$1000000)).w
										move.w  #ITEMIDX_NOTHING,((word_FFB13A-$1000000)).w
										move.b  #2,((word_FFAF8C-$1000000)).w
										cmpi.b  #2,((word_FFB13D-$1000000)).w
										bne.s   loc_1304C
										clr.b   ((word_FFB13D-$1000000)).w
loc_1304C:
										
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										move.w  ((word_FFB136-$1000000)).w,d0
										add.w   ((word_FFB138-$1000000)).w,d0
										cmp.w   ((word_FFB12E-$1000000)).w,d0
										blt.s   loc_13066
										clr.w   ((word_FFB136-$1000000)).w
										clr.w   ((word_FFB138-$1000000)).w
loc_13066:
										
										link    a6,#-$10
										bsr.w   GetSelectedMember
										move.w  d0,-2(a6)
										bsr.w   LoadCharPortrait
										move.w  #$1D0D,d0
										move.w  #$220,d1
										jsr     (CreateWindow).l
										move.w  d0,-4(a6)
										move.w  #$80A,d0
										move.w  #$F8F6,d1
										jsr     (CreateWindow).l
										move.w  d0,-6(a6)
										move.w  #$150D,d0
										move.w  #$20F3,d1
										jsr     (CreateWindow).l
										move.w  d0,-8(a6)
										bsr.w   sub_1354C
										move.w  -4(a6),d0
										move.w  #$20E,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										move.w  -6(a6),d0
										move.w  #$201,d1
										jsr     (MoveWindowWithSFX).l
										move.w  -8(a6),d0
										move.w  #$A01,d1
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVInt).w 
										lea     TextHighlightTiles(pc), a0
										lea     ($B800).l,a1
										move.w  #$A0,d0 
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										jsr     (WaitForVint_andFFA900Clear).l
										moveq   #$14,d1
loc_13100:
										
										move.w  d1,-(sp)
										move.w  ((word_FFB13A-$1000000)).w,d1
										jsr     j_GetItemType
										tst.w   d2
										beq.s   loc_13114
										moveq   #2,d2
										bra.s   loc_13116
loc_13114:
										
										moveq   #1,d2
loc_13116:
										
										move.w  (sp)+,d1
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_13138
										move.b  ((word_FFB13D-$1000000)).w,d0
										addq.b  #1,d0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										cmp.b   d2,d0
										ble.s   loc_13130
										clr.b   d0
loc_13130:
										
										move.b  d0,((word_FFB13D-$1000000)).w
										bsr.w   sub_13478
loc_13138:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_13156
										move.b  ((word_FFB13D-$1000000)).w,d0
										subq.b  #1,d0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bge.s   loc_1314E
										move.b  d2,d0
loc_1314E:
										
										move.b  d0,((word_FFB13D-$1000000)).w
										bsr.w   sub_13478
loc_13156:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1319A
										move.w  ((word_FFB138-$1000000)).w,d0
										subq.w  #1,d0
										blt.s   loc_1317A
										clr.w   d1
										bsr.w   sub_133A0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										move.w  d0,((word_FFB138-$1000000)).w
										bsr.w   sub_13478
										bra.s   loc_1319A
loc_1317A:
										
										move.w  ((word_FFB136-$1000000)).w,d0
										subq.w  #1,d0
										blt.s   loc_1319A
										clr.w   d1
										bsr.w   sub_133A0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										move.w  d0,((word_FFB136-$1000000)).w
										move.b  #1,((word_FFAF9E-$1000000)).w
										bsr.w   sub_134A8
loc_1319A:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_131F6
										move.w  ((word_FFB138-$1000000)).w,d0
										addq.w  #1,d0
										cmpi.w  #4,d0
										bgt.s   loc_131CE
										move.w  d0,d2
										add.w   ((word_FFB136-$1000000)).w,d2
										cmp.w   ((word_FFB12E-$1000000)).w,d2
										bge.s   loc_131CC
										clr.w   d1
										bsr.w   sub_133A0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										move.w  d0,((word_FFB138-$1000000)).w
										bsr.w   sub_13478
loc_131CC:
										
										bra.s   loc_131F6
loc_131CE:
										
										move.w  ((word_FFB136-$1000000)).w,d0
										addq.w  #1,d0
										move.w  d0,d2
										add.w   ((word_FFB138-$1000000)).w,d2
										cmp.w   ((word_FFB12E-$1000000)).w,d2
										bge.s   loc_131F6
										clr.w   d1
										bsr.w   sub_133A0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										move.w  d0,((word_FFB136-$1000000)).w
										clr.b   ((word_FFAF9E-$1000000)).w
										bsr.w   sub_134A8
loc_131F6:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_13254
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_13220
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_13220
loc_13214:
										
										bsr.w   sub_133A0
										jsr     (WaitForVInt).w 
										bra.w   loc_13100
loc_13220:
										
										move.w  ((word_FFB136-$1000000)).w,d0
										add.w   ((word_FFB138-$1000000)).w,d0
										lea     ((byte_FFB0AE-$1000000)).w,a0
										move.b  (a0,d0.w),d0
										bsr.w   sub_132BC
										beq.s   loc_1323E
										trap    #TRAP_SOUNDCOM
										dc.w SFX_REFUSAL
										moveq   #$A,d1
										bra.s   loc_13214
loc_1323E:
										
										bsr.w   sub_13328
										cmpi.w  #$FFFF,d1
										bne.s   loc_13250
										bsr.w   sub_13478
										moveq   #$14,d1
										bra.s   loc_13214
loc_13250:
										
										bra.w   loc_13256
loc_13254:
										
										moveq   #$FFFFFFFF,d0
loc_13256:
										
										movem.w d0-d2,-(sp)
										clr.w   d1
										bsr.w   sub_133A0
										move.w  -4(a6),d0
										move.w  #$220,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										move.w  -6(a6),d0
										move.w  #$F8F6,d1
										jsr     (MoveWindowWithSFX).l
										move.w  -8(a6),d0
										move.w  #$20F3,d1
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
										move.w  -4(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										move.w  -6(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										move.w  -8(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										movem.w (sp)+,d0-d2
										unlk    a6
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function sub_12FE6


; =============== S U B R O U T I N E =======================================

sub_132BC:
										
										tst.b   ((word_FFAF8C-$1000000)).w
										bne.s   loc_132C6
										clr.w   d1
										rts
loc_132C6:
										
										cmpi.b  #1,((word_FFAF8C-$1000000)).w
										bne.w   loc_13314
										btst    #0,((byte_FFB13C-$1000000)).w
										beq.s   return_13312
										cmpi.b  #1,((byte_FFB13C-$1000000)).w
										bne.s   loc_132F6
										clr.w   d1
										jsr     j_GetItemAndNumberOfItems
										tst.w   d2
										bne.s   loc_132F0
										moveq   #$FFFFFFFF,d1
										bra.s   return_132F2
loc_132F0:
										
										clr.w   d1
return_132F2:
										
										rts
										bra.s   return_13312
loc_132F6:
										
										clr.w   d1
										jsr     j_GetEquippableWeapons
										move.w  d1,d2
										jsr     j_GetEquippableRings
										add.w   d1,d2
										bne.s   loc_1330E
										moveq   #$FFFFFFFF,d1
										bra.s   return_13310
loc_1330E:
										
										clr.w   d1
return_13310:
										
										rts
return_13312:
										
										rts
loc_13314:
										
										clr.w   d1
										jsr     j_GetSpellAndNumberOfSpells
										tst.w   d2
										bne.s   loc_13324
										moveq   #$FFFFFFFF,d1
										bra.s   return_13326
loc_13324:
										
										clr.w   d1
return_13326:
										
										rts

	; End of function sub_132BC


; =============== S U B R O U T I N E =======================================

sub_13328:
										
										tst.b   ((word_FFAF8C-$1000000)).w
										beq.w   return_13386
										cmpi.b  #1,((word_FFAF8C-$1000000)).w
										bne.w   loc_13388
										tst.b   ((byte_FFB13C-$1000000)).w
										beq.w   return_13386
										cmpi.b  #1,((byte_FFB13C-$1000000)).w
										bne.s   loc_13358
										moveq   #$A,d1
										bsr.w   sub_133A0
										bsr.w   sub_13F14
										bra.w   return_13386
loc_13358:
										
										cmpi.b  #2,((byte_FFB13C-$1000000)).w
										bne.s   loc_1337C
										clr.w   d1
										jsr     j_GetItemAndNumberOfItems
										cmpi.w  #4,d2
										bne.s   loc_13378
										moveq   #$A,d1
										bsr.w   sub_133A0
										bsr.w   sub_13F14
loc_13378:
										
										bra.w   return_13386
loc_1337C:
										
										moveq   #$A,d1
										bsr.w   sub_133A0
										bsr.w   sub_14108
return_13386:
										
										rts
loc_13388:
										
										moveq   #$A,d1
										bsr.w   sub_133A0
										bsr.w   sub_1445A
										rts

	; End of function sub_13328


; =============== S U B R O U T I N E =======================================

;     In: D0 = char idx

LoadCharPortrait:
										
										move.w  -2(a6),d0
										bsr.w   GetPortraitIdx  
										bra.w   LoadPortrait    

	; End of function LoadCharPortrait


; =============== S U B R O U T I N E =======================================

sub_133A0:
										
										tst.b   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										beq.s   loc_133A8
										moveq   #1,d1
loc_133A8:
										
										move.w  d0,-(sp)
										lea     (byte_FFDCC0).l,a0
										lea     unk_13452(pc), a1
										cmpi.w  #7,d1
										bge.s   loc_133C0
										move.w  #$100,d0
										bra.s   loc_133C2
loc_133C0:
										
										clr.w   d0
loc_133C2:
										
										move.w  ((word_FFB138-$1000000)).w,d2
										lsl.w   #4,d2
										add.w   d2,d0
										moveq   #1,d7
loc_133CC:
										
										move.w  (a1)+,(a0)
										add.w   d0,(a0)
										move.w  (a1)+,d2
										move.w  d2,2(a0)
										move.w  (a1)+,4(a0)
										move.w  (a1)+,6(a0)
										addq.l  #8,a0
										dbf     d7,loc_133CC
										move.w  #1,(a0)
										move.w  #1,6(a0)
										tst.w   ((word_FFB136-$1000000)).w
										beq.s   loc_13404
										cmpi.w  #7,d1
										blt.s   loc_13404
										move.w  #$97,6(a0) 
										move.w  #$104,(a0)
loc_13404:
										
										move.w  #$B,2(a0)
										move.w  #$D064,4(a0)
										addq.l  #8,a0
										move.w  #1,(a0)
										move.w  #1,6(a0)
										move.w  ((word_FFB136-$1000000)).w,d0
										addq.w  #5,d0
										cmp.w   ((word_FFB12E-$1000000)).w,d0
										bge.s   loc_13438
										cmpi.w  #7,d1
										blt.s   loc_13438
										move.w  #$97,6(a0) 
										move.w  #$14D,(a0)
loc_13438:
										
										move.w  #$10,2(a0)
										move.w  #$C064,4(a0)
										subq.w  #1,d1
										bne.s   loc_1344A
										moveq   #$14,d1
loc_1344A:
										
										move.w  (sp)+,d0
										bsr.w   sub_101E6
										rts

	; End of function sub_133A0

unk_13452:          dc.b   1
										dc.b   4
										dc.b  $D
										dc.b   9
										dc.b $C5 
										dc.b $C0 
										dc.b   0
										dc.b $9C 
										dc.b   1
										dc.b   4
										dc.b  $D
										dc.b  $A
										dc.b $CD 
										dc.b $C0 
										dc.b   0
										dc.b $BC 

; =============== S U B R O U T I N E =======================================

;     Get index of currently selected force member (in menus).
;     Out: D0 = selected index (capped to 255)

GetSelectedMember:
										
										move.w  ((word_FFB136-$1000000)).w,d0
										add.w   ((word_FFB138-$1000000)).w,d0
										lea     ((byte_FFB0AE-$1000000)).w,a0
										move.b  (a0,d0.w),d0
										andi.w  #$FF,d0
										rts

	; End of function GetSelectedMember


; =============== S U B R O U T I N E =======================================

sub_13478:
										
										bsr.w   sub_1354C
										move.w  -4(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										move.w  -8(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										bsr.w   LoadCharPortrait
										moveq   #$A,d1
										rts

	; End of function sub_13478


; =============== S U B R O U T I N E =======================================

CopyWords:
										
										move.w  (a0)+,(a1)+
										dbf     d7,CopyWords
										rts

	; End of function CopyWords


; =============== S U B R O U T I N E =======================================

sub_134A8:
										
										move.w  d0,-(sp)
										move.w  -4(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).l
										movea.l a1,a0
										tst.b   ((word_FFAF9E-$1000000)).w
										beq.s   loc_134E0
										adda.w  #$74,a0 
										adda.w  #$AE,a1 
										move.w  #$20A,d7
										jsr     (CopyBytes).w   
										lea     unk_13EDE(pc), a0
										suba.w  #$38,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										bra.s   loc_13510
loc_134E0:
										
										adda.w  #$E8,a0 
										adda.w  #$AE,a1 
										move.w  #$1D0,d7
										jsr     (CopyBytes).w   
										lea     unk_13EDE(pc), a0
										suba.w  #$38,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										lea     unk_13EDE(pc), a0
										adda.w  #$20A,a1
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
loc_13510:
										
										move.w  -4(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										jsr     (WaitForVInt).w 
										bsr.w   sub_1354C
										move.w  -4(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										move.w  -8(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										move.w  (sp)+,d0
										bsr.w   LoadCharPortrait
										moveq   #$A,d1
										rts

	; End of function sub_134A8


; =============== S U B R O U T I N E =======================================

sub_1354C:
										
										move.w  ((word_FFB138-$1000000)).w,d0
										add.w   ((word_FFB136-$1000000)).w,d0
										lea     ((byte_FFB0AE-$1000000)).w,a0
										move.b  (a0,d0.w),d0
										andi.w  #$1F,d0
										move.w  d0,-2(a6)
										move.w  -4(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).l
										move.w  -2(a6),d0
										bsr.w   WriteMemberListText
										move.w  -8(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).l
										move.w  -2(a6),d0
										bsr.w   sub_137BC
										move.w  -6(a6),d0
										lea     WindowBorderTiles(pc), a0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).l
										move.w  #$A0,d7 
										jsr     (CopyBytes).w   
										rts

	; End of function sub_1354C


; =============== S U B R O U T I N E =======================================

WriteMemberListText:
										
										link    a6,#-$10
										move.w  d0,-2(a6)
										move.l  a1,-6(a6)
										move.w  #$1D0D,d0
										bsr.w   CopyWindowTilesToRAM
										movea.l -6(a6),a1
										move.w  #$FFC6,d1
										suba.w  d1,a1
										addq.w  #4,a1
										moveq   #$1E,d7
										move.b  ((word_FFB13D-$1000000)).w,d0
										bne.s   loc_135D4
										lea     aNameClassLevExp(pc), a0
										bra.s   loc_135E4
loc_135D4:
										
										cmpi.b  #1,d0
										bne.s   loc_135E0
										lea     aNameHpMpAtDfAgMv(pc), a0
										bra.s   loc_135E4
loc_135E0:
										
										lea     aNameAttackDefense(pc), a0
loc_135E4:
										
										bsr.w   WriteTilesFromASCII
										movea.l -6(a6),a1
										adda.w  #$B2,a1 
										moveq   #4,d5
										move.w  ((word_FFB136-$1000000)).w,d4
loc_135F6:
										
										lea     ((byte_FFB0AE-$1000000)).w,a0
										clr.w   d0
										move.b  (a0,d4.w),d0
										move.w  d0,-$10(a6)
										move.l  a1,-(sp)
										move.w  d0,d1
										jsr     j_IsInBattleParty
										beq.s   loc_13616
										move.w  #$C0B0,-2(a1)
loc_13616:
										
										move.l  a1,-(sp)
										move.w  -$10(a6),d0
										jsr     j_GetCurrentHP
										move.w  d1,d2
										jsr     j_GetCharName
										moveq   #$FFFFFFC6,d1
										moveq   #$A,d7
										tst.w   d2
										bne.s   loc_13638
										bsr.w   sub_100C8       
										bra.s   loc_1363C
loc_13638:
										
										bsr.w   WriteTilesFromASCII
loc_1363C:
										
										movea.l (sp)+,a1
										lea     $10(a1),a1
										tst.b   ((word_FFB13D-$1000000)).w
										bne.s   loc_13690
										move.l  a1,-(sp)
										move.w  -$10(a6),d0
										jsr     j_GetClass      
										jsr     j_GetClassName
										moveq   #$FFFFFFC6,d1
										bsr.w   WriteTilesFromASCII
										movea.l (sp)+,a1
										lea     $16(a1),a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentLevel
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
										addq.l  #4,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentEXP
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteTilesFromNumber
loc_13690:
										
										cmpi.b  #1,((word_FFB13D-$1000000)).w
										bne.w   loc_1371E
										move.w  -$10(a6),d0
										jsr     j_GetCurrentHP
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										addq.l  #2,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentMP
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										addq.l  #2,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentATK
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										addq.l  #2,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentDEF
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										addq.l  #2,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentAGI
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										addq.l  #2,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentMOV
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										addq.l  #2,a1
loc_1371E:
										
										cmpi.b  #2,((word_FFB13D-$1000000)).w
										bne.w   loc_13798
										move.w  -$10(a6),d0
										move.w  ((word_FFB13A-$1000000)).w,d1
										jsr     j_IsWeaponOrRingEquippable
										bcs.s   loc_13748
										lea     aUnequippable(pc), a0
										addq.l  #4,a1
										moveq   #$10,d7
										moveq   #$FFFFFFC6,d1
										bsr.w   WriteTilesFromASCII
										bra.s   loc_13798
loc_13748:
										
										jsr     j_GetWeaponNewATKandDEF
										addq.l  #2,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentATK
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										move.w  #$C0A0,(a1)+
										move.w  d2,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										addq.l  #8,a1
										move.w  -$10(a6),d0
										jsr     j_GetCurrentDEF
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										bsr.w   WriteStatValue  
										move.w  #$C0A0,(a1)+
										move.w  d3,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										addq.l  #2,a1
loc_13798:
										
										movea.l (sp)+,a1
										adda.w  #$74,a1 
										addq.w  #1,d4
										cmp.w   ((word_FFB12E-$1000000)).w,d4
										dbeq    d5,loc_135F6
										unlk    a6
										rts

	; End of function WriteMemberListText


; =============== S U B R O U T I N E =======================================

sub_137AC:
										
										move.w  -8(a6),d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).l
										move.w  -2(a6),d0

	; End of function sub_137AC


; =============== S U B R O U T I N E =======================================

sub_137BC:
										
										link    a6,#-6
										move.w  d0,-2(a6)
										move.l  a1,-6(a6)
										move.w  #$150D,d0
										bsr.w   CopyWindowTilesToRAM
										move.w  -2(a6),d0
										jsr     j_GetCharName
										movea.l -6(a6),a1
										adda.w  #$2C,a1 
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										move.w  -2(a6),d0
										jsr     j_GetClass      
										jsr     j_GetClassName
										addq.w  #2,a1
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										addq.w  #2,a1
										move.w  #$C04C,(a1)+
										move.w  -2(a6),d0
										jsr     j_GetCurrentLevel
										moveq   #2,d7
										move.w  d1,d0
										ext.l   d0
										cmpi.w  #$A,d0
										bge.s   loc_1381E
										subq.w  #1,d7
loc_1381E:
										
										bsr.w   WriteTilesFromNumber
										movea.l -6(a6),a1
										adda.w  #$4E,a1 
										move.w  -2(a6),d0
										jsr     j_GetStatus
										move.w  d1,d2
										andi.w  #4,d2
										beq.s   loc_13846
										move.l  #$C0ECC0ED,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_13846:
										
										move.w  d1,d2
										andi.w  #2,d2
										beq.s   loc_13858
										move.l  #$C0E8C0E9,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_13858:
										
										move.w  d1,d2
										andi.w  #$30,d2 
										beq.s   loc_1386A
										move.l  #$C0E2C0E3,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_1386A:
										
										move.w  d1,d2
										andi.w  #$300,d2
										beq.s   loc_1387C
										move.l  #$C0E4C0E5,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_1387C:
										
										move.w  d1,d2
										andi.w  #1,d2
										beq.s   loc_1388E
										move.l  #$C0EAC0EB,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_1388E:
										
										move.w  d1,d2
										andi.w  #$C0,d2 
										beq.s   loc_138A0
										move.l  #$C0E6C0E7,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_138A0:
										
										move.w  d1,d2
										andi.w  #$C000,d2
										beq.s   loc_138B2
										move.l  #$C0A1C0A2,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_138B2:
										
										move.w  d1,d2
										andi.w  #$3000,d2
										beq.s   loc_138C4
										move.l  #$C0A3C0A4,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_138C4:
										
										move.w  d1,d2
										andi.w  #$C00,d2
										beq.s   loc_138D6
										move.l  #$C0DDC0DF,d0
										bsr.w   AddStatusEffectTileIndexesToVDPTileOrder
loc_138D6:
										
										move.b  ((word_FFAF8C-$1000000)).w,d0
										bne.s   loc_138E2
										bsr.w   WriteMemberMiniStatus
										bra.s   loc_138FE
loc_138E2:
										
										cmpi.b  #1,d0
										bne.s   loc_138EE
										bsr.w   WriteItemsMiniStatus
										bra.s   loc_138FE
loc_138EE:
										
										cmpi.b  #2,d0
										bne.s   loc_138FA
										bsr.w   WriteMagicMiniStatus
										bra.s   loc_138FE
loc_138FA:
										
										bsr.w   WriteEquipMiniStatus
loc_138FE:
										
										unlk    a6
										rts

	; End of function sub_137BC


; =============== S U B R O U T I N E =======================================

WriteMemberMiniStatus:
										
										movea.l -6(a6),a1
										adda.w  #$80,a1 
										lea     aMagicItem(pc), a0
										moveq   #$FFFFFFD6,d1
										moveq   #$E,d7
										bsr.w   WriteTilesFromASCII
										movea.l -6(a6),a1
										adda.w  #$AC,a1 
										bsr.w   WriteMemberMagicList
										movea.l -6(a6),a1
										adda.w  #$C0,a1 
										bsr.w   WriteMemberItemsList
										rts

	; End of function WriteMemberMiniStatus


; =============== S U B R O U T I N E =======================================

WriteItemsMiniStatus:
										
										movea.l -6(a6),a1
										adda.w  #$82,a1 
										lea     aItem_3(pc), a0 
										moveq   #$FFFFFFD6,d1
										moveq   #8,d7
										bsr.w   WriteTilesFromASCII
										movea.l -6(a6),a1
										adda.w  #$C0,a1 
										bsr.w   WriteMemberItemsList
										bsr.w   DrawMemberItemsIconsCross
										rts

	; End of function WriteItemsMiniStatus


; =============== S U B R O U T I N E =======================================

WriteMagicMiniStatus:
										
										movea.l -6(a6),a1
										adda.w  #$82,a1 
										lea     aMagic_2(pc), a0
										moveq   #$FFFFFFD6,d1
										moveq   #7,d7
										bsr.w   WriteTilesFromASCII
										movea.l -6(a6),a1
										adda.w  #$C0,a1 
										bsr.w   WriteMemberMagicList
										bsr.w   DrawMemberMagicIconsCross
										rts

	; End of function WriteMagicMiniStatus


; =============== S U B R O U T I N E =======================================

WriteEquipMiniStatus:
										
										movea.l -6(a6),a1
										adda.w  #$82,a1 
										lea     aEquipment(pc), a0
										moveq   #$FFFFFFD6,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										move.w  d5,d1
										cmpi.w  #$80,d1 
										beq.s   loc_139A0
										jsr     j_FindItemName
										bra.s   loc_139A6
loc_139A0:
										
										lea     aNothing_2(pc), a0
										moveq   #$A,d7
loc_139A6:
										
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										movea.l -6(a6),a1
										adda.w  #$EA,a1 
										lea     aAtt(pc), a0    
										moveq   #7,d7
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										move.w  -2(a6),d0
										jsr     j_GetCurrentATK
										move.w  d1,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										movea.l -6(a6),a1
										adda.w  #$13E,a1
										lea     aDef(pc), a0    
										moveq   #8,d7
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										move.w  -2(a6),d0
										jsr     j_GetCurrentDEF
										move.w  d1,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										movea.l -6(a6),a1
										adda.w  #$192,a1
										lea     aAgi(pc), a0    
										moveq   #6,d7
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										move.w  -2(a6),d0
										jsr     j_GetCurrentAGI
										move.w  d1,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										movea.l -6(a6),a1
										adda.w  #$1E6,a1
										lea     aMov(pc), a0    
										moveq   #8,d7
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										move.w  -2(a6),d0
										jsr     j_GetCurrentMOV
										move.w  d1,d0
										ext.l   d0
										moveq   #2,d7
										bsr.w   WriteStatValue  
										bra.w   loc_13C36
										rts

	; End of function WriteEquipMiniStatus


; =============== S U B R O U T I N E =======================================

WriteMemberMagicList:
										
										move.w  -2(a6),d0
										clr.w   d1
										jsr     j_GetSpellAndNumberOfSpells
										tst.w   d2
										beq.w   loc_13AD8
										moveq   #3,d6
loc_13A66:
										
										move.w  -2(a6),d0
										moveq   #3,d1
										sub.w   d6,d1
										jsr     j_GetSpellAndNumberOfSpells
										cmpi.b  #$3F,d1 
										beq.w   return_13B46
										movem.l a0-a1,-(sp)
										movem.w d0-d1/d6-d7,-(sp)
										jsr     j_FindSpellName
										moveq   #$FFFFFFD6,d1
										move.l  a1,-(sp)
										bsr.w   WriteTilesFromASCII
										movea.l (sp)+,a1
										movem.w (sp)+,d0-d1/d6-d7
										movem.w d6-d7,-(sp)
										lea     $2C(a1),a1
										move.w  #$C04C,(a1)+
										move.w  #$C085,(a1)+
										move.w  #$C096,(a1)+
										move.w  #$C085,(a1)+
										move.w  #$C08C,(a1)+
										move.w  #$C020,(a1)+
										lsr.w   #6,d1
										addq.w  #1,d1
										move.w  d1,d0
										ext.l   d0
										moveq   #1,d7
										bsr.w   WriteTilesFromNumber
										movem.w (sp)+,d6-d7
										movem.l (sp)+,a0-a1
										lea     $54(a1),a1
										dbf     d6,loc_13A66
										rts
loc_13AD8:
										
										move.w  d7,-(sp)
										lea     aNothing_0(pc), a0
										moveq   #$FFFFFFD6,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										move.w  (sp)+,d7
										rts

	; End of function WriteMemberMagicList


; =============== S U B R O U T I N E =======================================

WriteMemberItemsList:
										
										move.w  -2(a6),d0
										clr.w   d1
										jsr     j_GetItemAndNumberOfItems
										tst.w   d2
										beq.w   loc_13B48
										moveq   #CHAR_ITEMSLOTS_COUNTER,d6
loc_13AFE:
										
										move.w  -2(a6),d0
										moveq   #3,d1
										sub.w   d6,d1
										jsr     j_GetItemAndNumberOfItems
										cmpi.b  #ITEMIDX_NOTHING,d1
										beq.w   return_13B46
										movem.w d0-d1/d6-d7,-(sp)
										movem.l a0-a1,-(sp)
										jsr     j_FindItemName
										moveq   #$FFFFFFD6,d1
										bsr.w   WriteTilesFromASCII
										movem.l (sp)+,a0-a1
										movem.w (sp)+,d0-d1/d6-d7
										btst    #7,d1
										beq.w   loc_13B3E
										move.w  #$C0B1,-2(a1)
loc_13B3E:
										
										lea     $54(a1),a1
										dbf     d6,loc_13AFE
return_13B46:
										
										rts
loc_13B48:
										
										move.w  d7,-(sp)
										lea     aNothing_1(pc), a0
										moveq   #$FFFFFFD6,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										move.w  (sp)+,d7
										rts

	; End of function WriteMemberItemsList


; =============== S U B R O U T I N E =======================================

LoadItemIcon:
										
										andi.w  #ITEM_MASK_IDX,d1
										movea.l (p_Icons).l,a0
										bra.w   LoadIcon

	; End of function LoadItemIcon


; =============== S U B R O U T I N E =======================================

LoadSpellIcon:
										
										andi.w  #$3F,d1 
										movea.l (p_Icons).l,a0
										cmpi.w  #$3F,d1 
										bne.s   loc_13B7E
										move.w  #$7F,d1 
										bra.s   LoadIcon
loc_13B7E:
										
										addi.w  #$82,d1 

	; End of function LoadSpellIcon


; START OF FUNCTION CHUNK FOR LoadItemIcon

LoadIcon:
										move.w  d1,d2
										add.w   d1,d1
										add.w   d2,d1
										lsl.w   #6,d1
										adda.w  d1,a0           ; icon offset
										moveq   #$2F,d7 
loc_13B8E:
										
										move.l  (a0)+,(a1)+
										dbf     d7,loc_13B8E
										ori.w   #$F,-2(a1)
										ori.w   #$F000,-$24(a1)
										ori.w   #$F,-$9E(a1)
										ori.w   #$F000,-$C0(a1)
										rts

; END OF FUNCTION CHUNK FOR LoadItemIcon


; =============== S U B R O U T I N E =======================================

DrawMemberItemsIconsCross:
										
										move.w  -2(a6),d0
										lea     (FF6802_LOADING_SPACE).l,a1
										clr.w   d1
										jsr     j_GetItemAndNumberOfItems
										bsr.s   LoadItemIcon
										moveq   #1,d1
										jsr     j_GetItemAndNumberOfItems
										bsr.s   LoadItemIcon
										moveq   #2,d1
										jsr     j_GetItemAndNumberOfItems
										bsr.s   LoadItemIcon
										moveq   #3,d1
										jsr     j_GetItemAndNumberOfItems
										bsr.w   LoadItemIcon
										bra.w   loc_13C20

	; End of function DrawMemberItemsIconsCross


; =============== S U B R O U T I N E =======================================

DrawMemberMagicIconsCross:
										
										move.w  -2(a6),d0
										lea     (FF6802_LOADING_SPACE).l,a1
										clr.w   d1
										jsr     j_GetSpellAndNumberOfSpells
										bsr.w   LoadSpellIcon
										moveq   #1,d1
										jsr     j_GetSpellAndNumberOfSpells
										bsr.w   LoadSpellIcon
										moveq   #2,d1
										jsr     j_GetSpellAndNumberOfSpells
										bsr.w   LoadSpellIcon
										moveq   #3,d1
										jsr     j_GetSpellAndNumberOfSpells
										bsr.w   LoadSpellIcon
loc_13C20:
										
										lea     (FF6802_LOADING_SPACE).l,a0
										lea     ($BC00).l,a1
										move.w  #$180,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
loc_13C36:
										
										movea.l -6(a6),a1
										move.l  #$C5E0C5E1,$DC(a1)
										move.l  #$C5E2C5E3,$106(a1)
										move.l  #$C5E4C5E5,$130(a1)
										move.l  #$C5E6C5E7,$12A(a1)
										move.l  #$C5E8C5E9,$154(a1)
										move.l  #$C5EAC5EB,$17E(a1)
										move.l  #$C5ECC5ED,$136(a1)
										move.l  #$C5EEC5EF,$160(a1)
										move.l  #$C5F0C5F1,$18A(a1)
										move.l  #$C5F2C5F3,$184(a1)
										move.l  #$C5F4C5F5,$1AE(a1)
										move.l  #$C5F6C5F7,$1D8(a1)
										rts

	; End of function DrawMemberMagicIconsCross


; =============== S U B R O U T I N E =======================================

CopyWindowTilesToRAM:
										
										movem.w d0-d1/d6-d7,-(sp)
										clr.w   d1
										move.b  d0,d1
										lsr.w   #8,d0
										move.w  d0,d6
										subq.l  #3,d6
										move.w  #$C060,(a1)+
loc_13CAE:
										
										move.w  #$C061,(a1)+
										dbf     d6,loc_13CAE
										move.w  #$C860,(a1)+
										move.w  d1,d7
										subq.w  #3,d7
loc_13CBE:
										
										move.w  d0,d6
										subq.w  #3,d6
										move.w  #$C070,(a1)+
loc_13CC6:
										
										move.w  #$C020,(a1)+
										dbf     d6,loc_13CC6
										move.w  #$C870,(a1)+
										dbf     d7,loc_13CBE
										move.w  d0,d6
										subq.l  #3,d6
										move.w  #$D060,(a1)+
loc_13CDE:
										
										move.w  #$D061,(a1)+
										dbf     d6,loc_13CDE
										move.w  #$D860,(a1)+
										movem.w (sp)+,d0-d1/d6-d7
										rts

	; End of function CopyWindowTilesToRAM

aNameClassLevExp:   dc.b 'NAME    CLASS     LEV EXP',0
aNameHpMpAtDfAgMv:  dc.b 'NAME    HP MP AT DF AG MV',0
aNameAttackDefense: dc.b 'NAME    ATTACK   DEFENSE',0
aMagicItem:         dc.b 'MAGIC     ITEM'
aItem_3:            dc.b '- ITEM -',0
aMagic_2:           dc.b '- MAGIC -',0
aLevel:             dc.b 'LEVEL',0
aUnequippable:      dc.b '\unequippable',0
aEquipment:         dc.b 'Equipment ',0
aAtt:               dc.b 'ATT  ',0
aDef:               dc.b 'DEF  ',0
aMov:               dc.b 'MOV  ',0
aAgi:               dc.b 'AGI  ',0
aNothing_2:         dc.b '\Nothing',0
TextHighlightTiles: incbin "graphics/technical/texthighlighttiles.bin"
unk_13EDE:          dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20

; =============== S U B R O U T I N E =======================================

sub_13F14:
										
										movem.l d0/d3-a1,-(sp)
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										moveq   #0,d1
										jsr     j_GetItemAndNumberOfItems
										move.w  d1,(a0)+
										moveq   #1,d1
										jsr     j_GetItemAndNumberOfItems
										move.w  d1,(a0)+
										moveq   #2,d1
										jsr     j_GetItemAndNumberOfItems
										move.w  d1,(a0)+
										moveq   #3,d1
										jsr     j_GetItemAndNumberOfItems
										move.w  d1,(a0)+
										clr.b   ((CURRENT_DIAMENU_CHOICE-$1000000)).w
										lea     (DMA_SPACE_FF8804).l,a1
										move.w  ((DISPLAYED_ICON_1-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_2-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_3-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_4-$1000000)).w,d0
										bsr.w   LoadHighlightableItemIcon
										bsr.w   CleanIconCorners
										jsr     (WaitForVInt).w 
										moveq   #$1E,d6
loc_13F88:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_13FA2
										moveq   #1,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_2-$1000000)).w 
										beq.s   loc_13FA2
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_1401E
loc_13FA2:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_13FBC
										moveq   #2,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_3-$1000000)).w 
										beq.s   loc_13FBC
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_1401E
loc_13FBC:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_13FCE
										clr.w   d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_1401E
loc_13FCE:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_13FE8
										moveq   #3,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_4-$1000000)).w 
										beq.s   loc_13FE8
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_1401E
loc_13FE8:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_13FFA
										move.b  #$FF,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bra.w   loc_14052
loc_13FFA:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1400C
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_14052
loc_1400C:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14034
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_14052
loc_1401E:
										
										move.w  d1,-(sp)
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										clr.w   d6
										bsr.w   DoSomethingRelatedToMenuChoice
										move.w  (sp)+,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										moveq   #$1D,d6
loc_14034:
										
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   DoSomethingRelatedToMenuChoice
										moveq   #$14,d1
										bsr.w   sub_146AE
										subq.w  #1,d6
										bne.s   loc_1404A
										moveq   #$1E,d6
loc_1404A:
										
										jsr     (WaitForVInt).w 
										bra.w   loc_13F88
loc_14052:
										
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d1
										ext.w   d1
										bpl.s   loc_14062
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										moveq   #$FFFFFFFF,d1
										bra.s   loc_1406E
loc_14062:
										
										move.w  d1,d2
										add.w   d2,d2
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										move.w  (a0,d2.w),d2
loc_1406E:
										
										movem.l (sp)+,d0/d3-a1
										rts

	; End of function sub_13F14


; =============== S U B R O U T I N E =======================================

DoSomethingRelatedToMenuChoice:
										
										moveq   #$7F,d7 
										add.w   d0,d0           ; d0 is current diamond-menu choice
										move.w  rjt_14080(pc,d0.w),d0
										jmp     rjt_14080(pc,d0.w)

	; End of function DoSomethingRelatedToMenuChoice

rjt_14080:          dc.w DMAicon1-rjt_14080
										dc.w DMAicon2-rjt_14080
										dc.w DMAicon3-rjt_14080
										dc.w DMAicon4-rjt_14080

; =============== S U B R O U T I N E =======================================

DMAicon1:
										lea     (DMA_SPACE_FF8804).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_14098
										adda.w  #$C0,a0 
loc_14098:
										
										lea     ($BC00).l,a1
										move.w  #$60,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function DMAicon1


; =============== S U B R O U T I N E =======================================

DMAicon2:
										lea     (byte_FF8984).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_140B8
										adda.w  #$C0,a0 
loc_140B8:
										
										lea     ($BCC0).l,a1
										move.w  #$60,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function DMAicon2


; =============== S U B R O U T I N E =======================================

DMAicon3:
										lea     (byte_FF8B04).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_140D8
										adda.w  #$C0,a0 
loc_140D8:
										
										lea     ($BD80).l,a1
										move.w  #$60,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function DMAicon3


; =============== S U B R O U T I N E =======================================

DMAicon4:
										lea     (byte_FF8C84).l,a0
										cmpi.w  #$F,d6
										blt.s   loc_140F8
										adda.w  #$C0,a0 
loc_140F8:
										
										lea     ($BE40).l,a1
										move.w  #$60,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function DMAicon4


; =============== S U B R O U T I N E =======================================

sub_14108:
										
										movem.l d0/d3-a2,-(sp)
loc_1410C:
										
										jsr     j_GetEquippableWeapons
										tst.w   d1
										beq.w   loc_14162
										movea.l a0,a2
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a1
										move.w  (a0),(a1)+
										move.w  4(a0),(a1)+
										move.w  8(a0),(a1)+
										move.w  $C(a0),(a1)+
										move.w  d1,d3
										jsr     j_GetEquippedWeapon
										bsr.w   sub_141CE
										tst.w   d1
										bpl.s   loc_1414A
										moveq   #1,d7
										bsr.w   sub_143E0
										jsr     (WaitForVint_andFFA900Clear).w
										bra.w   loc_141C8
loc_1414A:
										
										lsl.w   #2,d1
										move.w  (a2,d1.w),d2
										move.w  2(a2,d1.w),d1
										move.w  d2,d5
										move.w  d1,d4
										jsr     j_GetEquippedWeapon
										bsr.w   sub_1477E
loc_14162:
										
										jsr     j_GetEquippableRings
										tst.w   d1
										beq.w   loc_141C8
										movea.l a0,a2
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a1
										move.w  (a0),(a1)+
										move.w  4(a0),(a1)+
										move.w  8(a0),(a1)+
										move.w  $C(a0),(a1)+
										move.w  d1,d3
										jsr     j_GetEquippedRing
										bsr.w   sub_141CE
										tst.w   d1
										bpl.s   loc_141B0
										jsr     j_GetEquippableWeapons
										tst.w   d1
										bne.s   loc_141AC
										moveq   #1,d7
										bsr.w   sub_143E0
										jsr     (WaitForVint_andFFA900Clear).w
										moveq   #$FFFFFFFF,d1
										bra.w   loc_141C8
loc_141AC:
										
										bra.w   loc_1410C
loc_141B0:
										
										lsl.w   #2,d1
										move.w  (a2,d1.w),d2
										move.w  2(a2,d1.w),d1
										move.w  d2,d5
										move.w  d1,d4
										jsr     j_GetEquippedRing
										bsr.w   sub_1477E
loc_141C8:
										
										movem.l (sp)+,d0/d3-a2
										rts

	; End of function sub_14108


; =============== S U B R O U T I N E =======================================

sub_141CE:
										
										movem.l d0/d2-a2,-(sp)
										tst.w   d1
										bpl.s   loc_141EA
										cmpi.w  #4,d3
										bne.s   loc_141E6
										clr.w   d1
										jsr     j_EquipItem
										bra.s   loc_141E8
loc_141E6:
										
										moveq   #3,d1
loc_141E8:
										
										bra.s   loc_141FE
loc_141EA:
										
										move.l  a0,-(sp)
										moveq   #3,d7
										moveq   #$FFFFFFFF,d1
loc_141F0:
										
										addq.w  #1,d1
										addq.l  #2,a0
										move.w  (a0)+,d4
										cmp.w   d2,d4
										dbeq    d7,loc_141F0
										movea.l (sp)+,a0
loc_141FE:
										
										move.b  d1,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										move.w  d1,-(sp)
										moveq   #3,d7
										bsr.w   sub_143E0
										jsr     j_GetStatus
										move.w  d1,-$A(a6)
										lea     (DMA_SPACE_FF8804).l,a1
										move.w  ((DISPLAYED_ICON_1-$1000000)).w,d0
										bsr.w   LoadHighlightableIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_2-$1000000)).w,d0
										bsr.w   LoadHighlightableIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_3-$1000000)).w,d0
										bsr.w   LoadHighlightableIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_4-$1000000)).w,d0
										bsr.w   LoadHighlightableIcon
										bsr.w   CleanIconCorners
										clr.w   d6
										moveq   #$1F,d7
										bsr.w   DMAicon1
										bsr.w   DMAicon2
										bsr.w   DMAicon3
										bsr.w   DMAicon4
										jsr     (WaitForVint_andFFA900Clear).w
										moveq   #$1E,d6
loc_14264:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1427E
										moveq   #1,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_2-$1000000)).w 
										beq.s   loc_1427E
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_142FA
loc_1427E:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14298
										moveq   #2,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_3-$1000000)).w 
										beq.s   loc_14298
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_142FA
loc_14298:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_142AA
										clr.w   d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_142FA
loc_142AA:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_142C4
										moveq   #3,d1
										cmpi.w  #$7F,((DISPLAYED_ICON_4-$1000000)).w 
										beq.s   loc_142C4
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_142FA
loc_142C4:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_142D6
										move.b  #$FF,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bra.w   loc_1438C
loc_142D6:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_142E8
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_1438C
loc_142E8:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14366
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_1438C
loc_142FA:
										
										move.w  d1,-(sp)
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										clr.w   d6
										bsr.w   DoSomethingRelatedToMenuChoice
										move.w  (sp)+,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										move.w  d0,d2
										move.w  -2(a6),d0
										lsl.w   #2,d2
										lea     ((RAM_EquippableItemList-$1000000)).w,a2
										move.w  (a2,d2.w),d5
										move.w  2(a2,d2.w),d6
										move.w  (a2),d1
										jsr     j_GetItemType
										tst.w   d2
										blt.s   loc_14336
										jsr     j_UnequipWeapon
										bra.s   loc_1433C
loc_14336:
										
										jsr     j_UnequipRing
loc_1433C:
										
										move.w  d6,d1
										cmpi.w  #4,d1
										bge.s   loc_1434A
										jsr     j_EquipItem
loc_1434A:
										
										move.w  -$A(a6),d1
										jsr     j_SetStatus
										bsr.w   sub_137AC
										move.w  -8(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										moveq   #$1D,d6
loc_14366:
										
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   DoSomethingRelatedToMenuChoice
										moveq   #$14,d1
										bsr.w   sub_146AE
										move.b  #$10,(byte_FFDCCB).l
										subq.w  #1,d6
										bne.s   loc_14384
										moveq   #$1E,d6
loc_14384:
										
										jsr     (WaitForVInt).w 
										bra.w   loc_14264
loc_1438C:
										
										move.w  -2(a6),d0
										move.w  ((RAM_EquippableItemList-$1000000)).w,d1
										jsr     j_GetItemType
										tst.w   d2
										blt.s   loc_143A6
										jsr     j_UnequipWeapon
										bra.s   loc_143AC
loc_143A6:
										
										jsr     j_UnequipRing
loc_143AC:
										
										move.w  (sp)+,d1
										lsl.w   #2,d1
										lea     ((RAM_EquippableItemList-$1000000)).w,a0
										move.w  2(a0,d1.w),d1
										cmpi.w  #CHAR_ITEMSLOTS,d1
										bge.s   loc_143C4
										jsr     j_EquipItem
loc_143C4:
										
										move.w  -$A(a6),d1
										jsr     j_SetStatus
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d1
										ext.w   d1
										movem.l (sp)+,d0/d2-a2
										move.b  #1,((word_FFAF8C-$1000000)).w
										rts

	; End of function sub_141CE


; =============== S U B R O U T I N E =======================================

sub_143E0:
										
										movem.w d0-d7,-(sp)
										move.w  -8(a6),d0
										move.w  #$2001,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.b  d7,((word_FFAF8C-$1000000)).w
										clr.w   d5
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d5
										lsl.w   #1,d5
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										move.w  (a0,d5.w),d5
										bsr.w   sub_137AC
										move.w  -8(a6),d0
										move.w  #$A01,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										movem.w (sp)+,d0-d7
										rts

	; End of function sub_143E0


; =============== S U B R O U T I N E =======================================

sub_14422:
										
										movem.w d0-d2/d7,-(sp)
										move.w  -4(a6),d0
										move.w  #$21C,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										movem.w (sp)+,d0-d2/d7
										rts

	; End of function sub_14422


; =============== S U B R O U T I N E =======================================

sub_1443E:
										
										movem.w d0-d2/d7,-(sp)
										move.w  -4(a6),d0
										move.w  #$20E,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										movem.w (sp)+,d0-d2/d7
										rts

	; End of function sub_1443E


; =============== S U B R O U T I N E =======================================

sub_1445A:
										
										movem.l d0/d3-a1,-(sp)
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										moveq   #0,d1
										jsr     j_GetSpellAndNumberOfSpells
										andi.w  #$7F,d1 
										move.w  d1,(a0)+
										moveq   #1,d1
										jsr     j_GetSpellAndNumberOfSpells
										andi.w  #$7F,d1 
										move.w  d1,(a0)+
										moveq   #2,d1
										jsr     j_GetSpellAndNumberOfSpells
										andi.w  #$7F,d1 
										move.w  d1,(a0)+
										moveq   #3,d1
										jsr     j_GetSpellAndNumberOfSpells
										andi.w  #$7F,d1 
										move.w  d1,(a0)+
										clr.b   ((CURRENT_DIAMENU_CHOICE-$1000000)).w
										lea     (DMA_SPACE_FF8804).l,a1
										move.w  ((DISPLAYED_ICON_1-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_2-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_3-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										bsr.w   CleanIconCorners
										move.w  ((DISPLAYED_ICON_4-$1000000)).w,d0
										bsr.w   LoadIHighlightableSpellIcon
										bsr.w   CleanIconCorners
loc_144D8:
										
										jsr     (WaitForVInt).w 
										moveq   #$1E,d6
loc_144DE:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_144F8
										moveq   #1,d1
										cmpi.w  #$3F,((DISPLAYED_ICON_2-$1000000)).w 
										beq.s   loc_144F8
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_14574
loc_144F8:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14512
										moveq   #2,d1
										cmpi.w  #$3F,((DISPLAYED_ICON_3-$1000000)).w 
										beq.s   loc_14512
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_14574
loc_14512:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14524
										clr.w   d1
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_14574
loc_14524:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1453E
										moveq   #3,d1
										cmpi.w  #$3F,((DISPLAYED_ICON_4-$1000000)).w 
										beq.s   loc_1453E
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_14574
loc_1453E:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14550
										move.b  #$FF,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bra.w   loc_145A8
loc_14550:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14562
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_145A8
loc_14562:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1458A
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_145A8
loc_14574:
										
										move.w  d1,-(sp)
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										clr.w   d6
										bsr.w   DoSomethingRelatedToMenuChoice
										move.w  (sp)+,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										moveq   #$1D,d6
loc_1458A:
										
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   DoSomethingRelatedToMenuChoice
										moveq   #$14,d1
										bsr.w   sub_146AE
										subq.w  #1,d6
										bne.s   loc_145A0
										moveq   #$1E,d6
loc_145A0:
										
										jsr     (WaitForVInt).w 
										bra.w   loc_144DE
loc_145A8:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d1
										ext.w   d1
										bpl.s   loc_145BC
										moveq   #$FFFFFFFF,d1
										movem.l (sp)+,d0/d3-a1
										rts

	; End of function sub_1445A


; START OF FUNCTION CHUNK FOR sub_1445A

loc_145BC:
										
										move.w  d1,d2
										add.w   d2,d2
										lea     ((DISPLAYED_ICON_1-$1000000)).w,a0
										move.w  (a0,d2.w),d2
										move.w  d2,-(sp)
										moveq   #$1E,d6
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   DoSomethingRelatedToMenuChoice
										move.w  (sp)+,d2
										move.w  d2,d4
										lsr.w   #6,d4
										move.w  d4,d3
										moveq   #$13,d1
										bsr.w   sub_146AE
										jsr     (WaitForVInt).w 
										moveq   #$14,d1
loc_145EA:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14600
										tst.w   d3
										ble.s   loc_14600
										subq.w  #1,d3
										trap    #TRAP_SOUNDCOM

; END OF FUNCTION CHUNK FOR sub_1445A

										dc.w SFX_MENU_SELECTION
										bra.w   loc_1463E

; START OF FUNCTION CHUNK FOR sub_1445A

loc_14600:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14616
										cmp.w   d4,d3
										bge.s   loc_14616
										addq.w  #1,d3
										trap    #TRAP_SOUNDCOM

; END OF FUNCTION CHUNK FOR sub_1445A

										dc.w SFX_MENU_SELECTION
										bra.w   loc_1463E

; START OF FUNCTION CHUNK FOR sub_1445A

loc_14616:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14626
										move.b  #$FF,d3
										bra.w   loc_14654
loc_14626:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14632
										bra.w   loc_14654
loc_14632:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14644
										bra.w   loc_14654

; END OF FUNCTION CHUNK FOR sub_1445A

loc_1463E:          bsr.w   sub_1474C
										moveq   #$13,d1

; START OF FUNCTION CHUNK FOR sub_1445A

loc_14644:
										
										bsr.w   sub_146AE
										subq.w  #1,d1
										bne.s   loc_1464E
										moveq   #$14,d1
loc_1464E:
										
										jsr     (WaitForVInt).w 
										bra.s   loc_145EA
loc_14654:
										
										moveq   #$13,d1
										bsr.w   sub_146AE
										tst.b   d3
										bpl.s   loc_1466C
										trap    #TRAP_SOUNDCOM

; END OF FUNCTION CHUNK FOR sub_1445A

										dc.w SFX_VALIDATION
										move.w  d4,d3
										bsr.w   sub_1474C
										bra.w   loc_144D8

; START OF FUNCTION CHUNK FOR sub_1445A

loc_1466C:
										
										move.w  d2,d1
										andi.w  #$3F,d1 
										lsl.w   #6,d3
										or.w    d3,d1
										movem.l (sp)+,d0/d3-a1  ;     fixSelectionRectCorners
																						;     Remove white pixels from corners of spell/item selection rect.
																						;     In: A1 = end of selection rect section in RAM
										rts

; END OF FUNCTION CHUNK FOR sub_1445A


; =============== S U B R O U T I N E =======================================

CleanIconCorners:
										
										ori.w   #$F,-2(a1)
										ori.w   #$F000,-$24(a1)
										ori.w   #$F,-$9E(a1)
										ori.w   #$F000,-$C0(a1)
										ori.w   #$F,-$C2(a1)
										ori.w   #$F000,-$E4(a1)
										ori.w   #$F,-$15E(a1)
										ori.w   #$F000,-$180(a1)
										rts

	; End of function CleanIconCorners


; =============== S U B R O U T I N E =======================================

sub_146AE:
										
										movem.w d0/d2,-(sp)
										lea     (byte_FFDCC0).l,a0
										lea     unk_14724(pc), a1
										move.w  ((word_FFB138-$1000000)).w,d0
										lsl.w   #4,d0
										tst.b   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										beq.s   loc_146CE
										moveq   #1,d1
										move.w  #$100,d0
loc_146CE:
										
										moveq   #1,d7
loc_146D0:
										
										move.w  (a1)+,(a0)
										add.w   d0,(a0)
										move.w  (a1)+,d2
										move.w  d2,2(a0)
										move.w  (a1)+,4(a0)
										move.w  (a1)+,6(a0)
										addq.l  #8,a0
										dbf     d7,loc_146D0
										cmpi.w  #7,d1
										bge.s   loc_146F4
										move.w  #$100,d0
										bra.s   loc_146F6
loc_146F4:
										
										clr.w   d0
loc_146F6:
										
										clr.w   d2
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d2
										lsl.w   #4,d2
										add.w   d2,d0
										moveq   #2,d7
loc_14702:
										
										move.w  (a1)+,(a0)
										add.w   d0,(a0)
										move.w  (a1)+,d2
										move.w  d2,2(a0)
										move.w  (a1)+,4(a0)
										move.w  (a1)+,6(a0)
										addq.l  #8,a0
										dbf     d7,loc_14702
										bsr.w   sub_101E6
										movem.w (sp)+,d0/d2
										rts

	; End of function sub_146AE

unk_14724:          dc.b   1
										dc.b   4
										dc.b  $D
										dc.b   9
										dc.b $C5 
										dc.b $C0 
										dc.b   0
										dc.b $9C 
										dc.b   1
										dc.b   4
										dc.b  $D
										dc.b  $A
										dc.b $CD 
										dc.b $C0 
										dc.b   0
										dc.b $BC 
										dc.b   0
										dc.b $A8 
										dc.b  $D
										dc.b  $B
										dc.b $C5 
										dc.b $C0 
										dc.b   1
										dc.b $2C 
										dc.b   0
										dc.b $A8 
										dc.b   5
										dc.b  $C
										dc.b $C5 
										dc.b $C2 
										dc.b   1
										dc.b $4C 
										dc.b   0
										dc.b $A8 
										dc.b  $D
										dc.b $10
										dc.b $CD 
										dc.b $C0 
										dc.b   1
										dc.b $54 

; =============== S U B R O U T I N E =======================================

sub_1474C:
										
										move.w  -8(a6),d0
										clr.w   d1
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d1
										add.w   d1,d1
										addq.w  #5,d1
										ori.w   #$1300,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										clr.w   d1
										move.w  d3,d0
										addq.w  #1,d0
										ext.l   d0
										moveq   #1,d7
										bsr.w   WriteTilesFromNumber
										move.w  -8(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										rts

	; End of function sub_1474C


; =============== S U B R O U T I N E =======================================

sub_1477E:
										
										cmpi.w  #$FFFF,d1
										beq.w   loc_147B8
										move.w  d2,d1
										jsr     j_UnequipItemIfNotCursed
										cmpi.w  #2,d2
										bne.w   loc_147B8
										cmp.w   d4,d1
										beq.w   return_147E6
										jsr     sub_14422(pc)
										trap    #TRAP_SOUNDCOM
										dc.w MUSIC_CURSED_ITEM  ; cursed item effect
										trap    #TRAP_TEXTBOX
										dc.w $2B                ; "Gosh!  The curse prohibits{N}you from exchanging{N}equipment!{W2}"
										bsr.w   WaitForMusicResumeAndPlayerInput_0
										trap    #TRAP_TEXTBOX
										dc.w $FFFF
										jsr     sub_1443E(pc)
										bra.w   return_147E6
loc_147B8:
										
										move.w  d4,d1
										jsr     j_EquipItem
										cmpi.w  #2,d2
										bne.w   return_147E6
										move.w  d0,(RAM_Dialogue_NameIdx1).l
										jsr     sub_14422(pc)
										trap    #TRAP_SOUNDCOM
										dc.w MUSIC_CURSED_ITEM  ; cursed item effect
										trap    #TRAP_TEXTBOX
										dc.w $22                ; "Gosh!  {NAME} is{N}cursed!{W2}"
										bsr.w   WaitForMusicResumeAndPlayerInput_0
										trap    #TRAP_TEXTBOX
										dc.w $FFFF
										jsr     sub_1443E(pc)
return_147E6:
										
										rts

	; End of function sub_1477E


; =============== S U B R O U T I N E =======================================

WaitForMusicResumeAndPlayerInput_0:
										
										move.w  d0,-(sp)
										move.w  #$FB,d0 
										jsr     (PlayMusicAfterCurrentOne).w
										jsr     (WaitForPlayerInput).w
										move.w  (sp)+,d0
										rts

	; End of function WaitForMusicResumeAndPlayerInput_0


; =============== S U B R O U T I N E =======================================

sub_147FA:
										
										move.w  ((word_FFB130-$1000000)).w,d0
										mulu.w  #6,d0
										add.w   ((word_FFB132-$1000000)).w,d0
										cmp.w   ((word_FFB12E-$1000000)).w,d0
										blt.s   loc_14814
										clr.w   ((word_FFB130-$1000000)).w
										clr.w   ((word_FFB132-$1000000)).w
loc_14814:
										
										link    a6,#-$F0
										move.w  #$1B06,d0
										move.w  #$2F7,d1
										jsr     (CreateWindow).l
										move.w  d0,-2(a6)
										move.l  a1,-6(a6)
										bsr.w   sub_14BB0       
										move.w  #$A05,d0
										move.w  #$F606,d1
										jsr     (CreateWindow).l
										move.w  d0,-8(a6)
										move.l  a1,-$C(a6)
										bsr.w   sub_14B68
										move.w  #$904,d0
										move.w  #$2017,d1
										jsr     (CreateWindow).l
										move.w  d0,-$E(a6)
										move.l  a1,-$12(a6)
										bsr.w   sub_14B28
										move.w  -2(a6),d0
										move.w  #$201,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										move.w  -8(a6),d0
										move.w  #$106,d1
										move.w  ((word_FFB132-$1000000)).w,d2
										lsl.w   #2,d2
										lsl.w   #8,d2
										add.w   d2,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										move.w  -$E(a6),d0
										move.w  #$1617,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										lea     unk_151D6(pc), a0
										lea     ($FE00).l,a1
										move.w  #$100,d0
										jsr     (DmaTilesViaFF8804bis).w
										jsr     (WaitForVint_andFFA900Clear).l
										bsr.w   sub_14EDE
loc_148BC:
										
										move.w  ((word_FFB132-$1000000)).w,d0
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_14906
										move.w  ((word_FFB130-$1000000)).w,d2
										mulu.w  #6,d2
										add.w   d0,d2
										addq.w  #1,d2
										cmp.w   ((word_FFB12E-$1000000)).w,d2
										bge.s   loc_14906
										addq.w  #1,d0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										cmp.w   ((word_FFB134-$1000000)).w,d0
										blt.s   loc_148FA
										addq.w  #1,((word_FFB130-$1000000)).w
										clr.w   ((word_FFB132-$1000000)).w
										clr.b   ((word_FFAF9E-$1000000)).w
										bsr.w   sub_14E62
										bra.w   loc_149E0
loc_148FA:
										
										move.w  d0,((word_FFB132-$1000000)).w
										bsr.w   sub_14EC0
										bra.w   loc_149E0
loc_14906:
										
										move.w  ((word_FFB132-$1000000)).w,d0
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1494A
										move.w  ((word_FFB130-$1000000)).w,d2
										mulu.w  #6,d2
										add.w   d0,d2
										ble.s   loc_1494A
										subq.w  #1,d0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bge.s   loc_1493E
										subq.w  #1,((word_FFB130-$1000000)).w
										move.w  #5,((word_FFB132-$1000000)).w
										move.b  #1,((word_FFAF9E-$1000000)).w
										bsr.w   sub_14E62
										bra.w   loc_149E0
loc_1493E:
										
										move.w  d0,((word_FFB132-$1000000)).w
										bsr.w   sub_14EC0
										bra.w   loc_149E0
loc_1494A:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_1496A
										tst.w   ((word_FFB130-$1000000)).w
										beq.s   loc_1496A
										subq.w  #1,((word_FFB130-$1000000)).w
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										move.b  #1,((word_FFAF9E-$1000000)).w
										bsr.w   sub_14E62
loc_1496A:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_149C2
										move.w  ((word_FFB130-$1000000)).w,d2
										addq.w  #1,d2
										mulu.w  #6,d2
										cmp.w   ((word_FFB12E-$1000000)).w,d2
										bge.s   loc_149C2
										addq.w  #1,((word_FFB130-$1000000)).w
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										move.w  ((word_FFB132-$1000000)).w,d0
										move.w  ((word_FFB130-$1000000)).w,d2
										move.w  d2,d1
										add.w   d2,d2
										add.w   d1,d2
										add.w   d2,d2
										move.w  ((word_FFB12E-$1000000)).w,d1
										sub.w   d2,d1
										cmpi.w  #6,d1
										ble.s   loc_149A8
										moveq   #6,d1
loc_149A8:
										
										move.w  d1,((word_FFB134-$1000000)).w
loc_149AC:
										
										cmp.w   d1,d0
										blt.w   loc_149B6
										subq.w  #1,d0
										bne.s   loc_149AC
loc_149B6:
										
										move.w  d0,((word_FFB132-$1000000)).w
										clr.b   ((word_FFAF9E-$1000000)).w
										bsr.w   sub_14E62
loc_149C2:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_149EC
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_149F2
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_149F2
loc_149E0:
										
										bsr.w   sub_14A82
										jsr     (WaitForVInt).w 
										bra.w   loc_148BC
loc_149EC:
										
										moveq   #$FFFFFFFF,d0
										bra.w   loc_14A0A
loc_149F2:
										
										move.w  ((word_FFB130-$1000000)).w,d1
										mulu.w  #6,d1
										add.w   ((word_FFB132-$1000000)).w,d1
										lea     ((byte_FFB0AE-$1000000)).w,a0
										move.b  (a0,d1.w),d0
										andi.w  #$FF,d0
loc_14A0A:
										
										movem.w d0-d1,-(sp)
										clr.w   d1
										bsr.s   sub_14A82
										move.w  ((TEXT_WINDOW_INDEX-$1000000)).w,d0
										beq.s   loc_14A26
										subq.w  #1,d0
										move.w  #$8080,d1
										moveq   #4,d2
										jsr     (MoveWindowWithoutSFX).l
loc_14A26:
										
										move.w  -2(a6),d0
										move.w  #$2F7,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										move.w  -8(a6),d0
										move.w  #$F606,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										move.w  -$E(a6),d0
										move.w  #$2017,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
										move.w  -$E(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										move.w  -8(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										move.w  -2(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										movem.w (sp)+,d0-d1
										unlk    a6
										rts

	; End of function sub_147FA


; =============== S U B R O U T I N E =======================================

sub_14A82:
										
										lea     (byte_FFDCC0).l,a0
										cmpi.w  #7,d1
										bge.s   loc_14A9A
										move.w  #1,(a0)
										move.w  #1,6(a0)
										bra.s   loc_14AAC
loc_14A9A:
										
										move.w  ((word_FFB132-$1000000)).w,d0
										lsl.w   #5,d0
										addi.w  #$9C,d0 
										move.w  d0,6(a0)
										move.w  #$91,(a0) 
loc_14AAC:
										
										move.w  #$F09,2(a0)
										move.w  #$C7F0,4(a0)
										addq.l  #8,a0
										move.w  #1,(a0)
										move.w  #1,6(a0)
										tst.w   ((word_FFB130-$1000000)).w
										beq.s   loc_14AE6
										cmpi.w  #7,d1
										blt.s   loc_14ADA
										move.w  #$98,6(a0) 
										move.w  #$90,(a0) 
loc_14ADA:
										
										move.w  #$A,2(a0)
										move.w  #$D064,4(a0)
loc_14AE6:
										
										addq.l  #8,a0
										move.w  #1,(a0)
										move.w  #1,6(a0)
										move.w  ((word_FFB130-$1000000)).w,d0
										addq.w  #1,d0
										mulu.w  #6,d0
										cmp.w   ((word_FFB12E-$1000000)).w,d0
										bge.s   loc_14B1E
										cmpi.w  #7,d1
										blt.s   loc_14B12
										move.w  #$158,6(a0)
										move.w  #$A8,(a0) 
loc_14B12:
										
										move.w  #$10,2(a0)
										move.w  #$C064,4(a0)
loc_14B1E:
										
										subq.w  #1,d1
										bne.s   loc_14B24
										moveq   #$14,d1
loc_14B24:
										
										bra.w   sub_101E6

	; End of function sub_14A82


; =============== S U B R O U T I N E =======================================

sub_14B28:
										
										move.w  #$904,d0
										movea.l -$12(a6),a1
										bsr.w   sub_1018E       
										lea     aGold(pc), a0   
										movea.l -$12(a6),a1
										adda.w  #$14,a1
										moveq   #$FFFFFFEE,d1
										moveq   #$A,d7
										bsr.w   WriteTilesFromASCII
										jsr     j_GetGold
										move.l  d1,d0
										movea.l -$12(a6),a1
										adda.w  #$26,a1 
										moveq   #7,d7
										jsr     WriteTilesFromNumber
										rts

	; End of function sub_14B28

aGold:              dc.b 'GOLD',0
										dc.b 0

; =============== S U B R O U T I N E =======================================

sub_14B68:
										
										move.w  #$A05,d0
										movea.l -$C(a6),a1
										bsr.w   sub_1018E       
										bsr.w   sub_14CEC       
										move.w  d0,d1
										move.w  d1,-(sp)
										jsr     j_FindItemName
										movea.l -$C(a6),a1
										adda.w  #$16,a1
										moveq   #$FFFFFFEC,d1
										bsr.w   WriteTilesFromASCII
										move.w  (sp)+,d1
										jsr     j_GetItemDefAddress
										clr.l   d0
										move.w  6(a0),d0
										movea.l -$C(a6),a1
										adda.w  #$44,a1 
										moveq   #5,d7
										jsr     WriteTilesFromNumber
										rts

	; End of function sub_14B68


; =============== S U B R O U T I N E =======================================

; copy item icon tiles into RAM based on index list at RAM:b0ae

sub_14BB0:
										
										movea.l -6(a6),a1
										lea     unk_1505C(pc), a0
										move.w  #$144,d7
										jsr     (CopyBytes).w   
										bsr.w   *+4
										lea     (byte_FF6942).l,a0
										move.w  #$63F,d7
loc_14BCE:
										
										move.l  #$FFFFFFFF,(a0)+
										dbf     d7,loc_14BCE
										lea     ((byte_FFB0AE-$1000000)).w,a1
										move.w  ((word_FFB130-$1000000)).w,d0
										move.w  d0,d1
										add.w   d0,d0
										add.w   d1,d0
										add.w   d0,d0
										adda.w  d0,a1
										move.w  ((word_FFB12E-$1000000)).w,d1
										sub.w   d0,d1
										cmpi.w  #6,d1
										ble.s   loc_14BF8
										moveq   #6,d1
loc_14BF8:
										
										move.w  d1,((word_FFB134-$1000000)).w
										move.w  d1,d7
										subq.w  #1,d7
										lea     (FF6802_LOADING_SPACE).l,a0
										movea.l -6(a6),a2
										adda.w  #$3C,a2 
loc_14C0E:
										
										clr.w   d0
										move.b  (a1)+,d0
										move.w  d7,-(sp)
										bsr.w   sub_14CB2       
										move.l  a0,-(sp)
										move.w  d0,d1
										jsr     j_GetItemDefAddress
										clr.l   d0
										move.w  ITEMDEF_OFFSET_PRICE(a0),d0
										movea.l (sp)+,a0
										bsr.w   sub_14C56       
										move.w  #$C0FC,(a2)
										addq.l  #8,a2
										move.w  (sp)+,d7
										dbf     d7,loc_14C0E
										lea     (FF6802_LOADING_SPACE).l,a0
										lea     ($B800).l,a1
										move.w  #$3C0,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (SetFFDE94b3andWait).w
										rts

	; End of function sub_14BB0


; =============== S U B R O U T I N E =======================================

; copy shop price tag pixels to A0 in RAM

sub_14C56:
										
										movem.l a1-a2,-(sp)
										andi.l  #$FFFF,d0
										move.l  a0,-(sp)
										lea     unk_14EFC(pc), a1
										moveq   #$1F,d7
loc_14C68:
										
										move.l  (a1)+,(a0)+
										dbf     d7,loc_14C68
										movea.l (sp)+,a0
										adda.w  #$14,a0
										jsr     (WriteAsciiNumber).w
										lea     ((byte_FFDE85-$1000000)).w,a2
										moveq   #4,d7
loc_14C7E:
										
										clr.w   d0
										move.b  (a2)+,d0
										cmpi.w  #$20,d0 
										beq.s   loc_14CA2
										subi.w  #$30,d0 
										mulu.w  #$14,d0
										lea     aUuUuIUuUU(pc), a1
										adda.w  d0,a1
										move.l  (a1)+,(a0)+
										move.l  (a1)+,(a0)+
										move.l  (a1)+,(a0)+
										move.l  (a1)+,(a0)+
										move.l  (a1)+,(a0)+
										bra.s   loc_14CA6
loc_14CA2:
										
										adda.w  #$14,a0
loc_14CA6:
										
										dbf     d7,loc_14C7E
										addq.w  #8,a0
										movem.l (sp)+,a1-a2
										rts

	; End of function sub_14C56


; =============== S U B R O U T I N E =======================================

; copy item # D1 icon pixels to A0 in RAM

sub_14CB2:
										
										move.l  a1,-(sp)
										move.w  d0,-(sp)
										movea.l (p_Icons).l,a1
										move.w  d0,d1
										add.w   d0,d0
										add.w   d1,d0
										lsl.w   #6,d0
										adda.w  d0,a1
										moveq   #$2F,d7 
loc_14CC8:
										
										move.l  (a1)+,(a0)+
										dbf     d7,loc_14CC8
										ori.w   #$F,-2(a0)
										ori.w   #$F000,-$24(a0)
										ori.w   #$F,-$9E(a0)
										ori.w   #$F000,-$C0(a0)
										move.w  (sp)+,d0
										movea.l (sp)+,a1
										rts

	; End of function sub_14CB2


; =============== S U B R O U T I N E =======================================

; get current item idx in shop/caravan (from index list) -> D0

sub_14CEC:
										
										move.w  ((word_FFB130-$1000000)).w,d0
										move.w  d0,d1
										add.w   d0,d0
										add.w   d1,d0
										add.w   d0,d0
										move.w  ((word_FFB132-$1000000)).w,d1
										add.w   d1,d0
										lea     ((byte_FFB0AE-$1000000)).w,a0
										move.b  (a0,d0.w),d0
										andi.w  #$FF,d0
										rts

	; End of function sub_14CEC


; =============== S U B R O U T I N E =======================================

sub_14D0C:
										
										bsr.w   *+4
										movea.l -6(a6),a0
										movea.l a0,a1
										adda.w  #$A2,a0 
										adda.w  #$36,a1 
										move.w  #$6C,d7 
										jsr     (CopyBytes).w   
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$A2,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$D8,a1 
										jsr     (CopyBytes).w   
loc_14D4A:
										
										move.w  -2(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										move.w  -8(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										jmp     (WaitForVInt).w 

	; End of function sub_14D0C


; =============== S U B R O U T I N E =======================================

sub_14D6A:
										
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$36,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$6C,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										lea     -$F0(a6),a0
										movea.l -6(a6),a1
										adda.w  #$A2,a1 
										move.w  #$6C,d7 
										jsr     (CopyBytes).w   
										bsr.w   sub_14DBE
										lea     -$F0(a6),a0
										movea.l -6(a6),a1
										adda.w  #$36,a1 
										move.w  #$D8,d7 
										jsr     (CopyBytes).w   

	; End of function sub_14D6A


; =============== S U B R O U T I N E =======================================

sub_14DBE:
										
										bra.s   loc_14D4A

	; End of function sub_14DBE


; =============== S U B R O U T I N E =======================================

sub_14DC0:
										
										bsr.w   *+4
										movea.l -6(a6),a0
										movea.l a0,a1
										adda.w  #$36,a0 
										adda.w  #$A2,a1 
										move.w  #$6C,d7 
										jsr     (CopyBytes).w   
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$36,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$6C,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										bra.w   loc_14D4A

	; End of function sub_14DC0


; =============== S U B R O U T I N E =======================================

sub_14E06:
										
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$A2,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										lea     unk_151A0(pc), a0
										movea.l -6(a6),a1
										adda.w  #$D8,a1 
										move.w  #$36,d7 
										jsr     (CopyBytes).w   
										lea     -$F0(a6),a0
										movea.l -6(a6),a1
										adda.w  #$6C,a0 
										adda.w  #$36,a1 
										move.w  #$6C,d7 
										jsr     (CopyBytes).w   
										bsr.w   sub_14E5E
										lea     -$F0(a6),a0
										movea.l -6(a6),a1
										adda.w  #$36,a1 
										move.w  #$D8,d7 
										jsr     (CopyBytes).w   

	; End of function sub_14E06


; =============== S U B R O U T I N E =======================================

sub_14E5E:
										
										bra.w   loc_14D4A

	; End of function sub_14E5E


; =============== S U B R O U T I N E =======================================

sub_14E62:
										
										movea.l -6(a6),a0
										adda.w  #$36,a0 
										lea     -$F0(a6),a1
										move.w  #$D8,d7 
										jsr     (CopyBytes).w   
										tst.b   ((word_FFAF9E-$1000000)).w
										bne.s   loc_14E82
										bsr.w   sub_14D0C
										bra.s   loc_14E86
loc_14E82:
										
										bsr.w   sub_14DC0
loc_14E86:
										
										bsr.w   sub_14BB0       
										movea.l -6(a6),a0
										adda.w  #$36,a0 
										lea     -$F0(a6),a1
										move.w  #$D8,d7 
										jsr     (CopyBytes).w   
										tst.b   ((word_FFAF9E-$1000000)).w
										bne.s   loc_14EAA
										bsr.w   sub_14D6A
										bra.s   loc_14EAE
loc_14EAA:
										
										bsr.w   sub_14E06
loc_14EAE:
										
										move.w  -2(a6),d0
										move.w  #$201,d1
										moveq   #4,d2
										jsr     (MoveWindowWithoutSFX).l
										bra.s   sub_14EDE

	; End of function sub_14E62


; =============== S U B R O U T I N E =======================================

sub_14EC0:
										
										move.w  -8(a6),d0
										move.w  #$2000,d1
										jsr     (SetWindowDestination).l
										move.w  -2(a6),d0
										move.w  #$201,d1
										moveq   #4,d2
										jsr     (MoveWindowWithoutSFX).l

	; End of function sub_14EC0


; =============== S U B R O U T I N E =======================================

sub_14EDE:
										
										bsr.w   sub_14B68
										move.w  -8(a6),d0
										move.w  ((word_FFB132-$1000000)).w,d1
										ror.w   #6,d1
										ori.w   #$106,d1
										moveq   #4,d2
										jsr     (MoveWindowWithoutSFX).l
										moveq   #$A,d1
										rts

	; End of function sub_14EDE

unk_14EFC:          dc.b $11
										dc.b $FF
										dc.b $FF
										dc.b $FF
										dc.b $EE 
										dc.b $1F
										dc.b $FF
										dc.b $FF
										dc.b $FF
										dc.b $F1 
										dc.b $FF
										dc.b $FF
										dc.b $EB 
										dc.b $BB 
										dc.b $BB 
										dc.b $FF
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BF 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $FB 
										dc.b $BB 
										dc.b $BB 
										dc.b $EE 
										dc.b $FF
										dc.b $EE 
										dc.b $EE 
										dc.b $EF 
aUuUuIUuUU:         dc.b $BE
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $EB 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $EB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $EB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $BE 
										dc.b $EE 
										dc.b $EE 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b $BB 
										dc.b $BB 
										dc.b $BB 
										dc.b $BE 
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   0
unk_1505C:          dc.b $C0 
										dc.b $60 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C0 
										dc.b $61 
										dc.b $C8 
										dc.b $60 
										dc.b $C0 
										dc.b $70 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $24 
										dc.b $C5 
										dc.b $C6 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $D0 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $DA 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $E4 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $EE 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $F8 
										dc.b $C0 
										dc.b $20
										dc.b $C8 
										dc.b $70 
										dc.b $C0 
										dc.b $70 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $C0 
										dc.b $C5 
										dc.b $C1 
										dc.b $C5 
										dc.b $C7 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $CA 
										dc.b $C5 
										dc.b $CB 
										dc.b $C5 
										dc.b $D1 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $D4 
										dc.b $C5 
										dc.b $D5 
										dc.b $C5 
										dc.b $DB 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $DE 
										dc.b $C5 
										dc.b $DF 
										dc.b $C5 
										dc.b $E5 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $E8 
										dc.b $C5 
										dc.b $E9 
										dc.b $C5 
										dc.b $EF 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $F2 
										dc.b $C5 
										dc.b $F3 
										dc.b $C5 
										dc.b $F9 
										dc.b $C0 
										dc.b $20
										dc.b $C8 
										dc.b $70 
										dc.b $C0 
										dc.b $70 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $C2 
										dc.b $C5 
										dc.b $C3 
										dc.b $C5 
										dc.b $C8 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $CC 
										dc.b $C5 
										dc.b $CD 
										dc.b $C5 
										dc.b $D2 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $D6 
										dc.b $C5 
										dc.b $D7 
										dc.b $C5 
										dc.b $DC 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $E0 
										dc.b $C5 
										dc.b $E1 
										dc.b $C5 
										dc.b $E6 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $EA 
										dc.b $C5 
										dc.b $EB 
										dc.b $C5 
										dc.b $F0 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $F4 
										dc.b $C5 
										dc.b $F5 
										dc.b $C5 
										dc.b $FA 
										dc.b $C0 
										dc.b $20
										dc.b $C8 
										dc.b $70 
										dc.b $C0 
										dc.b $70 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $C4 
										dc.b $C5 
										dc.b $C5 
										dc.b $C5 
										dc.b $C9 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $CE 
										dc.b $C5 
										dc.b $CF 
										dc.b $C5 
										dc.b $D3 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $D8 
										dc.b $C5 
										dc.b $D9 
										dc.b $C5 
										dc.b $DD 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $E2 
										dc.b $C5 
										dc.b $E3 
										dc.b $C5 
										dc.b $E7 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $EC 
										dc.b $C5 
										dc.b $ED 
										dc.b $C5 
										dc.b $F1 
										dc.b $C0 
										dc.b $20
										dc.b $C5 
										dc.b $F6 
										dc.b $C5 
										dc.b $F7 
										dc.b $C5 
										dc.b $FB 
										dc.b $C0 
										dc.b $20
										dc.b $C8 
										dc.b $70 
										dc.b $D0 
										dc.b $60 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D0 
										dc.b $61 
										dc.b $D8 
										dc.b $60 
unk_151A0:          dc.b $C0 
										dc.b $70 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C8 
										dc.b $70 
unk_151D6:          dc.b $4F 
										dc.b $FF
										dc.b $B0 
										dc.b $FC 
										dc.b   0
										dc.b $28 
										dc.b $80 
										dc.b $22 
										dc.b   0
										dc.b $28 
										dc.b   0
										dc.b $20
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b $10
										dc.b   4
										dc.b   0
										dc.b   1
										dc.b   6
										dc.b $D0 
										dc.b $75 
										dc.b   7
										dc.b $D0 
										dc.b   3
										dc.b   0
										dc.b   0
										dc.b $20
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b $20
										dc.b   4
										dc.b   0
										dc.b   0
										dc.b   3
										dc.b $FF
										dc.b $E7 
										dc.b $F6 
										dc.b   7
										dc.b $E8 
										dc.b $40 
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   1
										dc.b   8
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b $88 
										dc.b $71 
										dc.b   0
										dc.b   1
										dc.b   0
										dc.b $40 
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b $20
										dc.b   8
										dc.b   0
										dc.b   2
										dc.b  $D
										dc.b $AA 
										dc.b $20
										dc.b $FA 
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b $40 
										dc.b $C0 
										dc.b   0
										dc.b $C0 
										dc.b   0
										dc.b $C7 
										dc.b $C0 
										dc.b $C7 
										dc.b $C1 
										dc.b $C0 
										dc.b   0
										dc.b $C0 
										dc.b   0
										dc.b $C7 
										dc.b $C6 
										dc.b $C7 
										dc.b $C7 
										dc.b $C7 
										dc.b $C2 
										dc.b $C7 
										dc.b $C3 
										dc.b $C7 
										dc.b $CE 
										dc.b $C7 
										dc.b $CF 
										dc.b $C7 
										dc.b $C8 
										dc.b $C7 
										dc.b $C9 
										dc.b $C7 
										dc.b $C4 
										dc.b $C7 
										dc.b $C5 
										dc.b $C7 
										dc.b $D0 
										dc.b $C7 
										dc.b $D1 
										dc.b $C7 
										dc.b $CA 
										dc.b $C7 
										dc.b $CB 
										dc.b $C7 
										dc.b $D6 
										dc.b $C7 
										dc.b $D7 
										dc.b $C7 
										dc.b $D2 
										dc.b $C7 
										dc.b $D3 
										dc.b $C7 
										dc.b $CC 
										dc.b $C7 
										dc.b $CD 
										dc.b $C7 
										dc.b $D8 
										dc.b $C7 
										dc.b $D9 
										dc.b $C7 
										dc.b $D4 
										dc.b $C7 
										dc.b $D5 
										dc.b $C0 
										dc.b   0
										dc.b $C0 
										dc.b   0
										dc.b $C7 
										dc.b $DA 
										dc.b $C7 
										dc.b $DB 
										dc.b $C0 
										dc.b   0
										dc.b $C0 
										dc.b   0

; =============== S U B R O U T I N E =======================================

sub_15268:
										
										lea     (byte_FFCC86).l,a0
										move.l  #$C020C020,-$50(a0)
										moveq   #$C,d7
loc_15278:
										
										move.l  #$C020C020,(a0)+
										dbf     d7,loc_15278
										rts

	; End of function sub_15268


; =============== S U B R O U T I N E =======================================

YesNoPrompt:
										
										clr.w   d0
										move.b  ((RAM_Input_Player1_StateA-$1000000)).w,d0
										bra.s   loc_1528E

	; End of function YesNoPrompt


; =============== S U B R O U T I N E =======================================

YesNoChoiceBox:
										
										clr.w   d0

	; End of function YesNoChoiceBox


; START OF FUNCTION CHUNK FOR YesNoPrompt

loc_1528E:
										
										movem.l d1-a1,-(sp)
										link    a6,#-6
										move.w  d0,-(sp)
										move.w  #$E03,d0
										move.w  #$2011,d1
										jsr     (CreateWindow).w
										move.w  d0,-2(a6)
										move.l  a1,-6(a6)
										movea.l (p_MenuTiles_YesNo).l,a0
										lea     (DMA_SPACE_FF8804).l,a1
										jsr     (LoadTileData).w
										clr.b   ((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bsr.w   CopyYesNoIconsToRAM
										clr.w   d6
										bsr.w   sub_1542A
										bsr.w   sub_1544A
										move.w  -2(a6),d0
										move.w  #$C11,d1
										move.w  #4,d2
										jsr     (MoveWindowWithSFX).w
										move.w  ((TEXT_WINDOW_INDEX-$1000000)).w,d0
										beq.s   loc_152F0
										subq.w  #1,d0
										move.w  #$8080,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
loc_152F0:
										
										move.w  ((word_FFB086-$1000000)).w,d0
										beq.s   loc_15302
										subq.w  #1,d0
										move.w  #$8080,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
loc_15302:
										
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  (sp)+,d0
										beq.w   loc_15312
loc_1530C:
										
										tst.b   ((RAM_Input_Player1_StateA-$1000000)).w
										bne.s   loc_1530C
loc_15312:
										
										moveq   #$F,d6
loc_15314:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.w   loc_15328
										clr.w   d1
										trap    #TRAP_SOUNDCOM

; END OF FUNCTION CHUNK FOR YesNoPrompt

										dc.w SFX_MENU_SELECTION
										bra.w   loc_15378

; START OF FUNCTION CHUNK FOR YesNoPrompt

loc_15328:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.w   loc_1533C
										moveq   #$FFFFFFFF,d1
										trap    #TRAP_SOUNDCOM

; END OF FUNCTION CHUNK FOR YesNoPrompt

										dc.w SFX_MENU_SELECTION
										bra.w   loc_15378

; START OF FUNCTION CHUNK FOR YesNoPrompt

loc_1533C:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.w   loc_15350
										moveq   #$FFFFFFFF,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bra.w   loc_153D6
loc_15350:
										
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.w   loc_15364
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_153D6
loc_15364:
										
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.w   loc_153C0
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bra.w   loc_153D6

; END OF FUNCTION CHUNK FOR YesNoPrompt

loc_15378:          move.w  d1,-(sp)
										clr.w   d0
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										clr.w   d6
										bsr.w   sub_15422       
										move.w  (sp)+,d0
										move.b  d0,((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bsr.w   CopyYesNoIconsToRAM
										move.w  -2(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										move.w  ((TEXT_WINDOW_INDEX-$1000000)).w,d0
										beq.s   loc_153AC
										subq.w  #1,d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
loc_153AC:          move.w  ((word_FFB086-$1000000)).w,d0
										beq.s   loc_153BE
										subq.w  #1,d0
										move.w  #$8080,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
loc_153BE:          moveq   #$13,d6

; START OF FUNCTION CHUNK FOR YesNoPrompt

loc_153C0:
										
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										bsr.w   sub_15422       
										subq.w  #1,d6
										bne.s   loc_153CE
										moveq   #$14,d6
loc_153CE:
										
										jsr     (WaitForVInt).w 
										bra.w   loc_15314
loc_153D6:
										
										move.w  -2(a6),d0
										move.w  #$F011,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										move.w  ((TEXT_WINDOW_INDEX-$1000000)).w,d0
										beq.s   loc_153F6
										subq.w  #1,d0
										move.w  #$8080,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
loc_153F6:
										
										move.w  ((word_FFB086-$1000000)).w,d0
										beq.s   loc_15408
										subq.w  #1,d0
										move.w  #$8080,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
loc_15408:
										
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  -2(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										unlk    a6
										movem.l (sp)+,d1-a1
										move.b  ((CURRENT_DIAMENU_CHOICE-$1000000)).w,d0
										ext.w   d0
										rts

; END OF FUNCTION CHUNK FOR YesNoPrompt


; =============== S U B R O U T I N E =======================================

; d0 = FFAFE7, related to DMA

sub_15422:
										
										andi.w  #1,d0
										bne.w   sub_1544A

	; End of function sub_15422


; =============== S U B R O U T I N E =======================================

sub_1542A:
										
										lea     (DMA_SPACE_FF8804).l,a0
										cmpi.w  #$A,d6
										blt.s   loc_1543A
										adda.w  #$120,a0
loc_1543A:
										
										lea     ($B800).l,a1
										move.w  #$90,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function sub_1542A


; =============== S U B R O U T I N E =======================================

sub_1544A:
										
										lea     (byte_FF8A44).l,a0
										cmpi.w  #$A,d6
										blt.s   loc_1545A
										adda.w  #$120,a0
loc_1545A:
										
										lea     ($B920).l,a1
										move.w  #$90,d0 
										moveq   #2,d1
										jmp     (BwahDMAstuffAgainbis).w

	; End of function sub_1544A


; =============== S U B R O U T I N E =======================================

CopyYesNoIconsToRAM:
										
										movea.l -6(a6),a1
										lea     asc_154A2(pc), a0
										move.w  #$54,d7 
										jsr     (CopyBytes).w   
										tst.b   ((CURRENT_DIAMENU_CHOICE-$1000000)).w
										bne.s   loc_15486
										lea     s_Yes(pc), a0   
										bra.s   loc_1548A
loc_15486:
										
										lea     s_No(pc), a0    
loc_1548A:
										
										movea.l -6(a6),a1
										adda.w  #$30,a1 
										moveq   #$FFFFFFE4,d1
										moveq   #3,d7
										bsr.w   WriteTilesFromASCII
										rts

	; End of function CopyYesNoIconsToRAM

s_Yes:              dc.b 'Yes'
s_No:               dc.b 'No'
										dc.b $20
asc_154A2:          dc.b '',0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b '',0
										dc.b   0
aAAA:               dc.b '`aaa`',0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b '',0
										dc.b   0
aPP:                dc.b 'p   p',0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b '',0
										dc.b   0
aAAA_0:             dc.b '`aaa`'

; =============== S U B R O U T I N E =======================================

sub_154F6:
										
										clr.b   ((byte_FFB082-$1000000)).w
										jsr     (WaitForVInt).w 
										move.w  d0,-(sp)
										btst    #0,d0
										bne.s   loc_1550A
										clr.w   d1
										bra.s   loc_1550C
loc_1550A:
										
										moveq   #1,d1
loc_1550C:
										
										lea     ((BLINK_DATA-$1000000)).w,a2
										move.w  ((BLINK_TILE_NUMBER-$1000000)).w,d7
										bsr.w   UpdatePortrait  
										move.w  (sp)+,d0
										btst    #1,d0
										bne.s   loc_15524
										clr.w   d1
										bra.s   loc_15526
loc_15524:
										
										moveq   #1,d1
loc_15526:
										
										lea     ((MOUTH_DATA-$1000000)).w,a2
										move.w  ((MOUTH_TILE_NUMBER-$1000000)).w,d7
										bsr.w   UpdatePortrait  
										rts

	; End of function sub_154F6


; =============== S U B R O U T I N E =======================================

; must be related to portrait display

VInt_HandlePortraitBlinking:
										
										tst.w   ((PORTRAIT_WINDOW_INDEX-$1000000)).w
										beq.w   return_155C2
										tst.b   ((byte_FFB082-$1000000)).w
										beq.w   return_155C2
										lea     ((BLINK_COUNTER-$1000000)).w,a0
										subq.w  #1,(a0)
										cmpi.w  #3,(a0)
										bne.s   loc_1555E
										moveq   #1,d1
										lea     ((BLINK_DATA-$1000000)).w,a2
										move.w  ((BLINK_TILE_NUMBER-$1000000)).w,d7
										bsr.w   UpdatePortrait  
loc_1555E:
										
										tst.w   (a0)
										bne.s   loc_1557C
										clr.w   d1
										lea     ((BLINK_DATA-$1000000)).w,a2
										move.w  ((BLINK_TILE_NUMBER-$1000000)).w,d7
										bsr.w   UpdatePortrait  
										moveq   #$78,d6 
										jsr     (UpdateRandomSeed).w
										addi.w  #$1E,d7
										move.w  d7,(a0)
loc_1557C:
										
										lea     ((word_FFB07C-$1000000)).w,a0
										tst.b   ((CURRENTLY_TYPEWRITING-$1000000)).w
										bne.s   loc_1558E
										cmpi.w  #5,(a0)
										ble.s   loc_155A8
										bra.s   return_155C2
loc_1558E:
										
										subq.w  #1,(a0)
										cmpi.w  #5,(a0)
										bne.s   loc_155A4
										moveq   #1,d1
										lea     ((MOUTH_DATA-$1000000)).w,a2
										move.w  ((MOUTH_TILE_NUMBER-$1000000)).w,d7
										bsr.w   UpdatePortrait  
loc_155A4:
										
										tst.w   (a0)
										bne.s   return_155C2
loc_155A8:
										
										clr.w   d1
										lea     ((MOUTH_DATA-$1000000)).w,a2
										move.w  ((MOUTH_TILE_NUMBER-$1000000)).w,d7
										bsr.w   UpdatePortrait  
										moveq   #5,d6
										jsr     (UpdateRandomSeed).w
										addi.w  #$A,d7
										move.w  d7,(a0)
return_155C2:
										
										rts

	; End of function VInt_HandlePortraitBlinking


; =============== S U B R O U T I N E =======================================

; d1 = alternate/original, d7 = tile number

UpdatePortrait:
										
										bne.s   loc_155C8
										rts
loc_155C8:
										
										move.w  d1,-(sp)
										move.w  ((PORTRAIT_WINDOW_INDEX-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$101,d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.w  (sp)+,d1
										subq.w  #1,d7
loc_155DC:
										
										move.w  d7,-(sp)
										clr.w   d0
										clr.w   d5
										clr.w   d6
										move.b  (a2)+,d5
										move.b  (a2)+,d6
										lsl.w   #3,d6
										add.w   d5,d6
										move.b  (a2)+,d5
										move.b  (a2)+,d0
										lsl.w   #3,d0
										add.w   d5,d0
										tst.w   d1
										bne.s   loc_155FA
										move.w  d6,d0
loc_155FA:
										
										or.w    ((word_FFB07E-$1000000)).w,d0
										tst.b   ((PORTRAIT_IS_FLIPPED-$1000000)).w
										beq.s   loc_1560E
										eori.w  #7,d6
										subq.l  #2,d6
										ori.w   #$800,d0
loc_1560E:
										
										add.w   d6,d6
										move.w  d0,(a1,d6.w)
										move.w  (sp)+,d7
										dbf     d7,loc_155DC
										move.w  ((PORTRAIT_WINDOW_INDEX-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										rts

	; End of function UpdatePortrait


; =============== S U B R O U T I N E =======================================

;     In: D0 = portrait idx

LoadPortrait:
										
										movem.l d0-a3,-(sp)
										movea.l (p_pt_Portraits).l,a0
										lsl.w   #2,d0
										movea.l (a0,d0.w),a0
										move.w  (a0)+,d0
										move.w  d0,((BLINK_TILE_NUMBER-$1000000)).w
										beq.s   loc_1564E
										subq.w  #1,d0
										lea     ((BLINK_DATA-$1000000)).w,a1
loc_15648:
										
										move.l  (a0)+,(a1)+
										dbf     d0,loc_15648
loc_1564E:
										
										move.w  (a0)+,d0
										move.w  d0,((MOUTH_TILE_NUMBER-$1000000)).w
										beq.s   loc_15662
										subq.w  #1,d0
										lea     ((MOUTH_DATA-$1000000)).w,a1
loc_1565C:
										
										move.l  (a0)+,(a1)+
										dbf     d0,loc_1565C
loc_15662:
										
										lea     (Palette2).l,a1
										lea     (Palette2bis).l,a2
										lea     ((byte_FFDF4A-$1000000)).w,a3
										moveq   #7,d7
loc_15674:
										
										move.l  (a0),(a1)+
										move.l  (a0),(a2)+
										move.l  (a0)+,(a3)+
										dbf     d7,loc_15674
										lea     (DMA_SPACE_FF8804).l,a1
										jsr     (LoadTileData).w
										addq.b  #6,((byte_FFDEED-$1000000)).w
										movea.l a1,a0
										lea     ($F800).l,a1
										move.w  #$400,d0
										moveq   #2,d1
										jsr     (BwahDMAstuffAgainbis).w
										jsr     (StoreVdpCommandster).w
										movem.l (sp)+,d0-a3
										rts

	; End of function LoadPortrait


; =============== S U B R O U T I N E =======================================

sub_156A8:
										
										movem.w d0,-(sp)
										bsr.s   sub_156CE
										move.l  #$F80B010B,d1
										jsr     (MoveWindowWithSFX).w
										move.w  (sp)+,d0
										rts

	; End of function sub_156A8


; =============== S U B R O U T I N E =======================================

sub_156BC:
										
										move.w  d0,-(sp)
										bsr.s   sub_156CE
										move.l  #$10BF80B,d1
										jsr     (MoveWindowWithSFX).w
										move.w  (sp)+,d0
										rts

	; End of function sub_156BC


; =============== S U B R O U T I N E =======================================

sub_156CE:
										
										movem.l d7-a1,-(sp)
										lea     MenuLayout_15706(pc), a0
										lea     ((VDP_TILE_IDX_LIST-$1000000)).w,a1
										move.w  #$30,d7 
										jsr     (CopyBytes).w   
										movem.l (sp)+,d7-a1
										jsr     j_GetCharName
										move.w  d1,d7
										lea     ((byte_FFB812-$1000000)).w,a1
										moveq   #$FFFFFFF0,d1
										bsr.w   WriteTilesFromASCII
										lea     ((VDP_TILE_IDX_LIST-$1000000)).w,a0
										move.w  #$803,d0
										move.w  #4,d2
										rts

	; End of function sub_156CE

MenuLayout_15706:   dc.b $C0 
										dc.b $80 
										dc.b $C0 
										dc.b $81 
										dc.b $C0 
										dc.b $81 
										dc.b $C0 
										dc.b $81 
										dc.b $C0 
										dc.b $81 
										dc.b $C0 
										dc.b $81 
										dc.b $C0 
										dc.b $81 
										dc.b $C8 
										dc.b $80 
										dc.b $C0 
										dc.b $90 
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C0 
										dc.b $20
										dc.b $C8 
										dc.b $90 
										dc.b $D0 
										dc.b $80 
										dc.b $D0 
										dc.b $81 
										dc.b $D0 
										dc.b $81 
										dc.b $D0 
										dc.b $81 
										dc.b $D0 
										dc.b $81 
										dc.b $D0 
										dc.b $81 
										dc.b $D0 
										dc.b $81 
										dc.b $D8 
										dc.b $80 

; =============== S U B R O U T I N E =======================================

;     Get index of portrait based on char index for force members.
;     In: D0 = char idx
;     Out: D0 = adjusted portrait idx

GetCharPortraitIdx:
										
										move.w  d1,-(sp)
										cmpi.b  #$1E,d0
										bhi.w   loc_1576E
										jsr     j_GetClass      
										cmpi.b  #$C,d1          ; stupid CMP mechanism for alternate portraits, need to improve that one day
										bne.s   loc_1574E       ; hardcoded promotion classes which trigger new portraits
										moveq   #$2F,d0 
loc_1574E:
										
										cmpi.b  #$1A,d1
										bne.s   loc_15756
										moveq   #$30,d0 
loc_15756:
										
										cmpi.b  #$18,d1
										bne.s   loc_1575E
										moveq   #$31,d0 
loc_1575E:
										
										cmpi.b  #$1B,d1
										bne.s   loc_15766
										moveq   #$32,d0 
loc_15766:
										
										cmpi.b  #$1C,d1
										bne.s   loc_1576E
										moveq   #$33,d0 
loc_1576E:
										
										move.w  (sp)+,d1
										rts

	; End of function GetCharPortraitIdx


; =============== S U B R O U T I N E =======================================

CreateLandEffectWindow:
										
										movem.l d0-a2,-(sp)
										move.w  #$805,d0
										move.w  #$F801,d1
										jsr     (CreateWindow).w
										addq.w  #1,d0
										move.w  d0,((LAND_EFFECT_WINDOW_IDX-$1000000)).w
										bsr.w   DrawLandEffectWindow
										move.w  ((LAND_EFFECT_WINDOW_IDX-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$201,d1
										move.w  #4,d2
										cmpi.w  #$16,((FIGHTER_MINISTATUS_WINDOW_WIDTH-$1000000)).w
										blt.s   loc_157A6
										move.w  #$101,d1
loc_157A6:
										
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										movem.l (sp)+,d0-a2
										rts

	; End of function CreateLandEffectWindow


; =============== S U B R O U T I N E =======================================

HideLandEffectWindow:
										
										tst.w   ((LAND_EFFECT_WINDOW_IDX-$1000000)).w
										beq.w   return_157E6
										movem.l d0-a2,-(sp)
										move.w  ((LAND_EFFECT_WINDOW_IDX-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$F801,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  ((LAND_EFFECT_WINDOW_IDX-$1000000)).w,d0
										subq.w  #1,d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										clr.w   ((LAND_EFFECT_WINDOW_IDX-$1000000)).w
										movem.l (sp)+,d0-a2
return_157E6:
										
										rts

	; End of function HideLandEffectWindow


; =============== S U B R O U T I N E =======================================

sub_157E8:
										
										tst.w   ((LAND_EFFECT_WINDOW_IDX-$1000000)).w
										beq.w   return_15810
										movem.l d0-a2,-(sp)
										bsr.w   DrawLandEffectWindow
										tst.b   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										bne.s   loc_1580C
										move.w  ((LAND_EFFECT_WINDOW_IDX-$1000000)).w,d0
										subq.w  #1,d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
loc_1580C:
										
										movem.l (sp)+,d0-a2
return_15810:
										
										rts

	; End of function sub_157E8


; =============== S U B R O U T I N E =======================================

DrawLandEffectWindow:
										
										move.w  ((LAND_EFFECT_WINDOW_IDX-$1000000)).w,d0
										subq.w  #1,d0
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).w
										move.l  a1,d3
										move.w  #$805,d0
										bsr.w   CopyWindowTilesToRAM
										move.w  ((MOVING_BATTLE_ENTITY_IDX-$1000000)).w,d0
										jsr     j_GetMoveCost
										move.w  d1,d0
										mulu.w  #$F,d0
										moveq   #$FFFFFFF0,d1
										moveq   #2,d7
										movea.l d3,a1
										adda.w  #$38,a1 
										bsr.w   WriteTilesFromNumber
										move.b  #$25,1(a1) 
										moveq   #$FFFFFFF0,d1
										moveq   #$F,d7
										movea.l d3,a1
										adda.w  #$12,a1
										lea     aLandEffect(pc), a0
										nop
										bsr.w   WriteTilesFromASCII
										rts

	; End of function DrawLandEffectWindow

aLandEffect:        dc.b 'LAND',$B,'EFFECT',0

; =============== S U B R O U T I N E =======================================

sub_1586E:
										
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										movem.l d0-a1,-(sp)
										link    a6,#-$10
										move.b  ((MESSAGE_SPEED-$1000000)).w,-$A(a6)
										move.b  ((DISPLAY_BATTLE_MESSAGES-$1000000)).w,-8(a6)
										move.w  #$1309,d0
										move.w  #$71C,d1
										jsr     (CreateWindow).l
										move.w  d0,-6(a6)
										move.l  a1,-4(a6)
										bsr.w   CopyBattlefieldOptionsMenuLayout
										move.w  -6(a6),d0
										move.w  #$712,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										lea     unk_1623A(pc), a0
										lea     ($B800).l,a1
										move.w  #$C0,d0 
										moveq   #2,d1
										jsr     (DmaTilesViaFF8804bis).w
										jsr     (Set_FFDE94_bit3).w
										jsr     (WaitForVint_andFFA900Clear).l
										clr.w   d4
										bsr.w   sub_15A20
										moveq   #$14,d6
loc_158D6:
										
										bsr.w   sub_159A0
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_158E8
										addq.w  #1,d3
										bsr.w   sub_15A3E
loc_158E8:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_158F6
										subq.w  #1,d3
										bsr.w   sub_15A3E
loc_158F6:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_15906
										eori.w  #1,d4
										bsr.w   sub_15A20
loc_15906:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_15916
										eori.w  #1,d4
										bsr.w   sub_15A20
loc_15916:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15940
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_1594C
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_1594C
										jsr     (WaitForVInt).w 
										subq.w  #1,d6
										bne.s   loc_1593E
										moveq   #$14,d6
loc_1593E:
										
										bra.s   loc_158D6
loc_15940:
										
										move.b  -$A(a6),((MESSAGE_SPEED-$1000000)).w
										move.b  -8(a6),((DISPLAY_BATTLE_MESSAGES-$1000000)).w
loc_1594C:
										
										move.w  -6(a6),d0
										move.w  #$71E,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										bsr.w   sub_1598C
										jsr     (WaitForVint_andFFA900Clear).l
										move.w  -6(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										unlk    a6
										movem.l (sp)+,d0-a1
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
										rts

	; End of function sub_1586E


; =============== S U B R O U T I N E =======================================

CopyBattlefieldOptionsMenuLayout:
										
										lea     BattleConfigWindowLayout(pc), a0
										movea.l -4(a6),a1
										move.w  #$156,d7
										jmp     (CopyBytes).w   

	; End of function CopyBattlefieldOptionsMenuLayout


; =============== S U B R O U T I N E =======================================

sub_1598C:
										
										lea     (byte_FFDCC0).l,a0
										moveq   #3,d7
loc_15994:
										
										move.w  #1,(a0)
										addq.l  #8,a0
										dbf     d7,loc_15994
										rts

	; End of function sub_1598C


; =============== S U B R O U T I N E =======================================

sub_159A0:
										
										tst.w   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										bne.s   sub_1598C
										movem.w d3-d4/d7,-(sp)
										lea     (byte_FFDCC0).l,a0
										lea     unk_15A00(pc), a1
										clr.w   d3
										move.b  ((MESSAGE_SPEED-$1000000)).w,d3
										lsl.w   #4,d3
										tst.w   d4
										bne.s   loc_159CA
										cmpi.w  #7,d6
										bge.s   loc_159CA
										move.w  #$FF00,d3
loc_159CA:
										
										move.w  (a1)+,(a0)+
										move.l  (a1)+,(a0)+
										move.w  (a1)+,(a0)
										add.w   d3,(a0)+
										clr.w   d3
										move.b  ((DISPLAY_BATTLE_MESSAGES-$1000000)).w,d3
										lsl.w   #6,d3
										tst.w   d4
										beq.s   loc_159E8
										cmpi.w  #7,d6
										bge.s   loc_159E8
										move.w  #$FF00,d3
loc_159E8:
										
										moveq   #2,d7
loc_159EA:
										
										move.w  (a1)+,(a0)+
										move.l  (a1)+,(a0)+
										move.w  (a1)+,(a0)
										add.w   d3,(a0)+
										dbf     d7,loc_159EA
										bsr.w   sub_101E6
										movem.w (sp)+,d3-d4/d7
										rts

	; End of function sub_159A0

unk_15A00:          dc.b   1
										dc.b $24 
										dc.b   5
										dc.b   9
										dc.b $C5 
										dc.b $C8 
										dc.b   0
										dc.b $E4 
										dc.b   1
										dc.b $44 
										dc.b   9
										dc.b  $A
										dc.b $C5 
										dc.b $C0 
										dc.b   0
										dc.b $C4 
										dc.b   1
										dc.b $44 
										dc.b   5
										dc.b  $B
										dc.b $C5 
										dc.b $C2 
										dc.b   0
										dc.b $DC 
										dc.b   1
										dc.b $44 
										dc.b   9
										dc.b $10
										dc.b $C5 
										dc.b $C2 
										dc.b   0
										dc.b $EC 

; =============== S U B R O U T I N E =======================================

sub_15A20:
										
										clr.w   d3
										tst.w   d4
										bne.s   loc_15A30
										move.b  ((MESSAGE_SPEED-$1000000)).w,d3
										andi.w  #3,d3
										bra.s   loc_15A38
loc_15A30:
										
										move.b  ((DISPLAY_BATTLE_MESSAGES-$1000000)).w,d3
										andi.w  #1,d3
loc_15A38:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										rts

	; End of function sub_15A20


; =============== S U B R O U T I N E =======================================

sub_15A3E:
										
										tst.w   d4
										bne.s   loc_15A4C
										andi.w  #3,d3
										move.b  d3,((MESSAGE_SPEED-$1000000)).w
										bra.s   loc_15A54
loc_15A4C:
										
										andi.w  #1,d3
										move.b  d3,((DISPLAY_BATTLE_MESSAGES-$1000000)).w
loc_15A54:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										rts

	; End of function sub_15A3E

BattleConfigWindowLayout:
										incbin "graphics/technical/windowlayouts/battleconfigwindowlayout.bin"

; =============== S U B R O U T I N E =======================================

sub_15BB0:
										
										movem.l d0-a2,-(sp)
										link    a6,#-$20
										move.w  d0,-$14(a6)
										lea     unk_1623A(pc), a0
										lea     ($B800).l,a1
										move.w  #$C0,d0 
										moveq   #2,d1
										jsr     (DmaTilesViaFF8804bis).w
										jsr     (SetFFDE94b3andWait).w
										move.w  #$1C07,d0
										move.w  #$21C,d1
										jsr     (CreateWindow).w
										move.w  d0,-$12(a6)
										move.l  a1,-$C(a6)
										move.w  #$903,d0
										move.w  #$2008,d1
										jsr     (CreateWindow).w
										move.w  d0,-$10(a6)
										move.l  a1,-8(a6)
										move.w  #$80A,d0
										move.w  #$F8F6,d1
										jsr     (CreateWindow).w
										move.w  d0,-$E(a6)
										addq.w  #1,d0
										move.w  d0,((PORTRAIT_WINDOW_INDEX-$1000000)).w
										move.l  a1,-4(a6)
										move.w  -$14(a6),d0
										bsr.w   GetPortraitIdx  
										move.w  d0,-$16(a6)
										bsr.w   sub_1604A
										move.w  -$16(a6),d0
										bsr.w   LoadPortrait    
										move.w  -$10(a6),d0
										move.w  #$A08,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										move.w  -$12(a6),d0
										move.w  #$20B,d1
										jsr     (MoveWindowWithSFX).w
										move.w  -$E(a6),d0
										move.w  #$201,d1
										jsr     (MoveWindowWithSFX).w
										jsr     (WaitForVint_andFFA900Clear).w
										jsr     sub_15CC4(pc)
										nop
										move.w  -$14(a6),d0
										lea     (byte_FF8805).l,a0
										tst.b   (a0)
										beq.s   loc_15C72
										jsr     j_CopyCharNameToRAM
loc_15C72:
										
										bsr.w   sub_15FD8
										move.w  -$12(a6),d0
										move.w  #$21C,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).w
										move.w  -$10(a6),d0
										move.w  #$2008,d1
										jsr     (MoveWindowWithSFX).w
										move.w  -$E(a6),d0
										move.w  #$F8F6,d1
										jsr     (MoveWindowWithSFX).w
										clr.w   ((PORTRAIT_WINDOW_INDEX-$1000000)).w
										jsr     (WaitForVint_andFFA900Clear).w
										move.w  -$12(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										move.w  -$10(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										move.w  -$E(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).w
										unlk    a6
										movem.l (sp)+,d0-a2
										rts

	; End of function sub_15BB0


; =============== S U B R O U T I N E =======================================

sub_15CC4:
										
										lea     (DMA_SPACE_FF8804).l,a0
										clr.l   (a0)+
										clr.l   (a0)+
										clr.l   (a0)
										clr.w   ((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										clr.w   -$18(a6)
										clr.w   d0
										moveq   #$14,d1
loc_15CDC:
										
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15DE0
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15E3A
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15EBA
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15E94
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15DDA
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15D2C
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_15D2C
loc_15D22:
										
										bsr.w   sub_15F24
										jsr     (WaitForVInt).w 
										bra.s   loc_15CDC
loc_15D2C:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										clr.w   d0
										move.b  ((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w,d0
										cmpi.w  #$13,d0
										blt.s   loc_15D46
										cmpi.b  #4,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										beq.w   loc_15D9A
loc_15D46:
										
										add.w   d0,d0
										clr.w   d2
										move.b  ((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w,d2
										mulu.w  #$38,d2 
										add.w   d2,d0
										lea     (AlphabetWindowLayout+1)(pc), a0
										move.w  (a0,d0.w),d0
										tst.b   d0
										bpl.s   loc_15D64
										subi.b  #$20,d0 
loc_15D64:
										
										bsr.w   loc_15DC2
										move.b  d0,-1(a0)
										clr.b   (a0)
										addq.w  #1,-$18(a6)
loc_15D72:
										
										bsr.w   sub_16026
										move.w  -$10(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).w
										jsr     (WaitForVInt).w 
										moveq   #$14,d1
										cmpi.w  #7,-$18(a6)
										bne.s   loc_15D96
										move.w  #$1704,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
loc_15D96:
										
										bra.w   loc_15CDC
loc_15D9A:
										
										cmpi.b  #$17,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										beq.w   loc_15F22
										cmpi.b  #$13,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										bne.s   loc_15D46
loc_15DAC:
										
										bsr.w   loc_15DC2
										tst.w   -$18(a6)
										beq.w   loc_15CDC
										clr.b   -2(a0)
										bsr.w   loc_15DC2
										bra.s   loc_15D72
loc_15DC2:
										
										lea     (byte_FF8805).l,a0
										clr.w   -$18(a6)
loc_15DCC:
										
										move.b  (a0)+,d2
										tst.b   d2
										beq.s   return_15DD8
										addq.w  #1,-$18(a6)
										bra.s   loc_15DCC
return_15DD8:
										
										rts
loc_15DDA:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										bra.s   loc_15DAC
loc_15DE0:
										
										cmpi.w  #7,-$18(a6)
										bne.w   loc_15DFE
										cmpi.b  #4,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										bne.w   loc_15D22
										cmpi.b  #$13,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										bne.w   loc_15D22
loc_15DFE:
										
										move.b  ((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w,d0
										addq.b  #1,d0
										cmpi.b  #4,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										bge.s   loc_15E16
										cmpi.b  #$1A,d0
										bne.s   loc_15E14
										moveq   #0,d0
loc_15E14:
										
										bra.s   loc_15E2E
loc_15E16:
										
										cmpi.b  #$12,d0
										bne.s   loc_15E1E
										moveq   #$13,d0
loc_15E1E:
										
										cmpi.b  #$14,d0
										bne.s   loc_15E26
										moveq   #$17,d0
loc_15E26:
										
										cmpi.b  #$18,d0
										bne.s   loc_15E2E
										moveq   #0,d0
loc_15E2E:
										
										move.b  d0,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_15D22
loc_15E3A:
										
										cmpi.w  #7,-$18(a6)
										bne.w   loc_15E58
										cmpi.b  #4,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										bne.w   loc_15D22
										cmpi.b  #$17,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										bne.w   loc_15D22
loc_15E58:
										
										move.b  ((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w,d0
										subq.b  #1,d0
										cmpi.b  #4,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										bge.s   loc_15E70
										cmpi.b  #$FF,d0
										bne.s   loc_15E6E
										moveq   #$19,d0
loc_15E6E:
										
										bra.s   loc_15E88
loc_15E70:
										
										cmpi.b  #$16,d0
										bne.s   loc_15E78
										moveq   #$13,d0
loc_15E78:
										
										cmpi.b  #$12,d0
										bne.s   loc_15E80
										moveq   #$11,d0
loc_15E80:
										
										cmpi.b  #$FF,d0
										bne.s   loc_15E88
										moveq   #$17,d0
loc_15E88:
										
										move.b  d0,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_15D22
loc_15E94:
										
										cmpi.w  #7,-$18(a6)
										beq.w   loc_15D22
										move.b  ((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w,d0
										subq.b  #2,d0
										cmpi.b  #$FE,d0
										bne.s   loc_15EAC
										moveq   #4,d0
loc_15EAC:
										
										move.b  d0,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										bsr.s   sub_15EE0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bra.w   loc_15D22
loc_15EBA:
										
										cmpi.w  #7,-$18(a6)
										beq.w   loc_15D22
										move.b  ((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w,d0
										addq.b  #2,d0
										cmpi.b  #6,d0
										bne.s   loc_15ED2
										moveq   #0,d0
loc_15ED2:
										
										move.b  d0,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										bsr.s   sub_15EE0
										bra.w   loc_15D22

	; End of function sub_15CC4


; =============== S U B R O U T I N E =======================================

sub_15EE0:
										
										cmpi.b  #4,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										bne.s   return_15F20
										move.b  ((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w,d0
										cmpi.b  #$12,d0
										bne.s   loc_15EF4
										moveq   #$13,d0
loc_15EF4:
										
										cmpi.b  #$14,d0
										bne.s   loc_15EFC
										moveq   #$13,d0
loc_15EFC:
										
										cmpi.b  #$15,d0
										bne.s   loc_15F04
										moveq   #$13,d0
loc_15F04:
										
										cmpi.b  #$16,d0
										bne.s   loc_15F0C
										moveq   #$17,d0
loc_15F0C:
										
										cmpi.b  #$18,d0
										bne.s   loc_15F14
										moveq   #$17,d0
loc_15F14:
										
										cmpi.b  #$19,d0
										bne.s   loc_15F1C
										moveq   #$17,d0
loc_15F1C:
										
										move.b  d0,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
return_15F20:
										
										rts

	; End of function sub_15EE0


; START OF FUNCTION CHUNK FOR sub_15CC4

loc_15F22:
										
										clr.w   d1

; END OF FUNCTION CHUNK FOR sub_15CC4


; =============== S U B R O U T I N E =======================================

sub_15F24:
										
										tst.b   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										beq.s   loc_15F2C
										moveq   #1,d1
loc_15F2C:
										
										lea     (byte_FFDCC0).l,a0
										cmpi.w  #7,d1
										bge.s   loc_15F50
										move.w  #1,(a0)
										move.w  #1,6(a0)
										move.w  #1,8(a0)
										move.w  #1,$E(a0)
										bra.s   loc_15F90
loc_15F50:
										
										clr.w   d0
										move.b  ((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w,d0
										lsl.w   #3,d0
										addi.w  #$94,d0 
										move.w  d0,6(a0)
										clr.w   d0
										move.b  ((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w,d0
										lsl.w   #3,d0
										addi.w  #$DC,d0 
										move.w  d0,(a0)
										move.w  -$18(a6),d0
										cmpi.w  #7,d0
										bge.s   loc_15F84
										lsl.w   #3,d0
										addi.w  #$D8,d0 
										move.w  d0,$E(a0)
										bra.s   loc_15F8A
loc_15F84:
										
										move.w  #1,$E(a0)
loc_15F8A:
										
										move.w  #$C9,8(a0) 
loc_15F90:
										
										move.b  #5,2(a0)
										move.w  #$C5C8,4(a0)
										cmpi.b  #$13,((RAM_Battle_CurrentMovingEntityChosenX-$1000000)).w
										blt.s   loc_15FB8
										cmpi.b  #4,((RAM_Battle_CurrentMovingEntityChosenY-$1000000)).w
										bne.s   loc_15FB8
										move.b  #$D,2(a0)
										move.w  #$C5C0,4(a0)
loc_15FB8:
										
										clr.b   $A(a0)
										move.w  #$C5C3,$C(a0)
										subq.w  #1,d1
										bne.s   loc_15FC8
										moveq   #$14,d1
loc_15FC8:
										
										move.b  #9,3(a0)
										move.b  #$10,$B(a0)
										bra.w   sub_101E6

	; End of function sub_15F24


; =============== S U B R O U T I N E =======================================

sub_15FD8:
										
										lea     AlphabetEndWindowLayout(pc), a0
										movea.l -8(a6),a1
										move.w  #$2A,d7 
										jsr     (CopyBytes).w   
										lea     (byte_FF8805).l,a0
										move.w  -$14(a6),d0
										jsr     j_GetCharName
										tst.w   -$1A(a6)
										beq.s   loc_1601E
										moveq   #$A,d7
										lea     $26(a1),a1
										move.l  #$C020C020,(a1)
										move.l  #$C020C020,4(a1)
										move.w  #$C020,8(a1)
										moveq   #$FFFFFFF2,d1
										bsr.w   WriteTilesFromASCII
loc_1601E:
										
										move.w  #$FFFF,-$1A(a6)
										rts

	; End of function sub_15FD8


; =============== S U B R O U T I N E =======================================

sub_16026:
										
										lea     AlphabetEndWindowLayout(pc), a0
										movea.l -8(a6),a1
										move.w  #$2A,d7 
										jsr     (CopyBytes).w   
										lea     (byte_FF8805).l,a0
										moveq   #$A,d7
										lea     $14(a1),a1
										moveq   #$FFFFFFF2,d1
										bsr.w   WriteTilesFromASCII
										rts

	; End of function sub_16026


; =============== S U B R O U T I N E =======================================

sub_1604A:
										
										lea     NameEntryWindowLayout(pc), a0
										movea.l -$C(a6),a1
										move.w  #$366,d7
										jsr     (CopyBytes).w   
										lea     AlphabetEndWindowLayout(pc), a0
										movea.l -8(a6),a1
										move.w  #$2A,d7 
										jsr     (CopyBytes).w   
										lea     WindowBorderTiles(pc), a0
										movea.l -4(a6),a1
										move.w  #$A0,d7 
										jsr     (CopyBytes).w   
										rts

	; End of function sub_1604A

NameEntryWindowLayout:
										incbin "graphics/technical/windowlayouts/nameentrywindowlayout.bin"
AlphabetWindowLayout:
										incbin "graphics/technical/windowlayouts/alphabetwindowlayout.bin"
AlphabetEndWindowLayout:
										incbin "graphics/technical/windowlayouts/alphabetendwindowwindowlayout.bin"
unk_1623A:          dc.b $3D 
										dc.b $FF
										dc.b $80 
										dc.b   0
										dc.b   0
										dc.b $FC 
										dc.b   0
										dc.b $88 
										dc.b   0
										dc.b $A0 
										dc.b $80 
										dc.b $22 
										dc.b   0
										dc.b $80 
										dc.b   1
										dc.b   2
										dc.b $50 
										dc.b $2D 
										dc.b   3
										dc.b $50 
										dc.b $3D 
										dc.b   4
										dc.b $14
										dc.b  $F
										dc.b $FE 
										dc.b $BF 
										dc.b $E0 
										dc.b   5
										dc.b   1
										dc.b   4
										dc.b   0
										dc.b $80 
										dc.b   1
										dc.b   3
										dc.b   0
										dc.b $41 
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   8
										dc.b $82 
										dc.b   0
										dc.b $20
										dc.b   2
										dc.b   8
										dc.b $61 
										dc.b   0
										dc.b   1
										dc.b $41 
										dc.b   2
										dc.b $D0 
										dc.b $35 
										dc.b   4
										dc.b   4
										dc.b $40 
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b $FE 
										dc.b   0
										dc.b $80 
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b $20
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   0
										dc.b   4

; =============== S U B R O U T I N E =======================================

; In: D0 = default num
;     D1 = min num
;     D2 = max num
; Out: D0 = chosen num

NumberPrompt:
										
										movem.l d1-a1,-(sp)
										link    a6,#-WINDOW_NUMPROMPT_STACK_NEGSIZE
										move.w  d0,-WINDOW_NUMPROMPT_STACK_OFFSET_NUM(a6)
										move.w  d1,-WINDOW_NUMPROMPT_STACK_OFFSET_MINNUM(a6)
										move.w  d2,-WINDOW_NUMPROMPT_STACK_OFFSET_MAXNUM(a6)
										move.w  #$703,d0
										move.w  #$2001,d1
										jsr     (CreateWindow).l
										move.w  d0,-WINDOW_NUMPROMPT_STACK_OFFSET_WINDOWIDX(a6)
										move.l  a1,-WINDOW_NUMPROMPT_STACK_OFFSET_WINDOWTILESEND(a6)
										bsr.w   sub_16376
										move.w  -WINDOW_NUMPROMPT_STACK_OFFSET_WINDOWIDX(a6),d0
										move.w  #$1801,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
loc_162C6:
										
										bsr.w   sub_16376
										move.w  -WINDOW_NUMPROMPT_STACK_OFFSET_WINDOWIDX(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										btst    #INPUT_A_RIGHT_BIT,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_162E6
										moveq   #1,d3
										bsr.w   ModifyPromptNumber
loc_162E6:
										
										btst    #INPUT_A_LEFT_BIT,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_162F4
										moveq   #$FFFFFFFF,d3
										bsr.w   ModifyPromptNumber
loc_162F4:
										
										btst    #INPUT_A_DOWN_BIT,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16302
										moveq   #$A,d3
										bsr.w   ModifyPromptNumber
loc_16302:
										
										btst    #INPUT_A_UP_BIT,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16310
										moveq   #$FFFFFFF6,d3
										bsr.w   ModifyPromptNumber
loc_16310:
										
										btst    #INPUT_A_B_BIT,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_16344
										btst    #INPUT_A_C_BIT,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_1634A
										btst    #INPUT_A_A_BIT,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_1634A
										movem.l d6-d7,-(sp)
										move.w  #$100,d6
										jsr     (UpdateRandomSeed).w
										movem.l (sp)+,d6-d7
										jsr     (WaitForVInt).w 
										bra.s   loc_162C6       ; bra.s loc_162C6
loc_16344:
										
										move.w  #$FFFF,-WINDOW_NUMPROMPT_STACK_OFFSET_NUM(a6)
loc_1634A:
										
										move.w  -WINDOW_NUMPROMPT_STACK_OFFSET_WINDOWIDX(a6),d0
										move.w  #$2001,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
										move.w  -WINDOW_NUMPROMPT_STACK_OFFSET_WINDOWIDX(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										move.w  -WINDOW_NUMPROMPT_STACK_OFFSET_NUM(a6),d0
										unlk    a6
										movem.l (sp)+,d1-a1
										rts

	; End of function NumberPrompt


; =============== S U B R O U T I N E =======================================

sub_16376:
										
										movea.l -4(a6),a1
										move.w  #$703,d0
										bsr.w   CopyWindowTilesToRAM
										movea.l -4(a6),a1
										adda.w  #$10,a1
										move.w  -8(a6),d0
										ext.l   d0
										moveq   #$FFFFFFF2,d1
										moveq   #5,d7
										bra.w   WriteTilesFromNumber

	; End of function sub_16376


; =============== S U B R O U T I N E =======================================

; In: A6 = prompt stack

ModifyPromptNumber:
										
										move.w  -8(a6),d0
										add.w   d3,d0
										cmp.w   -$C(a6),d0
										blt.s   loc_163A8
										move.w  -$C(a6),d0
loc_163A8:
										
										cmp.w   -$A(a6),d0
										bge.s   loc_163B2
										move.w  -$A(a6),d0
loc_163B2:
										
										move.w  d0,-8(a6)
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										rts

	; End of function ModifyPromptNumber


; =============== S U B R O U T I N E =======================================

DebugFlagSetter:
										
										movem.l d0-a1,-(sp)
										link    a6,#-$10
										move.w  d0,-8(a6)
										move.w  #$703,d0
										move.w  #$2001,d1
										jsr     (CreateWindow).l
										move.w  d0,-6(a6)
										move.l  a1,-4(a6)
										bsr.s   sub_16376
										move.w  -6(a6),d0
										move.w  #$1801,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
loc_163F6:
										
										bsr.w   sub_164AC
										move.w  -6(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16416
										moveq   #1,d3
										bsr.w   sub_164E8
loc_16416:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16424
										moveq   #$FFFFFFFF,d3
										bsr.w   sub_164E8
loc_16424:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16432
										moveq   #$A,d3
										bsr.w   sub_164E8
loc_16432:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16440
										moveq   #$FFFFFFF6,d3
										bsr.w   sub_164E8
loc_16440:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_16484
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_16464
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_16474
loc_1645E:
										
										jsr     (WaitForVInt).w 
										bra.s   loc_163F6
loc_16464:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										move.w  -8(a6),d1
										jsr     j_SetFlag
										bra.s   loc_1645E
loc_16474:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION
										move.w  -8(a6),d1
										jsr     j_ClearFlag
										bra.s   loc_1645E
loc_16484:
										
										move.w  -6(a6),d0
										move.w  #$2001,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
										move.w  -6(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										unlk    a6
										movem.l (sp)+,d0-a1
										rts

	; End of function DebugFlagSetter


; =============== S U B R O U T I N E =======================================

sub_164AC:
										
										movea.l -4(a6),a1
										move.w  #$703,d0
										bsr.w   CopyWindowTilesToRAM
										movea.l -4(a6),a1
										adda.w  #$10,a1
										move.w  -8(a6),d0
										ext.l   d0
										moveq   #$FFFFFFF2,d1
										moveq   #3,d7
										bsr.w   WriteTilesFromNumber
										addq.l  #2,a1
										move.w  -8(a6),d1
										jsr     j_CheckFlag
										bne.s   loc_164E2
										move.w  #$C030,(a1)
										bra.s   return_164E6
loc_164E2:
										
										move.w  #$C031,(a1)
return_164E6:
										
										rts

	; End of function sub_164AC


; =============== S U B R O U T I N E =======================================

sub_164E8:
										
										move.w  -8(a6),d0
										add.w   d3,d0
										cmpi.w  #0,d0
										bge.s   loc_164F8
										move.w  #0,d0
loc_164F8:
										
										cmpi.w  #$3FF,d0
										blt.s   loc_16502
										move.w  #$3FF,d0
loc_16502:
										
										move.w  d0,-8(a6)
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										rts

	; End of function sub_164E8


; =============== S U B R O U T I N E =======================================

SpecialBattle:
										
										movem.l d0-d1/a0-a1,-(sp)
										tst.w   ((TIMER_WINDOW_INDEX-$1000000)).w
										bne.s   loc_1654C
										move.w  #$804,d0        ; width height
										move.w  #$117,d1        ; X-Y screen pos
										jsr     (CreateWindow).l
										bsr.w   sub_165C0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										addq.w  #1,d0
										move.w  d0,((TIMER_WINDOW_INDEX-$1000000)).w
										trap    #TRAP_VINTFUNCTIONS
										dc.w VINTS_ADD
										dc.l VInt_16588
										move.l  #$FFFFFFFF,((SPECIAL_BATTLE_TIME-$1000000)).w
										addq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
loc_1654C:
										
										movem.l (sp)+,d0-d1/a0-a1
										rts

	; End of function SpecialBattle


; =============== S U B R O U T I N E =======================================

sub_16552:
										
										movem.l d0-d1/a0-a1,-(sp)
										move.w  ((TIMER_WINDOW_INDEX-$1000000)).w,d0
										beq.s   loc_16582
										subq.w  #1,d0
										move.w  #$2020,d1
										jsr     (SetWindowDestination).l
										jsr     (WaitForVInt).w 
										jsr     (ClearWindowAndUpdateEndPtr).l
										clr.w   ((TIMER_WINDOW_INDEX-$1000000)).w
										trap    #TRAP_VINTFUNCTIONS
										dc.w VINTS_REMOVE
										dc.l VInt_16588
										subq.b  #1,((WINDOW_IS_PRESENT-$1000000)).w
loc_16582:
										
										movem.l (sp)+,d0-d1/a0-a1
										rts

	; End of function sub_16552


; =============== S U B R O U T I N E =======================================

VInt_16588:
										
										movem.l d0-d1/a0-a1,-(sp)
										move.w  ((TIMER_WINDOW_INDEX-$1000000)).w,d0
										beq.s   loc_165BA
										move.l  ((SECONDS_COUNTER-$1000000)).w,d1
										cmp.l   ((SPECIAL_BATTLE_TIME-$1000000)).w,d1
										beq.s   loc_165BA
										move.l  d1,((SPECIAL_BATTLE_TIME-$1000000)).w
										subq.w  #1,d0
										bsr.w   sub_165C0
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										tst.b   ((DISPLAY_WINDOWS_TOGGLE-$1000000)).w
										bne.s   loc_165BA
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
loc_165BA:
										
										movem.l (sp)+,d0-d1/a0-a1
										rts

	; End of function VInt_16588


; =============== S U B R O U T I N E =======================================

sub_165C0:
										
										move.w  d0,-(sp)
										clr.w   d1
										jsr     (GetAddressOfWindowTileDataStartingAtCoord).l
										movem.l a1,-(sp)
										lea     TimerWindowLayout(pc), a0
										moveq   #$40,d7 
										jsr     (CopyBytes).w   
										movem.l (sp)+,a1
										adda.w  #$22,a1 
										move.l  ((SECONDS_COUNTER-$1000000)).w,d0
										divu.w  #$3C,d0 
										move.l  d0,-(sp)
										ext.l   d0
										cmpi.l  #$3E7,d0
										bcs.s   loc_165FA
										move.l  #$3E7,d0
loc_165FA:
										
										moveq   #$FFFFFFF0,d1
										moveq   #3,d7
										bsr.w   WriteTilesFromNumber
										move.l  (sp)+,d0
										swap    d0
										ext.l   d0
										addi.w  #$64,d0 
										addq.l  #2,a1
										moveq   #2,d7
										bsr.w   WriteTilesFromNumber
										move.w  (sp)+,d0
										rts

	; End of function sub_165C0

TimerWindowLayout:  incbin "graphics/technical/windowlayouts/timerwindowwindowlayout.bin"

; =============== S U B R O U T I N E =======================================

WitchMainMenu:
										
										movem.l d1-a1,-(sp)
										link    a6,#-$10
										andi.w  #$F,d0
										move.w  d2,-$C(a6)
										beq.w   loc_16756
										move.w  d1,-$A(a6)
										move.w  #$A,-8(a6)
										movem.w d0,-(sp)
										move.w  #$1C0C,d0
										move.w  #$2001,d1
										jsr     (CreateWindow).l
										move.w  d0,-6(a6)
										move.l  a1,-4(a6)
										movea.l (p_plt_WitchChoice).l,a0
										lea     (Palette2).l,a1
										move.w  #$20,d7 
										jsr     (CopyBytes).w   
										jsr     (StoreVdpCommandster).w
										bsr.w   sub_1679E
										move.w  -6(a6),d0
										move.w  #$202,d1
										jsr     (SetWindowDestination).l
										jsr     (WaitForVInt).w 
										movem.w (sp)+,d0
loc_166C2:
										
										bsr.w   sub_1679E
										movem.w d0,-(sp)
										move.w  -6(a6),d0
										move.w  #$8080,d1
										jsr     (SetWindowDestination).l
										movem.w (sp)+,d0
										btst    #3,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_166EA
										moveq   #1,d3
										bsr.w   sub_1678A
loc_166EA:
										
										btst    #2,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_166F8
										moveq   #$FFFFFFFF,d3
										bsr.w   sub_1678A
loc_166F8:
										
										btst    #1,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16706
										moveq   #1,d3
										bsr.w   sub_1678A
loc_16706:
										
										btst    #0,((CURRENT_PLAYER_INPUT-$1000000)).w
										beq.s   loc_16714
										moveq   #$FFFFFFFF,d3
										bsr.w   sub_1678A
loc_16714:
										
										btst    #4,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_16756
										btst    #5,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_1675A
										btst    #6,((CURRENT_PLAYER_INPUT-$1000000)).w
										bne.w   loc_1675A
										movem.l d6-d7,-(sp)
										move.w  #$100,d6
										jsr     (UpdateRandomSeed).w
										movem.l (sp)+,d6-d7
										jsr     (WaitForVInt).w 
										subq.w  #1,-8(a6)
										bne.s   loc_16752
										move.w  #$14,-8(a6)
loc_16752:
										
										bra.w   loc_166C2
loc_16756:
										
										move.w  #$FFFF,d0
loc_1675A:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_VALIDATION     ; validation
										movem.w d0,-(sp)
										move.w  -6(a6),d0
										move.w  #$2001,d1
										jsr     (SetWindowDestination).l
										jsr     (WaitForVInt).w 
										move.w  -6(a6),d0
										jsr     (ClearWindowAndUpdateEndPtr).l
										movem.w (sp)+,d0
										unlk    a6
										movem.l (sp)+,d1-a1
										rts

	; End of function WitchMainMenu


; =============== S U B R O U T I N E =======================================

sub_1678A:
										
										trap    #TRAP_SOUNDCOM
										dc.w SFX_MENU_SELECTION
										add.w   d3,d0
										andi.w  #3,d0
										move.w  -$C(a6),d1
										btst    d0,d1
										beq.s   sub_1678A
										rts

	; End of function sub_1678A


; =============== S U B R O U T I N E =======================================

sub_1679E:
										
										movea.l -4(a6),a0
										move.w  #$A7,d7 
loc_167A6:
										
										clr.l   (a0)+
										dbf     d7,loc_167A6
										move.w  -$C(a6),d6
										btst    #0,d6
										beq.s   loc_167C6
										move.w  #0,d3
										move.w  #0,d2
										move.w  #$188,d1
										bsr.w   DrawWitchMenuBubble
loc_167C6:
										
										btst    #1,d6
										beq.s   loc_167DC
										move.w  #1,d3
										move.w  #$F0,d2 
										move.w  #4,d1
										bsr.w   DrawWitchMenuBubble
loc_167DC:
										
										btst    #2,d6
										beq.s   loc_167F2
										move.w  #2,d3
										move.w  #$1E0,d2
										move.w  #$24,d1 
										bsr.w   DrawWitchMenuBubble
loc_167F2:
										
										btst    #3,d6
										beq.s   return_16808
										move.w  #3,d3
										move.w  #$2D0,d2
										move.w  #$1B0,d1
										bsr.w   DrawWitchMenuBubble
return_16808:
										
										rts

	; End of function sub_1679E


; =============== S U B R O U T I N E =======================================

DrawWitchMenuBubble:
										
										movea.l (p_WitchBubbleAnimation).l,a0
										movea.l -4(a6),a1
										cmp.b   d0,d3
										bne.s   loc_1683A
										move.w  -8(a6),d7
										cmpi.w  #5,d7
										blt.s   loc_16826
										addi.w  #$50,d2 
loc_16826:
										
										cmpi.w  #$A,d7
										blt.s   loc_16830
										addi.w  #$50,d2 
loc_16830:
										
										cmpi.w  #$F,d7
										blt.s   loc_1683A
										subi.w  #$50,d2 
loc_1683A:
										
										adda.w  d2,a0
										adda.w  d1,a1
										movem.l a1,-(sp)
										moveq   #4,d7
loc_16844:
										
										moveq   #7,d5
loc_16846:
										
										move.w  (a0)+,(a1)
										addi.w  #-$5D00,(a1)+
										dbf     d5,loc_16846
										lea     $28(a1),a1
										dbf     d7,loc_16844
										movem.l (sp)+,a1
										cmpi.w  #2,d3
										blt.s   loc_16864
										addq.l  #2,a1
loc_16864:
										
										move.w  -$A(a6),d1
										bne.w   loc_168A4
										adda.w  #$72,a1 
										lsl.w   #2,d3
										movea.l pt_s_WitchMenu(pc,d3.w),a0
										moveq   #5,d7
										bsr.w   sub_1697C
										rts
pt_s_WitchMenu:
										
										dc.l aStart             
										dc.l aCont_             
										dc.l aDel_              
										dc.l aCopy              
aStart:
										dc.b 'START',0
aCont_:
										dc.b 'CONT.',0
aDel_:
										dc.b 'DEL.',0
aCopy:
										dc.b 'COPY',0
loc_168A4:
										
										subq.w  #1,d1
										bne.w   sub_168D8
										adda.w  #$72,a1 
										lsl.w   #2,d3
										movea.l pt_s_DataMenu(pc,d3.w),a0
										moveq   #5,d7
										bsr.w   sub_1697C
										rts

	; End of function DrawWitchMenuBubble

pt_s_DataMenu:      dc.l aData1             
										dc.l aData1             
										dc.l aData2             
										dc.l aData2             
aData1:             dc.b 'DATA1',0
aData2:             dc.b 'DATA2',0

; =============== S U B R O U T I N E =======================================

sub_168D8:
										
										subq.w  #1,d1
										bne.w   sub_16942
										movem.l d7-a1,-(sp)
										lea     (SAVE1_CHARACTER_DATA).l,a0
										cmpi.w  #2,d3
										blt.s   loc_168F4
										lea     (SAVE2_CHARACTER_DATA).l,a0
loc_168F4:
										
										lea     (DMA_SPACE_FF8804).l,a1
										moveq   #9,d7
loc_168FC:
										
										move.b  (a0),(a1)+
										addq.l  #2,a0
										dbf     d7,loc_168FC
										movem.l (sp)+,d7-a1
										adda.w  #$72,a1 
										move.l  a1,-(sp)
										lsl.w   #2,d3
										lea     (DMA_SPACE_FF8804).l,a0
										moveq   #5,d7
										bsr.w   sub_1697C
										movea.l (sp)+,a1
										cmpi.b  #0,(byte_FF8809).l
										beq.s   return_16940
										move.b  #$2D,9(a1) 
										adda.w  #$38,a1 
										lsl.w   #2,d3
										lea     (byte_FF8808).l,a0
										moveq   #4,d7
										bsr.w   sub_1697C
return_16940:
										
										rts

	; End of function sub_168D8


; =============== S U B R O U T I N E =======================================

sub_16942:
										
										adda.w  #$72,a1 
										lsl.w   #2,d3
										movea.l pt_s_DifficultyMenu(pc,d3.w),a0
										moveq   #5,d7
										bsr.w   sub_1697C
										rts

	; End of function sub_16942

pt_s_DifficultyMenu:dc.l aNorm_             
										dc.l aHard              
										dc.l aSuper             
										dc.l aOuch              
aNorm_:             dc.b 'NORM.',0
aHard:              dc.b 'HARD',0
aSuper:             dc.b 'SUPER',0
aOuch:              dc.b 'OUCH!',0
										dc.b $FF

; =============== S U B R O U T I N E =======================================

sub_1697C:
										
										movem.w d0,-(sp)
										movem.l d7/a1,-(sp)
										moveq   #$FFFFFFC8,d1
										bsr.w   WriteTilesFromASCII
										movem.l (sp)+,d7/a1
										subq.w  #1,d7
loc_16990:
										
										andi.w  #$9FFF,(a1,d1.w)
										ori.w   #$2000,(a1,d1.w)
										andi.w  #$9FFF,(a1)
										ori.w   #$2000,(a1)+
										dbf     d7,loc_16990
										movem.w (sp)+,d0
										rts

	; End of function sub_1697C


; =============== S U B R O U T I N E =======================================

sub_169AE:
										
										movem.l d0-a1,-(sp)
										tst.w   (word_FFB08C).l
										bne.s   loc_16A2A
										movem.w d0,-(sp)
										move.w  #$A03,d0
										move.w  #$F60B,d1
										jsr     (CreateWindow).l
										addq.w  #1,d0
										move.w  d0,(word_FFB08C).l
										move.w  #$A03,d0
										bsr.w   sub_1018E       
										movem.w (sp)+,d0
										jsr     j_GetCurrentHP
										move.w  d1,d2
										jsr     j_GetCharName
										move.w  d7,d0
										addq.w  #1,d0
										andi.w  #$E,d0
										move.w  #$1E,d1
										sub.w   d0,d1
										adda.w  d1,a1
										moveq   #$FFFFFFF0,d1
										moveq   #$A,d7
										tst.w   d2
										bne.s   loc_16A0C
										bsr.w   sub_100C8       
										bra.s   loc_16A10
loc_16A0C:
										
										bsr.w   WriteTilesFromASCII
loc_16A10:
										
										move.w  (word_FFB08C).l,d0
										subq.w  #1,d0
										move.w  #$10B,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
loc_16A2A:
										
										movem.l (sp)+,d0-a1
										rts

	; End of function sub_169AE


; =============== S U B R O U T I N E =======================================

sub_16A30:
										
										movem.l d0-d1/a0-a1,-(sp)
										move.w  (word_FFB08C).l,d0
										beq.s   loc_16A5C
										subq.w  #1,d0
										move.w  #$F60B,d1
										moveq   #4,d2
										jsr     (MoveWindowWithSFX).l
										jsr     (WaitForVint_andFFA900Clear).l
										jsr     (ClearWindowAndUpdateEndPtr).l
										clr.w   (word_FFB08C).l
loc_16A5C:
										
										movem.l (sp)+,d0-d1/a0-a1
										rts

	; End of function sub_16A30

MemberStatsWindowLayout:
										incbin "graphics/technical/windowlayouts/memberstatswindowslayout.bin"
ItemDefs:           incbin "data/items/itemdefs.bin"
SpellDefs:          incbin "data/spells/spelldefs.bin"
ItemNames:          incbin "data/items/itemnames.bin"
ClassNames:         incbin "data/allies/classes/classnames.bin"
										align $8000
